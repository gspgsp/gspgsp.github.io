import{_ as s,c as a,f as e,o as i}from"./app-BB_BIQV8.js";const l={};function c(d,n){return i(),a("div",null,n[0]||(n[0]=[e(`<h5 id="symfony7ä¹‹doctrine-yamlé…ç½®" tabindex="-1"><a class="header-anchor" href="#symfony7ä¹‹doctrine-yamlé…ç½®"><span>symfony7ä¹‹doctrine.yamlé…ç½®</span></a></h5><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">doctrine:</span>
<span class="line">    dbal:</span>
<span class="line">        connections:</span>
<span class="line">            default: # ä¸»æ•°æ®åº“è¿æ¥</span>
<span class="line">                server_version: &#39;8.0&#39;</span>
<span class="line">                url: &#39;%env(resolve:DATABASE_PRIMARY_URL)%&#39;</span>
<span class="line">                driver: pdo_mysql</span>
<span class="line">                charset: utf8mb4</span>
<span class="line">                default_table_options:</span>
<span class="line">                    collate: utf8mb4_unicode_ci</span>
<span class="line">                mapping_types:</span>
<span class="line">                    enum: string</span>
<span class="line">                schema_filter: ~^(?!(messenger_messages|migration_versions)$)~</span>
<span class="line">                replicas: # è®© SELECT è¯­å¥è‡ªåŠ¨èµ° secondaryï¼ˆä»åº“ï¼‰</span>
<span class="line">                    secondary:</span>
<span class="line">                        url: &#39;%env(resolve:DATABASE_SECONDARY_URL)%&#39;</span>
<span class="line">            secondary: # é¢å¤–æ‰‹åŠ¨æŒ‡å®šçš„ä»åº“è¿æ¥</span>
<span class="line">                url: &#39;%env(resolve:DATABASE_SECONDARY_URL)%&#39;</span>
<span class="line">        default_connection: default</span>
<span class="line"></span>
<span class="line">    orm:</span>
<span class="line">        auto_generate_proxy_classes: true</span>
<span class="line">        enable_lazy_ghost_objects: true</span>
<span class="line"></span>
<span class="line">        default_entity_manager: default # é»˜è®¤ entity_manager</span>
<span class="line">        entity_managers:</span>
<span class="line">            default:</span>
<span class="line">                connection: default # ç»‘å®šåˆ° dbal.connections.default</span>
<span class="line">                mappings:</span>
<span class="line">                    App:</span>
<span class="line">                        dir: &#39;%kernel.project_dir%/src/Entity&#39;</span>
<span class="line">                        prefix: &#39;App\\Entity&#39;</span>
<span class="line">                        alias: App</span>
<span class="line">                    tree:</span>
<span class="line">                        type: attribute # or annotation or xml</span>
<span class="line">                        alias: Gedmo</span>
<span class="line">                        prefix: Gedmo\\Tree\\Entity</span>
<span class="line">                        dir: &quot;%kernel.project_dir%/vendor/gedmo/doctrine-extensions/src/Tree/Entity&quot;</span>
<span class="line">                # add qinhongpub databases so doctrine can ignore them while executing &#39;doctrine:migration:diff&#39; command</span>
<span class="line">                schema_ignore_classes:</span>
<span class="line">                    - App\\Entity\\qinhongpub\\User</span>
<span class="line">                    - App\\Entity\\qinhongpub\\Continent</span>
<span class="line">                    - App\\Entity\\qinhongpub\\Country</span>
<span class="line">                    - App\\Entity\\qinhongpub\\UserJobtype</span>
<span class="line">                    - App\\Entity\\qinhongpub\\UserMultipleEmail</span>
<span class="line">                    - App\\Entity\\qinhongpub\\UserTitle</span>
<span class="line">                    - App\\Entity\\qinhongpub\\UserWorkplace</span>
<span class="line">                    - App\\Entity\\qinhongpub\\EmailUserRel</span>
<span class="line">                    - App\\Entity\\qinhongpub\\ExchangeRate</span>
<span class="line">                dql:</span>
<span class="line">                    string_functions:</span>
<span class="line">                        concat_ws: DoctrineExtensions\\Query\\Mysql\\ConcatWs</span>
<span class="line"></span>
<span class="line">            secondary:</span>
<span class="line">                connection: secondary # ç»‘å®š \`dbal.connections.secondary\`</span>
<span class="line">                mappings:</span>
<span class="line">                    App:</span>
<span class="line">                        dir: &#39;%kernel.project_dir%/src/Entity&#39;</span>
<span class="line">                        prefix: &#39;App\\Entity&#39;</span>
<span class="line">                        alias: App</span>
<span class="line">                    tree:</span>
<span class="line">                        type: attribute # or annotation or xml</span>
<span class="line">                        alias: Gedmo</span>
<span class="line">                        prefix: Gedmo\\Tree\\Entity</span>
<span class="line">                        dir: &quot;%kernel.project_dir%/vendor/gedmo/doctrine-extensions/src/Tree/Entity&quot;</span>
<span class="line">                dql:</span>
<span class="line">                    string_functions:</span>
<span class="line">                        concat_ws: DoctrineExtensions\\Query\\Mysql\\ConcatWs</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨"><span>ä½¿ç”¨</span></a></h5><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">å…ˆåœ¨ service.yamlä¸‹é…ç½®binbdå‚æ•°</span>
<span class="line">bind:</span>
<span class="line">    $em: &quot;@doctrine.orm.default_entity_manager&quot; # _entity_manager æ˜¯ä¸€ä¸ªå›ºå®šçš„æ ¼å¼ï¼Œé€šå¸¸æ˜¯ä¸ºäº†ä¸ Doctrine çš„å†…éƒ¨çº¦å®šä¿æŒä¸€è‡´ã€‚Doctrine ä¼šæ ¹æ®é…ç½®çš„ entity_managers éƒ¨åˆ†çš„åç§°è‡ªåŠ¨ç”Ÿæˆè¿™äº›å®ä½“ç®¡ç†å™¨çš„æœåŠ¡åç§°ã€‚å¦‚æœæ‚¨å®šä¹‰äº†å¤šä¸ªå®ä½“ç®¡ç†å™¨ï¼ˆå¦‚ defaultã€secondaryã€thirdï¼‰ï¼ŒDoctrine ä¼šä¸ºæ¯ä¸ªç®¡ç†å™¨ç”Ÿæˆå¯¹åº”çš„æœåŠ¡åç§°ï¼Œåç¼€ _entity_manager æ˜¯å›ºå®šçš„ã€‚</span>
<span class="line">    $emSlave: &quot;@doctrine.orm.secondary_entity_manager&quot; # _entity_manager æ˜¯ä¸€ä¸ªå›ºå®šçš„æ ¼å¼ï¼Œé€šå¸¸æ˜¯ä¸ºäº†ä¸ Doctrine çš„å†…éƒ¨çº¦å®šä¿æŒä¸€è‡´ã€‚Doctrine ä¼šæ ¹æ®é…ç½®çš„ entity_managers éƒ¨åˆ†çš„åç§°è‡ªåŠ¨ç”Ÿæˆè¿™äº›å®ä½“ç®¡ç†å™¨çš„æœåŠ¡åç§°ã€‚å¦‚æœæ‚¨å®šä¹‰äº†å¤šä¸ªå®ä½“ç®¡ç†å™¨ï¼ˆå¦‚ defaultã€secondaryã€thirdï¼‰ï¼ŒDoctrine ä¼šä¸ºæ¯ä¸ªç®¡ç†å™¨ç”Ÿæˆå¯¹åº”çš„æœåŠ¡åç§°ï¼Œåç¼€ _entity_manager æ˜¯å›ºå®šçš„ã€‚</span>
<span class="line">    </span>
<span class="line">ä¾‹å­:</span>
<span class="line">use Doctrine\\ORM\\EntityManagerInterface;</span>
<span class="line"></span>
<span class="line">class MyService</span>
<span class="line">{</span>
<span class="line">    private EntityManagerInterface $em;</span>
<span class="line">    private EntityManagerInterface $emSlave;</span>
<span class="line"></span>
<span class="line">    public function __construct(EntityManagerInterface $em, EntityManagerInterface $emSlave)</span>
<span class="line">    {</span>
<span class="line">        $this-&gt;em = $em;</span>
<span class="line">        $this-&gt;emSlave = $emSlave;</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    public function fetchData()</span>
<span class="line">    {</span>
<span class="line">        // ä»ä¸»æ•°æ®åº“æŸ¥è¯¢</span>
<span class="line">        $data = $this-&gt;em-&gt;getRepository(SomeEntity::class)-&gt;findAll();</span>
<span class="line"></span>
<span class="line">        // ä»ä»æ•°æ®åº“æŸ¥è¯¢</span>
<span class="line">        $dataSlave = $this-&gt;emSlave-&gt;getRepository(SomeEntity::class)-&gt;findAll();</span>
<span class="line"></span>
<span class="line">        return [$data, $dataSlave];</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">// æ‰‹åŠ¨åˆ‡æ¢æ•°æ®åº“è¿æ¥</span>
<span class="line">use Doctrine\\ORM\\EntityManagerInterface;</span>
<span class="line">use Doctrine\\Persistence\\ManagerRegistry;</span>
<span class="line"></span>
<span class="line">class YourService</span>
<span class="line">{</span>
<span class="line">    public function __construct(</span>
<span class="line">        private readonly EntityManagerInterface $em,</span>
<span class="line">        private readonly ManagerRegistry $doctrine, // å…è®¸æ‰‹åŠ¨è·å–ä¸åŒçš„ EntityManager</span>
<span class="line">    ) {</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    public function getUserFromSlave(int $id)</span>
<span class="line">    {</span>
<span class="line">        $emSlave = $this-&gt;doctrine-&gt;getManager(&#39;secondary&#39;); // è·å– secondary EntityManager</span>
<span class="line">        return $emSlave-&gt;getRepository(User::class)-&gt;find($id);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="åˆ†æ" tabindex="-1"><a class="header-anchor" href="#åˆ†æ"><span>åˆ†æ</span></a></h5><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">dbalï¼ˆDatabase Abstraction Layer[æ•°æ®åº“æŠ½è±¡å±‚]ï¼‰ å’Œ ormï¼ˆObject-Relational Mapper[ORM æ˜ å°„å±‚]ï¼‰ æ˜¯ä¸¤ä¸ªä¸åŒçš„éƒ¨åˆ†ï¼Œå®ƒä»¬å„è‡ªè´Ÿè´£ä¸åŒçš„ä»»åŠ¡ï¼Œä½†ç›¸äº’é…åˆä½¿ç”¨ã€‚</span>
<span class="line"></span>
<span class="line">dbal:</span>
<span class="line">ä½œç”¨ï¼š</span>
<span class="line">è´Ÿè´£ç®¡ç†æ•°æ®åº“è¿æ¥</span>
<span class="line">å¤„ç†SQL è¯­å¥çš„æ‰§è¡Œ</span>
<span class="line">æ”¯æŒå¤šä¸ªæ•°æ®åº“è¿æ¥</span>
<span class="line">æä¾›äº‹åŠ¡ç®¡ç†</span>
<span class="line"></span>
<span class="line">ä¸Šé¢é…ç½®åˆ†æ:</span>
<span class="line">dbal.connections.default</span>
<span class="line">è¿™æ˜¯ä¸»æ•°æ®åº“è¿æ¥</span>
<span class="line">replicas è®© SELECT æŸ¥è¯¢å¯ä»¥è‡ªåŠ¨èµ° secondary (æ‰€ä»¥å½“å‰çš„é…ç½®ï¼Œï¼Œé»˜è®¤å°±é€šè¿‡replicaså®ç°äº†ä¸»ä»æ•°æ®åº“æ“ä½œ)</span>
<span class="line"></span>
<span class="line">dbal.connections.secondary</span>
<span class="line">è¿™æ˜¯é¢å¤–å®šä¹‰çš„ä»åº“è¿æ¥</span>
<span class="line">ä¸»è¦ç”¨äºæ‰‹åŠ¨åˆ‡æ¢ EntityManager ä½¿ç”¨</span>
<span class="line"></span>
<span class="line">default_connection: default</span>
<span class="line">é»˜è®¤æƒ…å†µä¸‹ï¼ŒDoctrine ä¼šä½¿ç”¨ default è¿æ¥</span>
<span class="line">ğŸ‘‰ ç»“è®ºï¼šdbal åªç®¡æ•°æ®åº“è¿æ¥ï¼Œä¸æ¶‰åŠ ORM æ˜ å°„</span>
<span class="line"></span>
<span class="line">orm:</span>
<span class="line">ä½œç”¨ï¼š</span>
<span class="line">è´Ÿè´£å®ä½“ï¼ˆEntityï¼‰å’Œæ•°æ®åº“è¡¨çš„æ˜ å°„</span>
<span class="line">è®©ä½ ç”¨ PHP å¯¹è±¡ è€Œä¸æ˜¯ SQL è¯­å¥æ“ä½œæ•°æ®åº“</span>
<span class="line">éœ€è¦ EntityManager æ¥ç®¡ç†æ•°æ®åº“æ“ä½œ</span>
<span class="line">æ”¯æŒ å¤šä¸ª EntityManagerï¼Œæ¯ä¸ª EntityManager å¯ä»¥ç»‘å®šä¸åŒçš„æ•°æ®åº“è¿æ¥</span>
<span class="line"></span>
<span class="line">ä¸Šé¢é…ç½®åˆ†æ:</span>
<span class="line">default_entity_manager: default</span>
<span class="line">é»˜è®¤ EntityManager ç»‘å®š dbal.connections.default</span>
<span class="line"></span>
<span class="line">entity_managers.default.connection: default</span>
<span class="line">è¿™ä¸ª EntityManager ç»‘å®šåˆ° defaultï¼ˆä¸»æ•°æ®åº“ï¼‰</span>
<span class="line"></span>
<span class="line">entity_managers.secondary.connection: secondary</span>
<span class="line">è¿™ä¸ª EntityManager ç»‘å®šåˆ° secondaryï¼ˆä»æ•°æ®åº“ï¼‰</span>
<span class="line"></span>
<span class="line">æœ€ç»ˆæ•ˆæœï¼š</span>
<span class="line">é»˜è®¤ ORM æŸ¥è¯¢ä¼šè‡ªåŠ¨ä½¿ç”¨ dbal.default</span>
<span class="line">å¦‚æœæ˜¯ SELECT è¯­å¥ï¼ŒDoctrine ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ° replicas.secondary</span>
<span class="line">å¦‚æœæ˜¯ INSERT/UPDATE/DELETE è¯­å¥ï¼ŒDoctrine ä»ç„¶ä½¿ç”¨ dbal.defaultï¼ˆä¸»åº“ï¼‰</span>
<span class="line">å¦‚æœæ‰‹åŠ¨æŒ‡å®š orm.entity_managers.secondaryï¼Œé‚£ä¹ˆæ‰€æœ‰æ“ä½œéƒ½èµ° dbal.connections.secondary</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6)]))}const r=s(l,[["render",c],["__file","symfony7ä¹‹doctrineé…ç½®.html.vue"]]),t=JSON.parse('{"path":"/content/php/symfony/symfony7%E4%B9%8Bdoctrine%E9%85%8D%E7%BD%AE.html","title":"symfony7ä¹‹doctrineé…ç½®","lang":"en-US","frontmatter":{"sidebar":false,"title":"symfony7ä¹‹doctrineé…ç½®","head":[["meta",{"name":"title","content":"symfony7ä¹‹doctrineé…ç½®"}],["meta",{"name":"description","content":"symfony7ä¹‹doctrineé…ç½®"}],["meta",{"name":"keywords","content":"symfony7,doctrine,php"}],["meta",{"property":"og:title","content":"symfony7ä¹‹doctrineé…ç½®"}],["meta",{"property":"og:description","content":"symfony7ä¹‹doctrineé…ç½®"}]]},"headers":[],"git":{},"filePathRelative":"content/php/symfony/symfony7ä¹‹doctrineé…ç½®.md"}');export{r as comp,t as data};
