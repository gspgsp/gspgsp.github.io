import{_ as ae,e as h,G as B,l as F,o as f,c as g,b as c,f as U,h as oe,v as se,t as le,i as b,y as j,F as ce,x as ie}from"./app-CHrRue27.js";const re={__name:"MoHu",setup(A,{expose:i}){i();const d=h(null),e=h(null),u=h(new Image),m=h(!1),l=h([]),x=h(12),t=B({startX:0,startY:0,endX:0,endY:0,isSelecting:!1}),o=B({x:0,y:0,w:0,h:0}),G=s=>{const n=s.target.files[0];if(!n)return;const a=new FileReader;a.onload=()=>{u.value.onload=()=>{const r=d.value;r.width=u.value.width,r.height=u.value.height,e.value=r.getContext("2d"),e.value.drawImage(u.value,0,0),m.value=!0,l.value=[]},u.value.src=a.result},a.readAsDataURL(n)},P=s=>{if(!m.value)return;const n=d.value;if(!n)return;const a=n.getBoundingClientRect();t.isSelecting=!0,t.startX=p(s.clientX-a.left,0,a.width),t.startY=p(s.clientY-a.top,0,a.height),t.endX=t.startX,t.endY=t.startY,X()},W=s=>{if(!t.isSelecting)return;const n=d.value;if(!n)return;const a=n.getBoundingClientRect();t.endX=p(s.clientX-a.left,0,a.width),t.endY=p(s.clientY-a.top,0,a.height),X()},q=()=>{t.isSelecting&&(t.isSelecting=!1,o.w>5&&o.h>5&&l.value.push({x:o.x,y:o.y,w:o.w,h:o.h}),o.x=o.y=o.w=o.h=0)};function X(s){o.x=Math.min(t.startX,t.endX),o.y=Math.min(t.startY,t.endY),o.w=Math.abs(t.endX-t.startX),o.h=Math.abs(t.endY-t.startY)}function z(s){const n=d.value;if(!n)return{sx:0,sy:0,sw:0,sh:0,scaleX:1,scaleY:1};const a=n.getBoundingClientRect(),r=n.width/a.width,w=n.height/a.height,Y=Math.max(0,Math.floor(s.x*r)),k=Math.max(0,Math.floor(s.y*w)),C=Math.max(1,Math.floor(s.w*r)),y=Math.max(1,Math.floor(s.h*w));return{sx:Y,sy:k,sw:C,sh:y,scaleX:r,scaleY:w}}const J=()=>{!e.value||!l.value.length||!d.value||(l.value.forEach(n=>{const{sx:a,sy:r,sw:w,sh:Y,scaleX:k,scaleY:C}=z(n),y=Math.max(1,Math.floor(x.value*k)),V=Math.max(1,Math.floor(x.value*C)),E=e.value.getImageData(a,r,w,Y),{data:v,width:_,height:N}=E;for(let S=0;S<N;S+=V)for(let M=0;M<_;M+=y){const I=(S*_+M)*4,ee=v[I],te=v[I+1],ne=v[I+2];for(let R=0;R<V;R++)for(let D=0;D<y;D++){const O=S+R,T=M+D;if(T<_&&O<N){const L=(O*_+T)*4;v[L]=ee,v[L+1]=te,v[L+2]=ne}}}e.value.putImageData(E,a,r)}),l.value=[])},K=()=>{!e.value||!m.value||(l.value=[],e.value.drawImage(u.value,0,0))},Q=()=>{const s=d.value;if(!s)return;const n=document.createElement("a");n.download="mosaic.png",n.href=s.toDataURL("image/png"),n.click()},Z=F(()=>t.isSelecting),$=F(()=>({left:`${o.x}px`,top:`${o.y}px`,width:`${o.w}px`,height:`${o.h}px`}));function p(s,n,a){return Math.max(n,Math.min(a,s))}const H={canvas:d,ctx:e,img:u,imageLoaded:m,selections:l,mosaicSize:x,selecting:t,currentRect:o,onFileChange:G,startSelection:P,drawSelection:W,endSelection:q,updateCurrentRectFromSelecting:X,cssRectToCanvasRect:z,applyMosaic:J,clearSelections:K,downloadImage:Q,isSelecting:Z,currentSelectionStyle:$,clamp:p,ref:h,reactive:B,computed:F};return Object.defineProperty(H,"__isScriptSetup",{enumerable:!1,value:!0}),H}},de={class:"mosaic-page"},ue={key:0,class:"controls"},he={ref:"canvas"},fe={key:1,class:"canvas-placeholder"},ge={class:"upload-box"},ve={class:"upload-btn"},me={key:1,class:"actions"},xe=["disabled"];function pe(A,i,d,e,u,m){return f(),g("div",de,[i[3]||(i[3]=c("h2",{class:"title"},"ðŸ–¼ åœ¨çº¿å›¾ç‰‡æ‰“é©¬èµ›å…‹",-1)),e.imageLoaded?(f(),g("div",ue,[c("label",null,[i[1]||(i[1]=U(" é©¬èµ›å…‹å¼ºåº¦ï¼š ")),oe(c("input",{type:"range",min:"4",max:"30","onUpdate:modelValue":i[0]||(i[0]=l=>e.mosaicSize=l)},null,512),[[se,e.mosaicSize]]),c("span",null,le(e.mosaicSize)+"px",1)])])):b("",!0),c("div",{class:"canvas-wrapper",onMousedown:e.startSelection,onMousemove:e.drawSelection,onMouseup:e.endSelection,onMouseleave:e.endSelection},[c("canvas",he,null,512),e.isSelecting?(f(),g("div",{key:0,class:"selection",style:j(e.currentSelectionStyle)},null,4)):b("",!0),(f(!0),g(ce,null,ie(e.selections,(l,x)=>(f(),g("div",{key:x,class:"selection confirmed",style:j({left:l.x+"px",top:l.y+"px",width:l.w+"px",height:l.h+"px"})},null,4))),128)),e.imageLoaded?b("",!0):(f(),g("div",fe,[c("div",ge,[c("label",ve,[c("input",{type:"file",onChange:e.onFileChange,accept:"image/*"},null,32),i[2]||(i[2]=U(" é€‰æ‹©å›¾ç‰‡ "))])])]))],32),e.imageLoaded?(f(),g("div",me,[c("button",{onClick:e.applyMosaic,disabled:!e.selections.length},"æ‰“é©¬èµ›å…‹",8,xe),c("button",{onClick:e.clearSelections},"æ¸…é™¤é€‰åŒº"),c("button",{onClick:e.downloadImage},"ä¸‹è½½å›¾ç‰‡")])):b("",!0)])}const ye=ae(re,[["render",pe],["__scopeId","data-v-97036385"],["__file","MoHu.vue"]]);export{ye as default};
