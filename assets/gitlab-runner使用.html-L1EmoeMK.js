import{_ as s,c as a,f as e,o as t}from"./app-BB_BIQV8.js";const p={};function l(i,n){return t(),a("div",null,n[0]||(n[0]=[e(`<p>gitlab-runner使用:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">安装/部署:</span>
<span class="line">https://www.cnblogs.com/scajy/p/15661187.html</span>
<span class="line"></span>
<span class="line">https://juejin.cn/post/6844903937091321864</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>一个基于php的hook.php</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"><span class="token function">set_time_limit</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//这一行将当前请求的 $_SERVER 变量的内容以 JSON 格式写入到 /tmp/hook.out 文件中，可能是为了调试或者记录请求的信息。</span></span>
<span class="line"><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/tmp/hook.out&#39;</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//这里定义了一组被允许的 Git 仓库路径，使用 GitLab Token 作为索引。如果请求中的 Token 不在这个列表中，脚本会提前结束。</span></span>
<span class="line"><span class="token variable">$allowedTokens</span> <span class="token operator">=</span> <span class="token punctuation">[</span> </span>
<span class="line">    <span class="token string single-quoted-string">&#39;pj1&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;/var/www/git/branches/pj1/dev&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;pj2&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;/var/www/git/branches/pj2t/dev&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token variable">$token</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;X-Gitlab-Token&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;X-Gitlab-Token&#39;</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">;</span> </span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$allowedTokens</span><span class="token punctuation">[</span><span class="token variable">$token</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//执行 Git Pull 命令</span></span>
<span class="line"><span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;cd <span class="token interpolation"><span class="token variable">$allowedTokens</span><span class="token punctuation">[</span><span class="token variable">$token</span><span class="token punctuation">]</span></span> &amp;&amp; git pull&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这个只是一个基于gitlab-runner的php脚本程序，其实还有更灵活的方法实现，后面再整理一个</p>`,5)]))}const o=s(p,[["render",l],["__file","gitlab-runner使用.html.vue"]]),u=JSON.parse('{"path":"/content/other/git/gitlab-runner%E4%BD%BF%E7%94%A8.html","title":"gitlab-runner使用","lang":"en-US","frontmatter":{"sidebar":false,"title":"gitlab-runner使用","description":"gitlab-runner使用"},"headers":[],"git":{},"filePathRelative":"content/other/git/gitlab-runner使用.md"}');export{o as comp,u as data};
