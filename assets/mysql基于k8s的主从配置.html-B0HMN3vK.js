import{_ as n,c as a,f as l,o as e}from"./app-BB_BIQV8.js";const i={};function c(d,s){return e(),a("div",null,s[0]||(s[0]=[l(`<p>mysql基于k8s的主从配置:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">使用minikube 搭建mysql8.0的集群，一个主节点两个从节点</span>
<span class="line">1.启动minikube</span>
<span class="line">minikube start</span>
<span class="line">  </span>
<span class="line">必须要启动，否则后面 kubectl apply 的时候，会报如下错误:</span>
<span class="line">error: error validating &quot;mysql-rep-cluster.yaml&quot;: error validating data: failed to download openapi: Get &quot;https://192.168.49.2:8443/openapi/v2?timeout=32s&quot;: dial tcp 192.168.49.2:8443: connect: no route to host; if you choose to ignore these errors, turn validation off with --validate=false</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.编写yaml文件，本次文件命名为 mysql-rep-cluster.yaml ， 内容如下:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"># mysql-master-config ConfigMap (主节点配置)</span>
<span class="line">apiVersion: v1</span>
<span class="line">kind: ConfigMap</span>
<span class="line">metadata:</span>
<span class="line">  name: mysql-master-config</span>
<span class="line">  namespace: default</span>
<span class="line">data:</span>
<span class="line">  my.cnf: |</span>
<span class="line">    [mysqld]</span>
<span class="line">    user=mysql</span>
<span class="line">    default_authentication_plugin=mysql_native_password</span>
<span class="line">    bind-address=0.0.0.0</span>
<span class="line">    log_bin=mysql-bin</span>
<span class="line">    server-id=1</span>
<span class="line">    binlog-format=ROW</span>
<span class="line">    expire_logs_days=7</span>
<span class="line">    max_binlog_size=100M</span>
<span class="line">    sql_mode=STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION</span>
<span class="line">    # 禁用默认的 includedir 指令</span>
<span class="line">    loose_mysqlx_port=33060</span>
<span class="line">    !includedir /etc/mysql/conf.d/</span>
<span class="line">    !includedir /etc/mysql/mysql.conf.d/</span>
<span class="line">---</span>
<span class="line"># mysql-slave1-config ConfigMap (从节点1配置)</span>
<span class="line">apiVersion: v1</span>
<span class="line">kind: ConfigMap</span>
<span class="line">metadata:</span>
<span class="line">  name: mysql-slave1-config</span>
<span class="line">  namespace: default</span>
<span class="line">data:</span>
<span class="line">  my.cnf: |</span>
<span class="line">    [mysqld]</span>
<span class="line">    user=mysql</span>
<span class="line">    default_authentication_plugin=mysql_native_password</span>
<span class="line">    bind-address=0.0.0.0</span>
<span class="line">    server-id=2</span>
<span class="line">    relay-log=relay-log-bin</span>
<span class="line">    read-only=1</span>
<span class="line">    log_slave_updates=1</span>
<span class="line">    max_binlog_size=100M</span>
<span class="line">    sql_mode=STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION</span>
<span class="line">    # 禁用默认的 includedir 指令</span>
<span class="line">    loose_mysqlx_port=33060</span>
<span class="line">    !includedir /etc/mysql/conf.d/</span>
<span class="line">    !includedir /etc/mysql/mysql.conf.d/</span>
<span class="line">---</span>
<span class="line"># mysql-slave2-config ConfigMap (从节点2配置)</span>
<span class="line">apiVersion: v1</span>
<span class="line">kind: ConfigMap</span>
<span class="line">metadata:</span>
<span class="line">  name: mysql-slave2-config</span>
<span class="line">  namespace: default</span>
<span class="line">data:</span>
<span class="line">  my.cnf: |</span>
<span class="line">    [mysqld]</span>
<span class="line">    user=mysql</span>
<span class="line">    default_authentication_plugin=mysql_native_password</span>
<span class="line">    bind-address=0.0.0.0</span>
<span class="line">    server-id=3</span>
<span class="line">    relay-log=relay-log-bin</span>
<span class="line">    read-only=1</span>
<span class="line">    log_slave_updates=1</span>
<span class="line">    max_binlog_size=100M</span>
<span class="line">    sql_mode=STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION</span>
<span class="line">    # 禁用默认的 includedir 指令</span>
<span class="line">    loose_mysqlx_port=33060</span>
<span class="line">    !includedir /etc/mysql/conf.d/</span>
<span class="line">    !includedir /etc/mysql/mysql.conf.d/</span>
<span class="line">---</span>
<span class="line"># StatefulSet 配置</span>
<span class="line">apiVersion: apps/v1</span>
<span class="line">kind: StatefulSet</span>
<span class="line">metadata:</span>
<span class="line">  name: mysql-cluster</span>
<span class="line">  namespace: default</span>
<span class="line">spec:</span>
<span class="line">  serviceName: mysql</span>
<span class="line">  replicas: 3</span>
<span class="line">  selector:</span>
<span class="line">    matchLabels:</span>
<span class="line">      app: mysql</span>
<span class="line">  template:</span>
<span class="line">    metadata:</span>
<span class="line">      labels:</span>
<span class="line">        app: mysql</span>
<span class="line">    spec:</span>
<span class="line">      initContainers:</span>
<span class="line">      - name: init-mysql</span>
<span class="line">        image: busybox:1.36</span>
<span class="line">        command:</span>
<span class="line">        - sh</span>
<span class="line">        - -c</span>
<span class="line">        - |</span>
<span class="line">          # 创建必要的目录结构</span>
<span class="line">          mkdir -p /etc/mysql/conf.d</span>
<span class="line">          mkdir -p /etc/mysql/mysql.conf.d</span>
<span class="line">          </span>
<span class="line">          # 根据主机名选择配置</span>
<span class="line">          if [ &quot;\${HOSTNAME}&quot; = &quot;mysql-cluster-0&quot; ]; then</span>
<span class="line">            cp /mnt/master-config/my.cnf /etc/mysql/my.cnf</span>
<span class="line">          elif [ &quot;\${HOSTNAME}&quot; = &quot;mysql-cluster-1&quot; ]; then</span>
<span class="line">            cp /mnt/slave1-config/my.cnf /etc/mysql/my.cnf</span>
<span class="line">          else</span>
<span class="line">            cp /mnt/slave2-config/my.cnf /etc/mysql/my.cnf</span>
<span class="line">          fi</span>
<span class="line">          </span>
<span class="line">          # 设置正确的权限</span>
<span class="line">          chmod -R 755 /etc/mysql</span>
<span class="line">          chown -R 999:999 /etc/mysql</span>
<span class="line">        volumeMounts:</span>
<span class="line">        - name: mysql-master-config</span>
<span class="line">          mountPath: /mnt/master-config</span>
<span class="line">        - name: mysql-slave1-config</span>
<span class="line">          mountPath: /mnt/slave1-config</span>
<span class="line">        - name: mysql-slave2-config</span>
<span class="line">          mountPath: /mnt/slave2-config</span>
<span class="line">        - name: config-dir</span>
<span class="line">          mountPath: /etc/mysql</span>
<span class="line">      containers:</span>
<span class="line">      - name: mysql</span>
<span class="line">        image: mysql:8.0</span>
<span class="line">        env:</span>
<span class="line">        - name: MYSQL_ROOT_PASSWORD</span>
<span class="line">          value: &quot;rootpassword&quot;</span>
<span class="line">        volumeMounts:</span>
<span class="line">        - name: config-dir</span>
<span class="line">          mountPath: /etc/mysql</span>
<span class="line">        - name: mysql-data</span>
<span class="line">          mountPath: /var/lib/mysql</span>
<span class="line">        ports:</span>
<span class="line">        - containerPort: 3306</span>
<span class="line">          name: mysql</span>
<span class="line">      volumes:</span>
<span class="line">      - name: mysql-master-config</span>
<span class="line">        configMap:</span>
<span class="line">          name: mysql-master-config</span>
<span class="line">      - name: mysql-slave1-config</span>
<span class="line">        configMap:</span>
<span class="line">          name: mysql-slave1-config</span>
<span class="line">      - name: mysql-slave2-config</span>
<span class="line">        configMap:</span>
<span class="line">          name: mysql-slave2-config</span>
<span class="line">      - name: config-dir</span>
<span class="line">        emptyDir: {}</span>
<span class="line">  volumeClaimTemplates:</span>
<span class="line">  - metadata:</span>
<span class="line">      name: mysql-data</span>
<span class="line">    spec:</span>
<span class="line">      accessModes: [ &quot;ReadWriteOnce&quot; ]</span>
<span class="line">      resources:</span>
<span class="line">        requests:</span>
<span class="line">          storage: 1Gi</span>
<span class="line">---</span>
<span class="line"># Headless Service</span>
<span class="line">apiVersion: v1</span>
<span class="line">kind: Service</span>
<span class="line">metadata:</span>
<span class="line">  name: mysql</span>
<span class="line">  namespace: default</span>
<span class="line">spec:</span>
<span class="line">  clusterIP: None</span>
<span class="line">  ports:</span>
<span class="line">  - port: 3306</span>
<span class="line">  selector:</span>
<span class="line">    app: mysql</span>
<span class="line">---</span>
<span class="line"># ClusterIP Service</span>
<span class="line">apiVersion: v1</span>
<span class="line">kind: Service</span>
<span class="line">metadata:</span>
<span class="line">  name: mysql-cluster</span>
<span class="line">  namespace: default</span>
<span class="line">spec:</span>
<span class="line">  ports:</span>
<span class="line">  - port: 3306</span>
<span class="line">    targetPort: 3306</span>
<span class="line">  selector:</span>
<span class="line">    app: mysql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">这个 yaml 文件我花了两天时间搞定，其中的 ConfigMap 一开始没有分成三个，只是简单的配置了两个，而且在后面使用的时候，还只是配置了 mysql-master-config, 导致最后三个节点的 server-id=1 都是1，然后在后续查看slave节点的状态的时候，报:</span>
<span class="line">Last_IO_Error: Fatal error: The replica I/O thread stops because source and replica have equal MySQL server ids; these ids must be different for replication to work (or the --replicate-same-server-id option must be used on replica but this does not always make sense; please check the manual before using it). 这意味着要为所有的节点配置不同的 server-id，我这里有三个节点，那就必须要有三个 ConfigMap，以及在后面 StatefulSet 中分别使用这三个配置。</span>
<span class="line">  </span>
<span class="line">3.使用yaml文件创建集群</span>
<span class="line">$ kubectl apply -f mysql-rep-cluster.yaml</span>
<span class="line">  </span>
<span class="line">4.查看pods状态</span>
<span class="line">以下是几种可能出现的情况</span>
<span class="line">  </span>
<span class="line">1&gt;</span>
<span class="line">$ kubectl get pods //一直找不到任何东西</span>
<span class="line">No resources found in default namespace.</span>
<span class="line">  </span>
<span class="line">那么就需要取查看错误了</span>
<span class="line">$ kubectl get statefulsets //这个主要是排除yaml文件错误的，因为很复杂，所以很容易出错</span>
<span class="line">NAME            READY   AGE</span>
<span class="line">mysql-cluster   0/3     9s</span>
<span class="line">  </span>
<span class="line">$ kubectl describe statefulset mysql-cluster  // 这个 mysql-cluster 是上面statefulset的名称</span>
<span class="line">Name:               mysql-cluster</span>
<span class="line">Namespace:          default</span>
<span class="line">CreationTimestamp:  Sat, 28 Dec 2024 00:25:12 +0800</span>
<span class="line">Selector:           app=mysql</span>
<span class="line">Labels:             &lt;none&gt;</span>
<span class="line">Annotations:        &lt;none&gt;</span>
<span class="line">Replicas:           3 desired | 0 total</span>
<span class="line">Update Strategy:    RollingUpdate</span>
<span class="line">  Partition:        0</span>
<span class="line">Pods Status:        0 Running / 0 Waiting / 0 Succeeded / 0 Failed</span>
<span class="line">Pod Template:</span>
<span class="line">  Labels:  app=mysql</span>
<span class="line">  Containers:</span>
<span class="line">   mysql:</span>
<span class="line">    Image:      mysql:8.0</span>
<span class="line">    Port:       &lt;none&gt;</span>
<span class="line">    Host Port:  &lt;none&gt;</span>
<span class="line">    Environment:</span>
<span class="line">      MYSQL_ROOT_PASSWORD:  rootpassword</span>
<span class="line">      MYSQL_DATABASE:       mysql</span>
<span class="line">    Mounts:</span>
<span class="line">      /etc/mysql/custom-my.cnf from mysql-config-volume (rw,path=&quot;my.cnf&quot;)</span>
<span class="line">      /var/lib/mysql-data from mysql-data (rw)</span>
<span class="line">  Volumes:         &lt;none&gt;</span>
<span class="line">  Node-Selectors:  &lt;none&gt;</span>
<span class="line">  Tolerations:     &lt;none&gt;</span>
<span class="line">Volume Claims:</span>
<span class="line">  Name:          mysql-data</span>
<span class="line">  StorageClass:  </span>
<span class="line">  Labels:        &lt;none&gt;</span>
<span class="line">  Annotations:   &lt;none&gt;</span>
<span class="line">  Capacity:      1Gi</span>
<span class="line">  Access Modes:  [ReadWriteOnce]</span>
<span class="line">Events:</span>
<span class="line">  Type     Reason        Age                From                    Message</span>
<span class="line">  ----     ------        ----               ----                    -------</span>
<span class="line">  Warning  FailedCreate  5s (x12 over 16s)  statefulset-controller  create Pod mysql-cluster-0 in StatefulSet mysql-cluster failed error: Pod &quot;mysql-cluster-0&quot; is invalid: spec.containers[0].volumeMounts[0].name: Not found: &quot;mysql-config-volume&quot;</span>
<span class="line">  </span>
<span class="line">这个错误是因为StatefulSet的配置结构不正确。在StatefulSet中，volumes 应该定义在 Pod 模板（spec.template.spec）中，而不是直接在StatefulSet的 spec 下。将 volumes 从 StatefulSet 的 spec 层级移到了 spec.template.spec 下。这个错误其实是我最开始的一个版本里的，我把 volumes 放到了外层。</span>
<span class="line">  </span>
<span class="line">2&gt;</span>
<span class="line">$ kubectl get pods</span>
<span class="line">NAME      READY   STATUS                  RESTARTS   AGE</span>
<span class="line">mysql-0   0/1     Init:ImagePullBackOff   0          2m53s  // 注意刚开始是这样命名的，这是我之前的一个错误，这里只是贴出来</span>
<span class="line">  </span>
<span class="line">然后可以执行如下命令查看这个pod的详细情况，一般都会有异常信息</span>
<span class="line">$ kubectl describe pod mysql-0</span>
<span class="line">Name:             mysql-0</span>
<span class="line">Namespace:        default</span>
<span class="line">Priority:         0</span>
<span class="line">Service Account:  default</span>
<span class="line">Node:             minikube/192.168.49.2</span>
<span class="line">Start Time:       Wed, 25 Dec 2024 23:29:14 +0800</span>
<span class="line">Labels:           app=mysql</span>
<span class="line">                  apps.kubernetes.io/pod-index=0</span>
<span class="line">                  controller-revision-hash=mysql-6759676ccb</span>
<span class="line">                  statefulset.kubernetes.io/pod-name=mysql-0</span>
<span class="line">Annotations:      &lt;none&gt;</span>
<span class="line">Status:           Pending</span>
<span class="line">IP:               10.244.0.29</span>
<span class="line">IPs:</span>
<span class="line">  IP:           10.244.0.29</span>
<span class="line">Controlled By:  StatefulSet/mysql</span>
<span class="line">Init Containers:</span>
<span class="line">  init-mysql:</span>
<span class="line">    Container ID:  </span>
<span class="line">    Image:         mysql:8.0</span>
<span class="line">    Image ID:      </span>
<span class="line">    Port:          &lt;none&gt;</span>
<span class="line">    Host Port:     &lt;none&gt;</span>
<span class="line">    Command:</span>
<span class="line">      bash</span>
<span class="line">      -c</span>
<span class="line">      set -ex</span>
<span class="line">      [[ \`hostname\` =~ -([0-9]+)$ ]] || exit 1</span>
<span class="line">      ordinal=\${BASH_REMATCH[1]}</span>
<span class="line">      echo [mysqld] &gt; /mnt/conf.d/server-id.cnf</span>
<span class="line">      echo server-id=$((ordinal + 1)) &gt;&gt; /mnt/conf.d/server-id.cnf</span>
<span class="line">      if [[ $ordinal -gt 0 ]]; then</span>
<span class="line">        cat &lt;&lt; EOF &gt;&gt; /mnt/conf.d/repl.cnf</span>
<span class="line">        [mysqld]</span>
<span class="line">        gtid_mode=ON</span>
<span class="line">        enforce-gtid-consistency=ON</span>
<span class="line">        EOF</span>
<span class="line">      fi</span>
<span class="line">      if [[ $ordinal -eq 0 ]]; then</span>
<span class="line">        cat &lt;&lt; EOF &gt;&gt; /mnt/conf.d/master.cnf</span>
<span class="line">        [mysqld]</span>
<span class="line">        gtid_mode=ON</span>
<span class="line">        enforce-gtid-consistency=ON</span>
<span class="line">        log-bin=mysql-bin</span>
<span class="line">        binlog_format=ROW</span>
<span class="line">        EOF</span>
<span class="line">      fi</span>
<span class="line">    State:          Waiting</span>
<span class="line">      Reason:       ImagePullBackOff</span>
<span class="line">    Ready:          False</span>
<span class="line">    Restart Count:  0</span>
<span class="line">    Environment:    &lt;none&gt;</span>
<span class="line">    Mounts:</span>
<span class="line">      /mnt/conf.d/ from conf (rw)</span>
<span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-l2pw2 (ro)</span>
<span class="line">  clone-mysql:</span>
<span class="line">    Container ID:  </span>
<span class="line">    Image:         busybox</span>
<span class="line">    Image ID:      </span>
<span class="line">    Port:          &lt;none&gt;</span>
<span class="line">    Host Port:     &lt;none&gt;</span>
<span class="line">    Command:</span>
<span class="line">      /bin/sh</span>
<span class="line">      -c</span>
<span class="line">      if [ ! -d /var/lib/mysql-k8s/mysql ]; then mkdir -p /var/lib/mysql-k8s; fi</span>
<span class="line">    State:          Waiting</span>
<span class="line">      Reason:       PodInitializing</span>
<span class="line">    Ready:          False</span>
<span class="line">    Restart Count:  0</span>
<span class="line">    Environment:    &lt;none&gt;</span>
<span class="line">    Mounts:</span>
<span class="line">      /var/lib/mysql-k8s from data (rw)</span>
<span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-l2pw2 (ro)</span>
<span class="line">Containers:</span>
<span class="line">  mysql:</span>
<span class="line">    Container ID:  </span>
<span class="line">    Image:         mysql:8.0</span>
<span class="line">    Image ID:      </span>
<span class="line">    Port:          3307/TCP</span>
<span class="line">    Host Port:     0/TCP</span>
<span class="line">    Args:</span>
<span class="line">      --datadir=/var/lib/mysql-k8s</span>
<span class="line">      --default-authentication-plugin=mysql_native_password</span>
<span class="line">    State:          Waiting</span>
<span class="line">      Reason:       PodInitializing</span>
<span class="line">    Ready:          False</span>
<span class="line">    Restart Count:  0</span>
<span class="line">    Environment:</span>
<span class="line">      MYSQL_ROOT_PASSWORD:  password123</span>
<span class="line">    Mounts:</span>
<span class="line">      /docker-entrypoint-initdb.d from config-map (rw)</span>
<span class="line">      /etc/mysql/conf.d-k8s from conf (rw)</span>
<span class="line">      /var/lib/mysql-k8s from data (rw)</span>
<span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-l2pw2 (ro)</span>
<span class="line">Conditions:</span>
<span class="line">  Type                        Status</span>
<span class="line">  PodReadyToStartContainers   True </span>
<span class="line">  Initialized                 False </span>
<span class="line">  Ready                       False </span>
<span class="line">  ContainersReady             False </span>
<span class="line">  PodScheduled                True </span>
<span class="line">Volumes:</span>
<span class="line">  data:</span>
<span class="line">    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)</span>
<span class="line">    ClaimName:  data-mysql-0</span>
<span class="line">    ReadOnly:   false</span>
<span class="line">  conf:</span>
<span class="line">    Type:       EmptyDir (a temporary directory that shares a pod&#39;s lifetime)</span>
<span class="line">    Medium:     </span>
<span class="line">    SizeLimit:  &lt;unset&gt;</span>
<span class="line">  config-map:</span>
<span class="line">    Type:      ConfigMap (a volume populated by a ConfigMap)</span>
<span class="line">    Name:      mysql-config</span>
<span class="line">    Optional:  false</span>
<span class="line">  kube-api-access-l2pw2:</span>
<span class="line">    Type:                    Projected (a volume that contains injected data from multiple sources)</span>
<span class="line">    TokenExpirationSeconds:  3607</span>
<span class="line">    ConfigMapName:           kube-root-ca.crt</span>
<span class="line">    ConfigMapOptional:       &lt;nil&gt;</span>
<span class="line">    DownwardAPI:             true</span>
<span class="line">QoS Class:                   BestEffort</span>
<span class="line">Node-Selectors:              &lt;none&gt;</span>
<span class="line">Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s</span>
<span class="line">                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s</span>
<span class="line">Events:</span>
<span class="line">  Type     Reason            Age                    From               Message</span>
<span class="line">  ----     ------            ----                   ----               -------</span>
<span class="line">  Warning  FailedScheduling  4m43s                  default-scheduler  0/1 nodes are available: pod has unbound immediate PersistentVolumeClaims. preemption: 0/1 nodes are available: 1 Preemption is not helpful for scheduling.</span>
<span class="line">  Normal   Scheduled         4m42s                  default-scheduler  Successfully assigned default/mysql-0 to minikube</span>
<span class="line">  Normal   Pulling           2m21s (x4 over 4m40s)  kubelet            Pulling image &quot;mysql:8.0&quot;</span>
<span class="line">  Warning  Failed            95s (x4 over 4m25s)    kubelet            Failed to pull image &quot;mysql:8.0&quot;: Error response from daemon: Get &quot;https://registry-1.docker.io/v2/&quot;: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)</span>
<span class="line">  Warning  Failed            95s (x4 over 4m25s)    kubelet            Error: ErrImagePull</span>
<span class="line">  Warning  Failed            81s (x6 over 4m24s)    kubelet            Error: ImagePullBackOff</span>
<span class="line">  Normal   BackOff           68s (x7 over 4m24s)    kubelet            Back-off pulling image &quot;mysql:8.0&quot;</span>
<span class="line">  </span>
<span class="line">这里明显的可以看到一个问题，镜像拉不下来，其实这个问题的主要原因是，执行 kubectl apply 的时候，会在 minikube 创建的容器环境下执行，在这个 minikube 的容器环境下还有一套 dcoker 环境，但是这个dockr环境目前还不能直接和宿主机的docker 环境一样访问hub docker 仓库，官方文档说是可以设置代理，然而并没有什么用，所以唯一的方法就是在宿主机上拉取镜像到本地，如下:</span>
<span class="line">$ docker pull mysql:8.0</span>
<span class="line">8.0: Pulling from library/mysql</span>
<span class="line">2c0a233485c3: Pull complete </span>
<span class="line">b746eccf8a0b: Pull complete </span>
<span class="line">570d30cf82c5: Pull complete </span>
<span class="line">c7d84c48f09d: Pull complete </span>
<span class="line">e9ecf1ccdd2a: Pull complete </span>
<span class="line">6331406986f7: Pull complete </span>
<span class="line">f93598758d10: Pull complete </span>
<span class="line">6c136cb242f2: Pull complete </span>
<span class="line">d255d476cd34: Pull complete </span>
<span class="line">dbfe60d9fe24: Pull complete </span>
<span class="line">9cb9659be67b: Pull complete </span>
<span class="line">Digest: sha256:d58ac93387f644e4e040c636b8f50494e78e5afc27ca0a87348b2f577da2b7ff</span>
<span class="line">Status: Downloaded newer image for mysql:8.0</span>
<span class="line">docker.io/library/mysql:8.0</span>
<span class="line">  </span>
<span class="line">minikube image load mysql:8.0 //必须要执行这个，把宿主机上拉取的镜像加载到 minikube的docker环境，包括后面的 busybox 也有相似的问题，我直接限定了 busybox:1.36 版本的镜像，然后以相同的方法处理镜像下载的问题，这里固定版本的好处，方便开版本的一致，最好不要使用latest，因为那样会变化。</span>
<span class="line">  </span>
<span class="line">3&gt;</span>
<span class="line">$ kubectl get pods</span>
<span class="line">NAME              READY   STATUS    RESTARTS   AGE</span>
<span class="line">mysql-cluster-0   1/1     Running   0          18s</span>
<span class="line">mysql-cluster-1   1/1     Running   0          14s</span>
<span class="line">mysql-cluster-2   1/1     Running   0          7s</span>
<span class="line">  </span>
<span class="line">这个是正常的，说明成功了。</span>
<span class="line">  </span>
<span class="line">这个:</span>
<span class="line">$ kubectl get statefulsets</span>
<span class="line">NAME            READY   AGE</span>
<span class="line">mysql-cluster   3/3     115m</span>
<span class="line">  </span>
<span class="line">也是正常的了.</span>
<span class="line">  </span>
<span class="line">注意每次处理完错误之后，需要重新apply这个yaml文件，但是需要先执行如下命令:</span>
<span class="line">$ kubectl delete -f mysql-rep-cluster.yaml</span>
<span class="line">  </span>
<span class="line">如果不删除的话，可能会报如下错误:</span>
<span class="line">statefulset.apps/mysql-cluster configured</span>
<span class="line">The Service &quot;mysql-cluster&quot; is invalid: spec.clusterIPs[0]: Invalid value: &quot;None&quot;: may not be set to &#39;None&#39; for NodePort services</span>
<span class="line">  </span>
<span class="line">然后再次执行如下命令:</span>
<span class="line">$ kubectl apply -f mysql-rep-cluster.yaml</span>
<span class="line">  </span>
<span class="line">4.准备配置主从</span>
<span class="line">1&gt;先进入主节点</span>
<span class="line">$ kubectl exec -it mysql-cluster-0 -- mysql -uroot -p  //这里把 mysql-cluster-0 当作主节点</span>
<span class="line">Enter password: </span>
<span class="line">ERROR 2002 (HY000): Can&#39;t connect to local MySQL server through socket &#39;/var/run/mysqld/mysqld.sock&#39; (2)</span>
<span class="line">command terminated with exit code 1</span>
<span class="line">  </span>
<span class="line">2&gt;.查看日志</span>
<span class="line">$ kubectl logs mysql-cluster-0</span>
<span class="line">2024-12-27 15:02:30+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.40-1.el9 started.</span>
<span class="line">2024-12-27 15:02:45+00:00 [Note] [Entrypoint]: Switching to dedicated user &#39;mysql&#39;</span>
<span class="line">2024-12-27 15:02:45+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.40-1.el9 started.</span>
<span class="line">2024-12-27T15:02:45.731465Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.0.40) starting as process 1</span>
<span class="line">2024-12-27T15:02:45.731504Z 0 [ERROR] [MY-010338] [Server] Can&#39;t find error-message file &#39;/usr/share/mysql-8.0/errmsg.sys&#39;. Check error-message file location and &#39;lc-messages-dir&#39; configuration directive.</span>
<span class="line">2024-12-27T15:02:46.140549Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span>
<span class="line">2024-12-27T15:02:53.781089Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span>
<span class="line">2024-12-27T15:02:58.264090Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span>
<span class="line">2024-12-27T15:02:58.264138Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.</span>
<span class="line">2024-12-27T15:02:58.443162Z 0 [Warning] [MY-011810] [Server] Insecure configuration for --pid-file: Location &#39;/var/lib/mysql&#39; in the path is accessible to all OS users. Consider choosing a different directory.</span>
<span class="line">2024-12-27T15:02:58.794415Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#39;::&#39; port: 33060, socket: /var/run/mysqld/mysqlx.sock</span>
<span class="line">2024-12-27T15:02:58.794503Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: &#39;8.0.40&#39;  socket: &#39;/var/lib/mysql/mysql.sock&#39;  port: 3306  MySQL Community Server - GPL.</span>
<span class="line">  </span>
<span class="line">3&gt;.通过/var/lib/mysql/mysql.sock sock文件连接 (默认的是 /var/run/mysqld/mysqld.sock， 但是集群配置的不是这个路径)</span>
<span class="line">$ kubectl exec -it mysql-cluster-0 -- mysql -uroot -p --socket=/var/lib/mysql/mysql.sock</span>
<span class="line">Enter password: </span>
<span class="line">Welcome to the MySQL monitor.  Commands end with ; or \\g.</span>
<span class="line">Your MySQL connection id is 8</span>
<span class="line">Server version: 8.0.40 MySQL Community Server - GPL</span>
<span class="line">  </span>
<span class="line">Copyright (c) 2000, 2024, Oracle and/or its affiliates.</span>
<span class="line">  </span>
<span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span>
<span class="line">affiliates. Other names may be trademarks of their respective</span>
<span class="line">owners.</span>
<span class="line">  </span>
<span class="line">4&gt;.创建一个复制用户</span>
<span class="line">CREATE USER &#39;replicator&#39;@&#39;%&#39; IDENTIFIED BY &#39;replica_password&#39;;</span>
<span class="line">GRANT REPLICATION SLAVE ON *.* TO &#39;replicator&#39;@&#39;%&#39;;</span>
<span class="line">FLUSH PRIVILEGES;</span>
<span class="line">  </span>
<span class="line">mysql&gt; show master status\\G</span>
<span class="line">*************************** 1. row ***************************</span>
<span class="line">             File: mysql-bin.000002</span>
<span class="line">         Position: 2095</span>
<span class="line">     Binlog_Do_DB: </span>
<span class="line"> Binlog_Ignore_DB: </span>
<span class="line">Executed_Gtid_Set: </span>
<span class="line">1 row in set (0.00 sec)</span>
<span class="line">  </span>
<span class="line">5&gt;进入第一个从节点</span>
<span class="line">$ kubectl exec -it mysql-cluster-1 -- mysql -uroot -p --socket=/var/lib/mysql/mysql.sock</span>
<span class="line">mysql&gt; SHOW VARIABLES LIKE &#39;server_id&#39;;</span>
<span class="line">+---------------+-------+</span>
<span class="line">| Variable_name | Value |</span>
<span class="line">+---------------+-------+</span>
<span class="line">| server_id     | 2     |</span>
<span class="line">+---------------+-------+</span>
<span class="line">1 row in set (0.02 sec)</span>
<span class="line"></span>
<span class="line">mysql&gt; SHOW VARIABLES LIKE &#39;log_bin&#39;;</span>
<span class="line">+---------------+-------+</span>
<span class="line">| Variable_name | Value |</span>
<span class="line">+---------------+-------+</span>
<span class="line">| log_bin       | ON    |</span>
<span class="line">+---------------+-------+</span>
<span class="line">1 row in set (0.01 sec)</span>
<span class="line">  </span>
<span class="line">之前的错误配置导致server_id=1，导致很多问题</span>
<span class="line">  </span>
<span class="line">然后配置主从同步账号:</span>
<span class="line">mysql&gt; CHANGE MASTER TO </span>
<span class="line">    -&gt;     MASTER_HOST=&#39;10.244.0.93&#39;,</span>
<span class="line">    -&gt;     MASTER_USER=&#39;replica_user&#39;,</span>
<span class="line">    -&gt;     MASTER_PASSWORD=&#39;replica_password&#39;,</span>
<span class="line">    -&gt;     MASTER_LOG_FILE=&#39;mysql-bin.000002&#39;,</span>
<span class="line">    -&gt;     MASTER_LOG_POS=843;</span>
<span class="line">Query OK, 0 rows affected, 8 warnings (0.81 sec)</span>
<span class="line"></span>
<span class="line">mysql&gt; START SLAVE;</span>
<span class="line">Query OK, 0 rows affected, 1 warning (0.29 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; SHOW SLAVE STATUS\\G</span>
<span class="line">主要看下面两个参数是不是Yes，说明同步配置的没问题，如果不是，就说明有问题</span>
<span class="line">Slave_IO_Running: Yes</span>
<span class="line">Slave_SQL_Running: Yes</span>
<span class="line">  </span>
<span class="line">下麦年就是有问题的:</span>
<span class="line">最开始我的写法如下</span>
<span class="line">mysql&gt; CHANGE MASTER TO</span>
<span class="line">    -&gt;   MASTER_HOST=&#39;mysql-cluster-0.mysql.default.svc.cluster.local&#39;,</span>
<span class="line">    -&gt;   MASTER_USER=&#39;replica_user&#39;,</span>
<span class="line">    -&gt;   MASTER_PASSWORD=&#39;replica_password&#39;,</span>
<span class="line">    -&gt;   MASTER_LOG_FILE=&#39;mysql-bin.000001&#39;,  # </span>
<span class="line">    -&gt;   MASTER_LOG_POS=4;</span>
<span class="line">  </span>
<span class="line">然后slave的状态:</span>
<span class="line">mysql&gt; SHOW SLAVE STATUS\\G</span>
<span class="line">*************************** 1. row ***************************</span>
<span class="line">               Slave_IO_State: Connecting to source</span>
<span class="line">                  Master_Host: mysql-cluster-0.mysql.default.svc.cluster.local</span>
<span class="line">                  Master_User: replica_user</span>
<span class="line">                  Master_Port: 3306</span>
<span class="line">                Connect_Retry: 60</span>
<span class="line">              Master_Log_File: mysql-bin.000001</span>
<span class="line">          Read_Master_Log_Pos: 4</span>
<span class="line">               Relay_Log_File: mysql-cluster-1-relay-bin.000001</span>
<span class="line">                Relay_Log_Pos: 4</span>
<span class="line">        Relay_Master_Log_File: mysql-bin.000001</span>
<span class="line">             Slave_IO_Running: Connecting</span>
<span class="line">            Slave_SQL_Running: Yes</span>
<span class="line">              Replicate_Do_DB: </span>
<span class="line">          Replicate_Ignore_DB: </span>
<span class="line">           Replicate_Do_Table: </span>
<span class="line">       Replicate_Ignore_Table: </span>
<span class="line">      Replicate_Wild_Do_Table: </span>
<span class="line">  Replicate_Wild_Ignore_Table: </span>
<span class="line">                   Last_Errno: 0</span>
<span class="line">                   Last_Error: </span>
<span class="line">                 Skip_Counter: 0</span>
<span class="line">          Exec_Master_Log_Pos: 4</span>
<span class="line">              Relay_Log_Space: 157</span>
<span class="line">              Until_Condition: None</span>
<span class="line">               Until_Log_File: </span>
<span class="line">                Until_Log_Pos: 0</span>
<span class="line">           Master_SSL_Allowed: No</span>
<span class="line">           Master_SSL_CA_File: </span>
<span class="line">           Master_SSL_CA_Path: </span>
<span class="line">              Master_SSL_Cert: </span>
<span class="line">            Master_SSL_Cipher: </span>
<span class="line">               Master_SSL_Key: </span>
<span class="line">        Seconds_Behind_Master: NULL</span>
<span class="line">Master_SSL_Verify_Server_Cert: No</span>
<span class="line">                Last_IO_Errno: 2005</span>
<span class="line">                Last_IO_Error: Error connecting to source &#39;replica_user@mysql-cluster-0.mysql.default.svc.cluster.local:3306&#39;. This was attempt 1/86400, with a delay of 60 seconds between attempts. Message: Unknown MySQL server host &#39;mysql-cluster-0.mysql.default.svc.cluster.local&#39; (-2)</span>
<span class="line">               Last_SQL_Errno: 0</span>
<span class="line">               Last_SQL_Error: </span>
<span class="line">  Replicate_Ignore_Server_Ids: </span>
<span class="line">             Master_Server_Id: 0</span>
<span class="line">                  Master_UUID: </span>
<span class="line">             Master_Info_File: mysql.slave_master_info</span>
<span class="line">                    SQL_Delay: 0</span>
<span class="line">          SQL_Remaining_Delay: NULL</span>
<span class="line">      Slave_SQL_Running_State: Replica has read all relay log; waiting for more updates</span>
<span class="line">           Master_Retry_Count: 86400</span>
<span class="line">                  Master_Bind: </span>
<span class="line">      Last_IO_Error_Timestamp: 241227 16:53:13</span>
<span class="line">     Last_SQL_Error_Timestamp: </span>
<span class="line">               Master_SSL_Crl: </span>
<span class="line">           Master_SSL_Crlpath: </span>
<span class="line">           Retrieved_Gtid_Set: </span>
<span class="line">            Executed_Gtid_Set: </span>
<span class="line">                Auto_Position: 0</span>
<span class="line">         Replicate_Rewrite_DB: </span>
<span class="line">                 Channel_Name: </span>
<span class="line">           Master_TLS_Version: </span>
<span class="line">       Master_public_key_path: </span>
<span class="line">        Get_master_public_key: 0</span>
<span class="line">            Network_Namespace: </span>
<span class="line">1 row in set, 1 warning (0.00 sec)</span>
<span class="line">  </span>
<span class="line">这里有个 Last_IO_Error，就是不能连接master的问题，然后不管我怎么修改MASTER_HOST,都有问题，最后才找到下面的答案:</span>
<span class="line">DNS 解析的主机名问题:</span>
<span class="line">mysql-cluster-0.mysql.default.svc.cluster.local 是通过 ClusterIP 类型的 Service 提供的 DNS 解析。当 Service 类型为 NodePort 时，它不直接支持这种集群内的主机名解析。</span>
<span class="line">  </span>
<span class="line">跨 Pod 通信的问题:</span>
<span class="line">NodePort 主要用于从集群外部访问服务，而不是集群内部 Pod 的通信。在 StatefulSet 的场景中，主从之间的通信通常依赖于 ClusterIP。</span>
<span class="line">  </span>
<span class="line">因为我最开始是将service 配置的NodePort类型，所以一直有问题，后来改了还几个版本，使用ClusterIP类型才解决问题</span>
<span class="line">  </span>
<span class="line">最后我决定直接查看master的ip,将host配置为ip，如下:</span>
<span class="line">$ kubectl describe svc mysql-cluster</span>
<span class="line">Name:                     mysql-cluster</span>
<span class="line">Namespace:                default</span>
<span class="line">Labels:                   &lt;none&gt;</span>
<span class="line">Annotations:              &lt;none&gt;</span>
<span class="line">Selector:                 app=mysql</span>
<span class="line">Type:                     ClusterIP</span>
<span class="line">IP Family Policy:         SingleStack</span>
<span class="line">IP Families:              IPv4</span>
<span class="line">IP:                       10.102.80.128</span>
<span class="line">IPs:                      10.102.80.128</span>
<span class="line">Port:                     &lt;unset&gt;  3306/TCP</span>
<span class="line">TargetPort:               3306/TCP</span>
<span class="line">Endpoints:                10.244.0.93:3306,10.244.0.94:3306,10.244.0.95:3306</span>
<span class="line">Session Affinity:         None</span>
<span class="line">Internal Traffic Policy:  Cluster</span>
<span class="line">Events:                   &lt;none&gt;</span>
<span class="line">  </span>
<span class="line">10.244.0.93 就是master的ip，但是这样有个缺点，就是ip可能会变化，所以配置成 mysql-cluster-0.mysql.default.svc.cluster.local 最好，但是好像还是有问题，关于这个问题还需要继续探讨...</span>
<span class="line">  </span>
<span class="line">当配置为ip之前，执行如下操作:</span>
<span class="line">mysql&gt; stop slave;</span>
<span class="line">Query OK, 0 rows affected, 1 warning (0.19 sec)</span>
<span class="line">  </span>
<span class="line">然后:</span>
<span class="line">mysql&gt; CHANGE MASTER TO </span>
<span class="line">    -&gt;     MASTER_HOST=&#39;10.244.0.93&#39;,</span>
<span class="line">    -&gt;     MASTER_USER=&#39;replica_user&#39;,</span>
<span class="line">    -&gt;     MASTER_PASSWORD=&#39;replica_password&#39;,</span>
<span class="line">    -&gt;     MASTER_LOG_FILE=&#39;mysql-bin.000002&#39;,</span>
<span class="line">    -&gt;     MASTER_LOG_POS=843;</span>
<span class="line">Query OK, 0 rows affected, 8 warnings (0.81 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; start slave;</span>
<span class="line">Query OK, 0 rows affected, 1 warning (0.19 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; show slave status\\G</span>
<span class="line">*************************** 1. row ***************************</span>
<span class="line">               Slave_IO_State: Waiting for source to send event</span>
<span class="line">                  Master_Host: 10.244.0.93</span>
<span class="line">                  Master_User: replica_user</span>
<span class="line">                  Master_Port: 3306</span>
<span class="line">                Connect_Retry: 60</span>
<span class="line">              Master_Log_File: mysql-bin.000002</span>
<span class="line">          Read_Master_Log_Pos: 843</span>
<span class="line">               Relay_Log_File: relay-log-bin.000002</span>
<span class="line">                Relay_Log_Pos: 326</span>
<span class="line">        Relay_Master_Log_File: mysql-bin.000002</span>
<span class="line">             Slave_IO_Running: Yes</span>
<span class="line">            Slave_SQL_Running: Yes</span>
<span class="line">              Replicate_Do_DB: </span>
<span class="line">          Replicate_Ignore_DB: </span>
<span class="line">           Replicate_Do_Table: </span>
<span class="line">       Replicate_Ignore_Table: </span>
<span class="line">      Replicate_Wild_Do_Table: </span>
<span class="line">  Replicate_Wild_Ignore_Table: </span>
<span class="line">                   Last_Errno: 0</span>
<span class="line">                   Last_Error: </span>
<span class="line">                 Skip_Counter: 0</span>
<span class="line">          Exec_Master_Log_Pos: 843</span>
<span class="line">              Relay_Log_Space: 534</span>
<span class="line">              Until_Condition: None</span>
<span class="line">               Until_Log_File: </span>
<span class="line">                Until_Log_Pos: 0</span>
<span class="line">           Master_SSL_Allowed: No</span>
<span class="line">           Master_SSL_CA_File: </span>
<span class="line">           Master_SSL_CA_Path: </span>
<span class="line">              Master_SSL_Cert: </span>
<span class="line">            Master_SSL_Cipher: </span>
<span class="line">               Master_SSL_Key: </span>
<span class="line">        Seconds_Behind_Master: 0</span>
<span class="line">Master_SSL_Verify_Server_Cert: No</span>
<span class="line">                Last_IO_Errno: 0</span>
<span class="line">                Last_IO_Error: </span>
<span class="line">               Last_SQL_Errno: 0</span>
<span class="line">               Last_SQL_Error: </span>
<span class="line">  Replicate_Ignore_Server_Ids: </span>
<span class="line">             Master_Server_Id: 1</span>
<span class="line">                  Master_UUID: 16b0a150-c397-11ef-ba7e-c6314bb59e6f</span>
<span class="line">             Master_Info_File: mysql.slave_master_info</span>
<span class="line">                    SQL_Delay: 0</span>
<span class="line">          SQL_Remaining_Delay: NULL</span>
<span class="line">      Slave_SQL_Running_State: Replica has read all relay log; waiting for more updates</span>
<span class="line">           Master_Retry_Count: 86400</span>
<span class="line">                  Master_Bind: </span>
<span class="line">      Last_IO_Error_Timestamp: </span>
<span class="line">     Last_SQL_Error_Timestamp: </span>
<span class="line">               Master_SSL_Crl: </span>
<span class="line">           Master_SSL_Crlpath: </span>
<span class="line">           Retrieved_Gtid_Set: </span>
<span class="line">            Executed_Gtid_Set: </span>
<span class="line">                Auto_Position: 0</span>
<span class="line">         Replicate_Rewrite_DB: </span>
<span class="line">                 Channel_Name: </span>
<span class="line">           Master_TLS_Version: </span>
<span class="line">       Master_public_key_path: </span>
<span class="line">        Get_master_public_key: 0</span>
<span class="line">            Network_Namespace: </span>
<span class="line">1 row in set, 1 warning (0.00 sec)</span>
<span class="line">  </span>
<span class="line">现在都是Yes了，基本可以确定主从配置完成，对第二个从节点也是类似的操作</span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">[一天之后]，我重新启动宿主机，发现 show slave status\\G 报如下错误:</span>
<span class="line">Last_IO_Error: Error connecting to source &#39;replica_user@10.244.0.93:3306&#39;. This was attempt 10/86400, with a delay of 60 seconds between attempts. Message: Can&#39;t connect to MySQL server on &#39;10.244.0.93:3306&#39; (113)</span>
<span class="line"></span>
<span class="line">果真，重启服务器之后，master 的 ip 发生了变化， slave 无法连接，所以这个 master_host 要配置为名称，经过我的测试，改为如下配置就可以:</span>
<span class="line">mysql&gt; CHANGE MASTER TO </span>
<span class="line">    -&gt;     MASTER_HOST=&#39;mysql-cluster-0.mysql&#39;,</span>
<span class="line">    -&gt;     MASTER_USER=&#39;replica_user&#39;,</span>
<span class="line">    -&gt;     MASTER_PASSWORD=&#39;replica_password&#39;,</span>
<span class="line">    -&gt;     MASTER_LOG_FILE=&#39;mysql-bin.000003&#39;,</span>
<span class="line">    -&gt;     MASTER_LOG_POS=157;</span>
<span class="line">  </span>
<span class="line">配置为 mysql-cluster-0.mysql, 而不是 mysql-cluster-0.mysql.default.svc.cluster.local,</span>
<span class="line">再次查看:</span>
<span class="line">mysql&gt; show slave status\\G</span>
<span class="line">*************************** 1. row ***************************</span>
<span class="line">               Slave_IO_State: Waiting for source to send event</span>
<span class="line">                  Master_Host: mysql-cluster-0.mysql</span>
<span class="line">                  Master_User: replica_user</span>
<span class="line">                  Master_Port: 3306</span>
<span class="line">                Connect_Retry: 60</span>
<span class="line">              Master_Log_File: mysql-bin.000003</span>
<span class="line">          Read_Master_Log_Pos: 472</span>
<span class="line">               Relay_Log_File: relay-log-bin.000002</span>
<span class="line">                Relay_Log_Pos: 326</span>
<span class="line">        Relay_Master_Log_File: mysql-bin.000003</span>
<span class="line">             Slave_IO_Running: Yes</span>
<span class="line">            Slave_SQL_Running: Yes</span>
<span class="line">              Replicate_Do_DB: </span>
<span class="line">          Replicate_Ignore_DB: </span>
<span class="line">           Replicate_Do_Table: </span>
<span class="line">       Replicate_Ignore_Table: </span>
<span class="line">      Replicate_Wild_Do_Table: </span>
<span class="line">  Replicate_Wild_Ignore_Table: </span>
<span class="line">                   Last_Errno: 0</span>
<span class="line">                   Last_Error: </span>
<span class="line">                 Skip_Counter: 0</span>
<span class="line">          Exec_Master_Log_Pos: 472</span>
<span class="line">              Relay_Log_Space: 534</span>
<span class="line">              Until_Condition: None</span>
<span class="line">               Until_Log_File: </span>
<span class="line">                Until_Log_Pos: 0</span>
<span class="line">           Master_SSL_Allowed: No</span>
<span class="line">           Master_SSL_CA_File: </span>
<span class="line">           Master_SSL_CA_Path: </span>
<span class="line">              Master_SSL_Cert: </span>
<span class="line">            Master_SSL_Cipher: </span>
<span class="line">               Master_SSL_Key: </span>
<span class="line">        Seconds_Behind_Master: 0</span>
<span class="line">Master_SSL_Verify_Server_Cert: No</span>
<span class="line">                Last_IO_Errno: 0</span>
<span class="line">                Last_IO_Error: </span>
<span class="line">               Last_SQL_Errno: 0</span>
<span class="line">               Last_SQL_Error: </span>
<span class="line">  Replicate_Ignore_Server_Ids: </span>
<span class="line">             Master_Server_Id: 1</span>
<span class="line">                  Master_UUID: 16b0a150-c397-11ef-ba7e-c6314bb59e6f</span>
<span class="line">             Master_Info_File: mysql.slave_master_info</span>
<span class="line">                    SQL_Delay: 0</span>
<span class="line">          SQL_Remaining_Delay: NULL</span>
<span class="line">      Slave_SQL_Running_State: Replica has read all relay log; waiting for more updates</span>
<span class="line">           Master_Retry_Count: 86400</span>
<span class="line">                  Master_Bind: </span>
<span class="line">      Last_IO_Error_Timestamp: </span>
<span class="line">     Last_SQL_Error_Timestamp: </span>
<span class="line">               Master_SSL_Crl: </span>
<span class="line">           Master_SSL_Crlpath: </span>
<span class="line">           Retrieved_Gtid_Set: </span>
<span class="line">            Executed_Gtid_Set: </span>
<span class="line">                Auto_Position: 0</span>
<span class="line">         Replicate_Rewrite_DB: </span>
<span class="line">                 Channel_Name: </span>
<span class="line">           Master_TLS_Version: </span>
<span class="line">       Master_public_key_path: </span>
<span class="line">        Get_master_public_key: 0</span>
<span class="line">            Network_Namespace: </span>
<span class="line">1 row in set, 1 warning (0.00 sec)</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">数据验证:</span>
<span class="line">主:</span>
<span class="line">mysql&gt; show databases;</span>
<span class="line">+--------------------+</span>
<span class="line">| Database           |</span>
<span class="line">+--------------------+</span>
<span class="line">| information_schema |</span>
<span class="line">| mysql              |</span>
<span class="line">| performance_schema |</span>
<span class="line">| sys                |</span>
<span class="line">| testdb             |</span>
<span class="line">+--------------------+</span>
<span class="line">5 rows in set (0.00 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; use testdb;</span>
<span class="line">Database changed</span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; show tables;</span>
<span class="line">Empty set (0.00 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; CREATE TABLE users (</span>
<span class="line">    -&gt;     id INT PRIMARY KEY AUTO_INCREMENT,</span>
<span class="line">    -&gt;     name VARCHAR(50),</span>
<span class="line">    -&gt;     created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>
<span class="line">    -&gt; );</span>
<span class="line">Query OK, 0 rows affected (1.13 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; INSERT INTO users (name) VALUES (&#39;test1&#39;), (&#39;test2&#39;);</span>
<span class="line">Query OK, 2 rows affected (0.14 sec)</span>
<span class="line">Records: 2  Duplicates: 0  Warnings: 0</span>
<span class="line">  </span>
<span class="line">mysql&gt; SELECT * FROM users;</span>
<span class="line">+----+-------+---------------------+</span>
<span class="line">| id | name  | created_at          |</span>
<span class="line">+----+-------+---------------------+</span>
<span class="line">|  1 | test1 | 2024-12-28 14:13:19 |</span>
<span class="line">|  2 | test2 | 2024-12-28 14:13:19 |</span>
<span class="line">+----+-------+---------------------+</span>
<span class="line">2 rows in set (0.00 sec)</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">从:</span>
<span class="line">mysql&gt; show databases;</span>
<span class="line">+--------------------+</span>
<span class="line">| Database           |</span>
<span class="line">+--------------------+</span>
<span class="line">| information_schema |</span>
<span class="line">| mysql              |</span>
<span class="line">| performance_schema |</span>
<span class="line">| sys                |</span>
<span class="line">| testdb             |</span>
<span class="line">+--------------------+</span>
<span class="line">5 rows in set (0.00 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; use testdb;</span>
<span class="line">Reading table information for completion of table and column names</span>
<span class="line">You can turn off this feature to get a quicker startup with -A</span>
<span class="line">  </span>
<span class="line">Database changed</span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; show tables;</span>
<span class="line">+------------------+</span>
<span class="line">| Tables_in_testdb |</span>
<span class="line">+------------------+</span>
<span class="line">| users            |</span>
<span class="line">+------------------+</span>
<span class="line">1 row in set (0.00 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; select * from users;</span>
<span class="line">+----+-------+---------------------+</span>
<span class="line">| id | name  | created_at          |</span>
<span class="line">+----+-------+---------------------+</span>
<span class="line">|  1 | test1 | 2024-12-28 14:13:19 |</span>
<span class="line">|  2 | test2 | 2024-12-28 14:13:19 |</span>
<span class="line">+----+-------+---------------------+</span>
<span class="line">2 rows in set (0.00 sec)</span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">从库用户设置:</span>
<span class="line">设置了read_only的slave节点:</span>
<span class="line">mysql&gt; SHOW VARIABLES LIKE &#39;read_only&#39;;</span>
<span class="line">+---------------+-------+</span>
<span class="line">| Variable_name | Value |</span>
<span class="line">+---------------+-------+</span>
<span class="line">| read_only     | ON    |</span>
<span class="line">+---------------+-------+</span>
<span class="line">1 row in set (0.00 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; SHOW VARIABLES LIKE &#39;super_read_only&#39;;</span>
<span class="line">+-----------------+-------+</span>
<span class="line">| Variable_name   | Value |</span>
<span class="line">+-----------------+-------+</span>
<span class="line">| super_read_only | OFF   |</span>
<span class="line">+-----------------+-------+</span>
<span class="line">1 row in set (0.00 sec)</span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">发现可以删除数据:</span>
<span class="line">mysql&gt; select * from users;</span>
<span class="line">+----+-------+---------------------+</span>
<span class="line">| id | name  | created_at          |</span>
<span class="line">+----+-------+---------------------+</span>
<span class="line">|  1 | test1 | 2024-12-28 14:13:19 |</span>
<span class="line">|  3 | test3 | 2024-12-28 14:17:24 |</span>
<span class="line">|  4 | test4 | 2024-12-28 14:17:24 |</span>
<span class="line">+----+-------+---------------------+</span>
<span class="line">3 rows in set (0.00 sec)</span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">mysql&gt; delete from users where id =3;</span>
<span class="line">Query OK, 1 row affected (0.09 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; </span>
<span class="line">mysql&gt; select * from users;</span>
<span class="line">+----+-------+---------------------+</span>
<span class="line">| id | name  | created_at          |</span>
<span class="line">+----+-------+---------------------+</span>
<span class="line">|  1 | test1 | 2024-12-28 14:13:19 |</span>
<span class="line">|  4 | test4 | 2024-12-28 14:17:24 |</span>
<span class="line">+----+-------+---------------------+</span>
<span class="line">2 rows in set (0.00 sec)</span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">创建一个普通用户:</span>
<span class="line">CREATE USER &#39;readonly_user1&#39;@&#39;%&#39; IDENTIFIED BY &#39;password_read_only&#39;;</span>
<span class="line">GRANT SELECT ON *.* TO &#39;readonly_user1&#39;@&#39;%&#39;;</span>
<span class="line">FLUSH PRIVILEGES;</span>
<span class="line">  </span>
<span class="line">SHOW GRANTS FOR &#39;readonly_user1&#39;@&#39;%&#39;;</span>
<span class="line">  </span>
<span class="line">mysql&gt; CREATE USER &#39;readonly_user1&#39;@&#39;%&#39; IDENTIFIED BY &#39;password_read_only&#39;;</span>
<span class="line">Query OK, 0 rows affected (0.09 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; GRANT SELECT ON *.* TO &#39;readonly_user1&#39;@&#39;%&#39;;</span>
<span class="line">Query OK, 0 rows affected (0.07 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; FLUSH PRIVILEGES;</span>
<span class="line">Query OK, 0 rows affected (0.02 sec)</span>
<span class="line">  </span>
<span class="line">mysql&gt; SHOW GRANTS FOR &#39;readonly_user1&#39;@&#39;%&#39;;</span>
<span class="line">+---------------------------------------------+</span>
<span class="line">| Grants for readonly_user1@%                 |</span>
<span class="line">+---------------------------------------------+</span>
<span class="line">| GRANT SELECT ON *.* TO \`readonly_user1\`@\`%\` |</span>
<span class="line">+---------------------------------------------+</span>
<span class="line">1 row in set (0.00 sec)</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">使用这个普通用户登陆:</span>
<span class="line">$ kubectl exec -it mysql-cluster-2 -- mysql -ureadonly_user1 -p --socket=/var/lib/mysql/mysql.sock</span>
<span class="line">  </span>
<span class="line">mysql&gt; delete from users where id = 4;</span>
<span class="line">ERROR 1290 (HY000): The MySQL server is running with the --read-only option so it cannot execute this statement</span>
<span class="line">  </span>
<span class="line">现在普通用户不能删除数据，符合需求. 对于普通用户 read_only 设置会生效，如果设置了ON, 那么这个用户只能取数据。但是对于 super user 比如 root 是不生效的，super user 是由 super_read_only 来决定的。</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">资源查看:</span>
<span class="line">$ kubectl get statefulsets</span>
<span class="line">NAME            READY   AGE</span>
<span class="line">mysql-cluster   3/3     174m</span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">$ kubectl get svc</span>
<span class="line">NAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span>
<span class="line">kubernetes      ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP    18d</span>
<span class="line">mysql           ClusterIP   None            &lt;none&gt;        3306/TCP   174m</span>
<span class="line">mysql-cluster   ClusterIP   10.102.80.128   &lt;none&gt;        3306/TCP   174m</span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">$ kubectl get pods</span>
<span class="line">NAME              READY   STATUS    RESTARTS   AGE</span>
<span class="line">mysql-cluster-0   1/1     Running   0          175m</span>
<span class="line">mysql-cluster-1   1/1     Running   0          175m</span>
<span class="line">mysql-cluster-2   1/1     Running   0          175m</span>
<span class="line"></span>
<span class="line">  </span>
<span class="line">linux命令补充:</span>
<span class="line">vim批量删除操作:</span>
<span class="line">批量部分删除</span>
<span class="line">v 选行，然后 d</span>
<span class="line">  </span>
<span class="line">批量全部删除</span>
<span class="line">:%d</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5)]))}const v=n(i,[["render",c],["__file","mysql基于k8s的主从配置.html.vue"]]),r=JSON.parse('{"path":"/content/database/mysql/mysql%E5%9F%BA%E4%BA%8Ek8s%E7%9A%84%E4%B8%BB%E4%BB%8E%E9%85%8D%E7%BD%AE.html","title":"mysql基于k8s的主从配置","lang":"en-US","frontmatter":{"sidebar":false,"title":"mysql基于k8s的主从配置","description":"mysql基于k8s的主从配置"},"headers":[],"git":{},"filePathRelative":"content/database/mysql/mysql基于k8s的主从配置.md"}');export{v as comp,r as data};
