import{_ as n,c as e,d as l,o as i}from"./app-CHrRue27.js";const a={};function d(t,s){return i(),e("div",null,s[0]||(s[0]=[l(`<p>solr9.6搜索服务的使用:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">官网下载solr-9.6.0.tgz</span>
<span class="line">1&gt;解压</span>
<span class="line">tar zxvf ./solr-9.6.0.tgz</span>
<span class="line">  </span>
<span class="line">2&gt;运行自带的example项目</span>
<span class="line">k8s@HPDEV-31:/usr/local/solr-9.6.0$ sudo bin/solr start -e techproducts -p 8985 -force</span>
<span class="line"></span>
<span class="line">这里使用 -force:</span>
<span class="line">WARNING: Starting Solr as the root user is a security risk and not considered best practice. Exiting.</span>
<span class="line">         Please consult the Reference Guide. To override this check, start with argument &#39;-force&#39;</span>
<span class="line"></span>
<span class="line">ERROR: Failed to start Solr using command: &quot;bin/solr&quot; start -p 8985 -s &quot;example/techproducts/solr&quot; Exception : org.apache.commons.exec.ExecuteException: Process exited with an error: 1 (Exit value: 1)</span>
<span class="line">  </span>
<span class="line">3&gt;停止之前的</span>
<span class="line">k8s@HPDEV-31:/usr/local/solr-9.6.0$ sudo bin/solr stop -p 8985 -force</span>
<span class="line">  </span>
<span class="line">4&gt;再次启动</span>
<span class="line">k8s@HPDEV-31:/usr/local/solr-9.6.0$ sudo bin/solr start -p 8985 -force</span>
<span class="line">*** [WARN] *** Your open file limit is currently 1024.  </span>
<span class="line"> It should be set to 65000 to avoid operational disruption. </span>
<span class="line"> If you no longer wish to see this warning, set SOLR_ULIMIT_CHECKS to false in your profile or solr.in.sh</span>
<span class="line">Java 17 detected. Enabled workaround for SOLR-16463</span>
<span class="line">Waiting up to 180 seconds to see Solr running on port 8985 [|]  </span>
<span class="line">Started Solr server on port 8985 (pid=35159). Happy searching!</span>
<span class="line">  </span>
<span class="line">5&gt;创建core(必须先启动solr)</span>
<span class="line">k8s@HPDEV-31:/usr/local/solr-9.6.0$ sudo bin/solr create -c conferences_core -p 8985 -force</span>
<span class="line">WARNING: Using _default configset with data driven schema functionality. NOT RECOMMENDED for production use.</span>
<span class="line">         To turn off: bin/solr config -c conferences_core -p 8985 -action set-user-property -property update.autoCreateFields -value false</span>
<span class="line"></span>
<span class="line">Created new core &#39;conferences_core&#39;</span>
<span class="line"></span>
<span class="line">默认创建路径如下：</span>
<span class="line">/usr/local/solr-9.6.0/server/solr/conferences_core</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">参考:https://solr.apache.org/guide/solr/latest/deployment-guide/installing-solr.html</span>
<span class="line">  </span>
<span class="line">6&gt;修改core的 schema, 添加字段</span>
<span class="line">k8s@HPDEV-31:/usr/local/solr-9.6.0/server/solr/conferences_core/conf$ sudo vim managed-schema.xml</span>
<span class="line"></span>
<span class="line">&lt;field name=&quot;id&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;true&quot; required=&quot;true&quot; multiValued=&quot;false&quot; /&gt;</span>
<span class="line">&lt;!-- docValues are enabled by default for long type so we don&#39;t need to index the version field  --&gt;</span>
<span class="line">&lt;field name=&quot;age&quot; type=&quot;pint&quot; indexed=&quot;true&quot; stored=&quot;true&quot; /&gt;</span>
<span class="line">&lt;field name=&quot;description&quot; type=&quot;text_ik&quot; indexed=&quot;true&quot; stored=&quot;true&quot;  /&gt;  // 注意我第一次没有安装ik分词器，默认好像没有 type为 text_ik，但是我安装完ik分词器之后就有了，所以下次使用的时候，还是先安装ik,然后再倒数据，同时如果后来重新改了这个记得relaod core</span>
<span class="line">&lt;field name=&quot;create_time&quot; type=&quot;pdate&quot; indexed=&quot;true&quot; stored=&quot;true&quot;  /&gt;</span>
<span class="line">&lt;field name=&quot;update_time&quot; type=&quot;pdate&quot; indexed=&quot;true&quot; stored=&quot;true&quot;  /&gt;</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">然后 reload，结果一直报错，于是把 create_time 改为 createTime， update_time 改为 updateTime 就好了(xml格式的文件问题很多坑...)</span>
<span class="line">当然官网还有schema api: https://solr.apache.org/guide/solr/latest/indexing-guide/schema-api.html</span>
<span class="line">我通过api给schema添加了一个新的字段，第一次添加的时候没有选择 indexed=&quot;true&quot;, 结果导致 description 不能插入，一直报: from index options=docs to inconsistent index options=docs_and_freqs_and_positions 问题，但是后来加上了indexed=&quot;true&quot; 就没问题了,这个属性必须要有，即使是设置为indexed=&quot;false&quot;； 同时还注意到当新增 filed 之后，之前查询的数据是不包含这 field的，只有后面新增的数据中包含了这个field, 那么查询的数据才会包含这个新增的field.</span>
<span class="line">  </span>
<span class="line">7&gt;添加数据(选择Documents操作 /update)</span>
<span class="line">目前添加的机制是，如果添加的数据的 id  不存在，那么就会新增，否则更新数据，比如：</span>
<span class="line"></span>
<span class="line">{&quot;id&quot;: &quot;11&quot;,&quot;age&quot;: 40,&quot;description&quot;: &quot;创造了古代浪漫主义文学高峰、歌行体和七绝达到后人难及的高度&quot;},</span>
<span class="line">{&quot;id&quot;: &quot;12&quot;,&quot;age&quot;: 31,&quot;description&quot;: &quot;唐代伟大的现实主义文学作家，唐诗思想艺术的集大成者&quot;}</span>
<span class="line">{&quot;id&quot;: &quot;13&quot;,&quot;age&quot;: 31,&quot;description&quot;: &quot;头孢不叫阿莫西林。头孢和阿莫西林属于两种不同的抗菌药物，患者需要在医生指导下服用。若是出现身体不适，要及时就医治疗&quot;}</span>
<span class="line">{&quot;id&quot;: &quot;14&quot;,&quot;age&quot;: 68,&quot;description&quot;: &quot;阿莫西林属于广谱青霉素类抗生素，对肺炎链球菌、溶血性链球菌、不产青霉素酶葡萄球菌、粪肠球菌、大肠埃希菌等均具有良好的抗菌活性。有片剂、颗粒剂等多种剂型，临床上适用于敏感菌所致的皮肤及软组织感染、呼吸道感染、胃肠道感染、尿路感染、败血症等&quot;}</span>
<span class="line">{&quot;id&quot;: &quot;15&quot;,&quot;age&quot;: 52,&quot;description&quot;: &quot;如果患者无甲状腺疾病相关症状，且其他检查指标均正常，则说明甲状腺功能正常。如果患者出现甲状腺功能亢进症或甲状腺功能减退症的相关症状，且伴有促甲状腺激素（TSH）、甲状腺抗体等其他甲状腺指标异常，则说明甲状腺功能异常，需要查明原因后进行相应的治疗&quot;}</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">报错，需要 _vesion_ 字段(我猜测是每个document都必须有一个版本字段的原因是，为了记录最近操作)，直接客户端选择schema,然后添加这个字段(string类型即可)即可，再执行添加json数据，不报错.</span>
<span class="line">我发现插入完数据之后，再 sudo vim managed-schema.xml，里面的内容也变了.</span>
<span class="line"></span>
<span class="line">官网 update document api: https://solr.apache.org/guide/solr/latest/indexing-guide/indexing-with-update-handlers.html</span>
<span class="line">关于各个 field 属性的介绍: https://solr.apache.org/guide/solr/latest/indexing-guide/fields.html</span>
<span class="line">  </span>
<span class="line">8&gt;条件查询报错:Undefined field _text_</span>
<span class="line">解决方法:https://opensolr.com/faq/view/opensolr-wiki-q-a/104/undefined-field-_text_</span>
<span class="line">但是执行之后又会报其它错误,又恢复了,最好直接添加一个 _text_ 字段，这样不会报错，主要是添加这个_text_以后，对于查询参数 q, 可以直接写任何东西,不用指定某个字段，那么会走默认字段，就是这里的_text_，其实上面的链接里有，打开配置会发现.但是一般 _text_字段又没有数据,所以什么也查不到. 参考这个初始化配置:https://solr.apache.org/guide/solr/latest/configuration-guide/initparams.html</span>
<span class="line"></span>
<span class="line">我发现查询应该这么用:</span>
<span class="line">比如查询 description的q参数</span>
<span class="line">description:*古代*</span>
<span class="line">这样就不会报错了,需要指定查询的字段</span>
<span class="line"></span>
<span class="line">参考:https://blog.csdn.net/zhouzhiwengang/article/details/111028596</span>
<span class="line"></span>
<span class="line">如果查询所有数据,那么q参数如下(默认值)</span>
<span class="line">*:*</span>
<span class="line"></span>
<span class="line">还可以多条件:</span>
<span class="line">description:*因为* &amp;&amp; age:42</span>
<span class="line"></span>
<span class="line">官网query api: https://solr.apache.org/guide/solr/latest/query-guide/json-request-api.html</span>
<span class="line">这个是我的一个复合查询语句: http://localhost:8985/solr/conferences_core/select?fl=* score&amp;indent=true&amp;q.op=OR&amp;q=description:*文*&amp;rows=2&amp;sort=id desc&amp;start=0&amp;useParams=</span>
<span class="line">  </span>
<span class="line">9&gt;删除数据</span>
<span class="line">documents的Request-Handler /update</span>
<span class="line">documents type 选择 XML</span>
<span class="line"></span>
<span class="line">documents 输入下面语句</span>
<span class="line">&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;</span>
<span class="line">&lt;commit/&gt;</span>
<span class="line"></span>
<span class="line">但是上面的删除，会删除所有的数据.</span>
<span class="line"></span>
<span class="line">删除指定id的数据:</span>
<span class="line">&lt;delete&gt;</span>
<span class="line">&lt;id&gt;11&lt;/id&gt;</span>
<span class="line">&lt;/delete&gt;</span>
<span class="line"></span>
<span class="line">删除指定筛选条件的数据:</span>
<span class="line">&lt;delete&gt;</span>
<span class="line">&lt;query&gt;description:*唐代*&lt;/query&gt;</span>
<span class="line">&lt;/delete&gt;</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">10&gt;更新数据(选择Documents操作 /update)</span>
<span class="line">目前更新的机制是，添加 id 相同的数据，会自动更新为最新数据，比如下面会更新id为11的数据：</span>
<span class="line">{&quot;id&quot;: &quot;11&quot;,&quot;age&quot;: 36,&quot;description&quot;: &quot;秋季破鼻子可能是空气干燥、不良习惯导致的，还可能与鼻腔异物、外伤、过敏性鼻炎等情况有关，具体可以前往医院就诊，明确诊断后，在医生指导下进行针对性治疗。&quot;},</span>
<span class="line">  </span>
<span class="line">11&gt;ik分词器:</span>
<span class="line">https://mvnrepository.com/artifact/com.github.magese/ik-analyzer</span>
<span class="line">选择合适的版本，在 Files 找到jar下载</span>
<span class="line"></span>
<span class="line">目前最高的是8.x版本，但是对于solr9.x 也是可以用的,就选择最新的 8.5版本就可以了</span>
<span class="line"></span>
<span class="line">将这个jar包放到如下目录(里面全是jar包):</span>
<span class="line">/usr/local/solr-9.6.0/server/solr-webapp/webapp/WEB-INF/lib</span>
<span class="line"></span>
<span class="line">进入下面这个目录:</span>
<span class="line">/usr/local/solr-9.6.0/server/solr/conferences_core/conf</span>
<span class="line"></span>
<span class="line">sudo vim managed-schema.xml</span>
<span class="line"></span>
<span class="line">我直接在最后一个 fieldType 添加如下代码:</span>
<span class="line">&lt;!-- ik分词器 --&gt;</span>
<span class="line">    &lt;fieldType name=&quot;text_ik&quot; class=&quot;solr.TextField&quot;&gt;</span>
<span class="line">      &lt;analyzer type=&quot;index&quot; useSmart=&quot;false&quot; class=&quot;org.wltea.analyzer.lucene.IKAnalyzer&quot;/&gt;</span>
<span class="line">      &lt;analyzer type=&quot;query&quot; useSmart=&quot;true&quot; class=&quot;org.wltea.analyzer.lucene.IKAnalyzer&quot;/&gt;</span>
<span class="line">    &lt;/fieldType&gt;</span>
<span class="line"></span>
<span class="line">然后重新启动solr服务:</span>
<span class="line">k8s@HPDEV-31:/usr/local/solr-9.6.0$ sudo bin/solr restart -p 8985 -force</span>
<span class="line"></span>
<span class="line">测试ik是否可用:</span>
<span class="line">选择对应的core, 然后点击 Analysis, </span>
<span class="line"></span>
<span class="line">Field Value: 输入一串中文</span>
<span class="line"></span>
<span class="line">Analyse Fieldname / FieldType 中找到 text_ik, </span>
<span class="line">点击右侧的 Analyse values 即可看到分词结果</span>
<span class="line"></span>
<span class="line">也可以在 Analyse Fieldname / FieldType 中找到 设置了 text_ik 的 filed，比如这里的 description, 然后点击右侧的 Analyse values 即可看到分词结果.</span>
<span class="line"></span>
<span class="line">分词查询:</span>
<span class="line">将 q 字段给值 description:多种机制， 不要加 ** 号, 不然分词不起作用.</span>
<span class="line">  </span>
<span class="line">12&gt;关于高亮部分</span>
<span class="line">如果想使用 highlighting 功能，需要配置 hl参数和hl.fl参数,一个是控制是否高亮，一个是控制需要高亮的字段(可以有多个),至少需要这两个参数，否则查询不生效</span>
<span class="line">这里设置为: hl=true, 以及 hl.fl=description</span>
<span class="line">http://localhost:8985/solr/conferences_core/select?hl.fl=description&amp;hl=true&amp;indent=true&amp;q.op=OR&amp;q=description:两种人&amp;useParams=</span>
<span class="line"></span>
<span class="line">如果想重新配置包裹高亮的标签，可以通过下面两个参数实现, 默认是 &lt;em&gt; &lt;/em&gt; 标签:</span>
<span class="line">hl.simple.pre</span>
<span class="line">hl.simple.post</span>
<span class="line"></span>
<span class="line">比如设置为: hl.simple.pre=&lt;strong&gt;, hl.simple.post=&lt;/strong&gt;, 最实用的是配置color为红色样式.</span>
<span class="line"></span>
<span class="line">以下是highlighting的查询结果:</span>
<span class="line">&quot;highlighting&quot;:{</span>
<span class="line">    &quot;16&quot;:{</span>
<span class="line">      &quot;description&quot;:[&quot;创造了古代浪漫主义&lt;em&gt;文学&lt;/em&gt;高峰、歌行体和七绝达到后人难及的高度&quot;]</span>
<span class="line">    },</span>
<span class="line">    &quot;11&quot;:{</span>
<span class="line">      &quot;description&quot;:[&quot;创造了古代浪漫主义&lt;em&gt;文学&lt;/em&gt;高峰、歌行体和七绝达到后人难及的高度&quot;]</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">官网参考: https://solr.apache.org/guide/solr/latest/query-guide/highlighting.html</span>
<span class="line">  </span>
<span class="line">13&gt;solr安全配置</span>
<span class="line">参考: https://solr.apache.org/guide/solr/latest/deployment-guide/authentication-and-authorization-plugins.html</span>
<span class="line">基本授权: https://solr.apache.org/guide/solr/latest/deployment-guide/basic-authentication-plugin.html</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">这里配置 /usr/local/solr-9.6.0/server/solr/security.json, 然后重启solr:</span>
<span class="line">{</span>
<span class="line">&quot;authentication&quot;:{ </span>
<span class="line">   &quot;blockUnknown&quot;: true, </span>
<span class="line">   &quot;class&quot;:&quot;solr.BasicAuthPlugin&quot;,</span>
<span class="line">   &quot;credentials&quot;:{&quot;solr&quot;:&quot;IV0EHq1OnNrj6gvRCwvFwTrZ1+z1oBbnQdiVC3otuq0= Ndd7LKvVBAaZIF0QAVi1ekCfAJXr1GGfLtRUXhgrF8c=&quot;}, </span>
<span class="line">   &quot;realm&quot;:&quot;My Solr users&quot;, </span>
<span class="line">   &quot;forwardCredentials&quot;: false </span>
<span class="line">}</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">默认用户名: solr 密码: SolrRocks</span>
<span class="line">  </span>
<span class="line">  </span>
<span class="line">总参考：</span>
<span class="line">https://blog.csdn.net/hejiahao_/article/details/133698865</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2)]))}const p=n(a,[["render",d],["__file","solr搜索服务的使用.html.vue"]]),r=JSON.parse('{"path":"/content/other/spread/solr%E6%90%9C%E7%B4%A2%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%BD%BF%E7%94%A8.html","title":"solr搜索服务的使用","lang":"en-US","frontmatter":{"sidebar":false,"title":"solr搜索服务的使用","description":"solr搜索服务的使用"},"headers":[],"git":{},"filePathRelative":"content/other/spread/solr搜索服务的使用.md"}');export{p as comp,r as data};
