import{_ as n,c as a,f as p,o as e}from"./app-BB_BIQV8.js";const t={};function o(c,s){return e(),a("div",null,s[0]||(s[0]=[p(`<p>今天在弄cookie的时候，需要设置过期时间，如下是我的代码:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">onAuthenticationSuccess</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">TokenInterface</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">RedirectResponse</span><span class="token operator">|</span><span class="token class-name">Response</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token doc-comment comment">/** <span class="token keyword">@var</span> <span class="token class-name">User</span> <span class="token parameter">$user</span> */</span></span>
<span class="line">        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$token</span><span class="token operator">-&gt;</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$userInfo</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token variable">$userInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;id&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token variable">$userInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;email&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token variable">$userInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;firstName&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">getFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token variable">$userInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;middleName&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">getMiddleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token variable">$userInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;lastName&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">getLastName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token variable">$userInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;isAdmin&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token variable">$userInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;image&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token variable">$userInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;avatar&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">getAvatar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//设置过期时间，symfony5.4 框架会把下面这个时间戳格式化为UTC格式，北京时间少八个小时</span></span>
<span class="line">        <span class="token comment">//开始我为了测试用 time() + 60; 然后盯着(期间也不停地刷新浏览器)浏览器等待60s，却发现最然设置了过期时间，但是</span></span>
<span class="line">        <span class="token comment">//cookie数据还在，后来我想是不是 UTC的缘故，又把时间设置为:time() + 8 * 3600 + 60，</span></span>
<span class="line">        <span class="token comment">//多加8小时，也不行，其实 虽然加了8小时，但是cookie过期的时间格式依然是:2023-05-09T00:46:49.518Z (UTC)</span></span>
<span class="line">        <span class="token comment">//所以，time() + 60; 这样就可以了，然后关闭浏览器，再打开，再看，大约60s，以后 数据自动清除</span></span>
<span class="line">        <span class="token comment">//总结就是：这个过期时间会在关闭浏览器再打开才会体现出来.</span></span>
<span class="line">        <span class="token variable">$expireTime</span> <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3600</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">httpUtils</span><span class="token operator">-&gt;</span><span class="token function">createRedirectResponse</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">determineTargetUrl</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$cookie</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;userInfo&#39;</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$userInfo</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$expireTime</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token property">headers</span><span class="token operator">-&gt;</span><span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$response</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2)]))}const i=n(t,[["render",o],["__file","浏览器cookie设置失效时间不生效问题.html.vue"]]),u=JSON.parse('{"path":"/content/front/js/%E6%B5%8F%E8%A7%88%E5%99%A8cookie%E8%AE%BE%E7%BD%AE%E5%A4%B1%E6%95%88%E6%97%B6%E9%97%B4%E4%B8%8D%E7%94%9F%E6%95%88%E9%97%AE%E9%A2%98.html","title":"浏览器cookie设置失效时间不生效问题","lang":"en-US","frontmatter":{"sidebar":false,"title":"浏览器cookie设置失效时间不生效问题","description":"浏览器cookie设置失效时间不生效问题"},"headers":[],"git":{},"filePathRelative":"content/front/js/浏览器cookie设置失效时间不生效问题.md"}');export{i as comp,u as data};
