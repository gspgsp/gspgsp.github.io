import{_ as n,c as a,f as e,o as l}from"./app-BB_BIQV8.js";const t={};function i(p,s){return l(),a("div",null,s[0]||(s[0]=[e(`<h3 id="é¦–å…ˆdockerå¯åŠ¨ä¸€ä¸ªrabbitmqæœåŠ¡" tabindex="-1"><a class="header-anchor" href="#é¦–å…ˆdockerå¯åŠ¨ä¸€ä¸ªrabbitmqæœåŠ¡"><span>é¦–å…ˆdockerå¯åŠ¨ä¸€ä¸ªrabbitMQæœåŠ¡</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token key atrule">container_name</span><span class="token punctuation">:</span> <span class="token string">&quot;\${APP_NAME}-rabbitmq&quot;</span></span>
<span class="line"><span class="token key atrule">image</span><span class="token punctuation">:</span> rabbitmq<span class="token punctuation">:</span>4.0<span class="token punctuation">-</span>management</span>
<span class="line"><span class="token key atrule">restart</span><span class="token punctuation">:</span> always</span>
<span class="line"><span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token key atrule">RABBITMQ_DEFAULT_USER</span><span class="token punctuation">:</span> Qh</span>
<span class="line"><span class="token key atrule">RABBITMQ_DEFAULT_PASS</span><span class="token punctuation">:</span> Qh</span>
<span class="line"><span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token punctuation">-</span> volume<span class="token punctuation">-</span>rabbitmq<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/var/lib/rabbitmq</span>
<span class="line"><span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token punctuation">-</span> <span class="token string">&quot;\${RABBITMQ_PORT}:5672&quot;</span></span>
<span class="line"><span class="token punctuation">-</span> <span class="token string">&quot;15672:15672&quot;</span></span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token punctuation">-</span> network<span class="token punctuation">-</span>internal</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¯å¢ƒå˜é‡" tabindex="-1"><a class="header-anchor" href="#ç¯å¢ƒå˜é‡"><span>ç¯å¢ƒå˜é‡</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">.env</span>
<span class="line">MESSENGER_TRANSPORT_DSN=amqp://Qh:Qh@rabbitmq:5672/%2f</span>
<span class="line">MESSENGER_FAILURE_TRANSPORT_DSN=doctrine://default?queue_name=failed</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¾èµ–åŒ…" tabindex="-1"><a class="header-anchor" href="#ä¾èµ–åŒ…"><span>ä¾èµ–åŒ…</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">comspoeråŒ…:</span>
<span class="line">&quot;symfony/amqp-messenger&quot;: &quot;7.2.*&quot;,</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="messengeré…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#messengeré…ç½®æ–‡ä»¶"><span>messengeré…ç½®æ–‡ä»¶</span></a></h3><p>messenger.yamlæ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">framework</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token key atrule">messenger</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token key atrule">failure_transport</span><span class="token punctuation">:</span> failed</span>
<span class="line">        <span class="token key atrule">transports</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># é‚®ä»¶æ¶ˆæ¯é˜Ÿåˆ— transport</span></span>
<span class="line">            <span class="token key atrule">Qh_mail_transport</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">dsn</span><span class="token punctuation">:</span> <span class="token string">&#39;%env(MESSENGER_TRANSPORT_DSN)%&#39;</span></span>
<span class="line">                <span class="token key atrule">failure_transport</span><span class="token punctuation">:</span> failed</span>
<span class="line">                <span class="token key atrule">retry_strategy</span><span class="token punctuation">:</span></span>
<span class="line">                    <span class="token key atrule">max_retries</span><span class="token punctuation">:</span> <span class="token number">3</span></span>
<span class="line">                    <span class="token key atrule">multiplier</span><span class="token punctuation">:</span> <span class="token number">2</span></span>
<span class="line">                <span class="token key atrule">options</span><span class="token punctuation">:</span></span>
<span class="line">                    <span class="token key atrule">exchange</span><span class="token punctuation">:</span></span>
<span class="line">                        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;Qh_exchange&#39;</span>          <span class="token comment"># äº¤æ¢æœºåå­—</span></span>
<span class="line">                        <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">&#39;direct&#39;</span></span>
<span class="line">                        <span class="token key atrule">default_publish_routing_key</span><span class="token punctuation">:</span> <span class="token string">&#39;mail_routing_key&#39;</span></span>
<span class="line">                    <span class="token key atrule">queues</span><span class="token punctuation">:</span></span>
<span class="line">                        <span class="token key atrule">Qh_mail_queue</span><span class="token punctuation">:</span>                <span class="token comment"># é˜Ÿåˆ—åå­—, queues ä¸‹å¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—åå­—ï¼Œç„¶åé€šè¿‡ binding_keys å’Œä¸åŒçš„äº¤æ¢æœºå…³è”</span></span>
<span class="line">                            <span class="token key atrule">binding_keys</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;mail_routing_key&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment"># å¤±è´¥é˜Ÿåˆ— transport</span></span>
<span class="line">            <span class="token key atrule">failed</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">dsn</span><span class="token punctuation">:</span> <span class="token string">&#39;%env(MESSENGER_FAILURE_TRANSPORT_DSN)%&#39;</span></span>
<span class="line">                <span class="token key atrule">options</span><span class="token punctuation">:</span></span>
<span class="line">                    <span class="token key atrule">queue_name</span><span class="token punctuation">:</span> failed_queue             <span class="token comment"># å¤±è´¥é˜Ÿåˆ—åå­—</span></span>
<span class="line"></span>
<span class="line">        <span class="token key atrule">routing</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">App\\Message\\QhMail</span><span class="token punctuation">:</span> Qh_mail_transport <span class="token comment">#QhMail æ¶ˆæ¯ä¼šå‘é€åˆ° Qh_mail_transportï¼ŒQh_mail_transport ç»‘å®šé˜Ÿåˆ—å Qh_mail_queueï¼Œæ‰€ä»¥å¯åŠ¨ messenger:consume Qh_mail_transport å°±ä¼šæ¶ˆè´¹åˆ°é˜Ÿåˆ— Qh_mail_queue çš„æ¶ˆæ¯</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½œç”¨æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ä½œç”¨æœºåˆ¶"><span>ä½œç”¨æœºåˆ¶:</span></a></h3><ul><li>1.æ¶ˆæ¯å¯¹è±¡ QhMail è¢« dispatch åˆ° Qh_mail_transport</li><li>2.Transport ä¼šæŠŠæ¶ˆæ¯å‘åˆ° Qh_exchange äº¤æ¢æœº</li><li>3.äº¤æ¢æœºæ ¹æ® routing key mail_routing_key å°†æ¶ˆæ¯è·¯ç”±åˆ° Qh_mail_queue</li><li>4.Worker æ¶ˆè´¹ Qh_mail_queue</li><li>5.å¦‚æœæ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œå‘é€åˆ° failed_queue</li></ul><h3 id="æ¶ˆè´¹è€…-æ¶ˆè´¹-qh-mail-transport-å¯¹åº”çš„é˜Ÿåˆ—-æ¯ä¸ª-transport-ç‹¬ç«‹-worker" tabindex="-1"><a class="header-anchor" href="#æ¶ˆè´¹è€…-æ¶ˆè´¹-qh-mail-transport-å¯¹åº”çš„é˜Ÿåˆ—-æ¯ä¸ª-transport-ç‹¬ç«‹-worker"><span>æ¶ˆè´¹è€…, æ¶ˆè´¹ Qh_mail_transport å¯¹åº”çš„é˜Ÿåˆ—, æ¯ä¸ª transport ç‹¬ç«‹ worker</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">php bin/console messenger:consume Qh_mail_transport</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="ä¸ºä»€ä¹ˆæ¨è-æ¯ä¸ª-transport-ç‹¬ç«‹-worker" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆæ¨è-æ¯ä¸ª-transport-ç‹¬ç«‹-worker"><span>ä¸ºä»€ä¹ˆæ¨è æ¯ä¸ª transport ç‹¬ç«‹ worker</span></a></h3><ul><li>å‡è®¾æœ‰å¤šä¸ªæ¶ˆæ¯ç±»å‹ï¼š</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">é‚®ä»¶æ¶ˆæ¯ â†’ transport: Qh_mail_transport</span>
<span class="line">çŸ­ä¿¡æ¶ˆæ¯ â†’ transport: Qh_sms_transport</span>
<span class="line">æ¨é€é€šçŸ¥ â†’ transport: Qh_push_transport</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦‚æœä¸€ä¸ª worker æ¶ˆè´¹ æ‰€æœ‰ transportï¼š</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">é‚®ä»¶å †ç§¯æ—¶ï¼Œå¯èƒ½é˜»å¡çŸ­ä¿¡æˆ–æ¨é€é˜Ÿåˆ—çš„æ¶ˆæ¯</span>
<span class="line">ä¸åŒç±»å‹æ¶ˆæ¯çš„å¤„ç†é€Ÿåº¦ä¸åŒï¼Œæ··åˆåœ¨ä¸€ä¸ª worker ä¸å¥½æ§åˆ¶</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç‹¬ç«‹ worker ä¼˜ç‚¹ï¼š</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">æ¯ä¸ªæ¶ˆæ¯ç±»å‹æœ‰è‡ªå·±çš„æ¶ˆè´¹è¿›ç¨‹</span>
<span class="line">å¯ä»¥å•ç‹¬æ‰©å®¹ï¼Œé‚®ä»¶ç§¯å‹æ—¶å¤šå¼€å‡ ä¸ªé‚®ä»¶ workerï¼Œä¸å½±å“çŸ­ä¿¡æˆ–æ¨é€</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ¯ä¸ª-transport-åªèƒ½å¯¹åº”ä¸€ä¸ªäº¤æ¢æœº-ä½†æ˜¯rabbitmqå…¶å®æ˜¯å¯ä»¥å®šä¹‰å¤šä¸ªäº¤æ¢æœºçš„-ä¸ºäº†å®ç°è¿™ä¸€ç‚¹-å¯ä»¥å®šä¹‰å¤šä¸ª-transport-ç„¶åå…³è”ä¸åŒçš„äº¤æ¢æœº-å¦‚ä¸‹" tabindex="-1"><a class="header-anchor" href="#æ¯ä¸ª-transport-åªèƒ½å¯¹åº”ä¸€ä¸ªäº¤æ¢æœº-ä½†æ˜¯rabbitmqå…¶å®æ˜¯å¯ä»¥å®šä¹‰å¤šä¸ªäº¤æ¢æœºçš„-ä¸ºäº†å®ç°è¿™ä¸€ç‚¹-å¯ä»¥å®šä¹‰å¤šä¸ª-transport-ç„¶åå…³è”ä¸åŒçš„äº¤æ¢æœº-å¦‚ä¸‹"><span>æ¯ä¸ª transport åªèƒ½å¯¹åº”ä¸€ä¸ªäº¤æ¢æœºï¼Œä½†æ˜¯RabbitMQå…¶å®æ˜¯å¯ä»¥å®šä¹‰å¤šä¸ªäº¤æ¢æœºçš„ï¼Œä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ª transport ç„¶åå…³è”ä¸åŒçš„äº¤æ¢æœºï¼Œå¦‚ä¸‹:</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">framework:</span>
<span class="line">messenger:</span>
<span class="line">transports:</span>
<span class="line">mail_transport:</span>
<span class="line">dsn: &#39;%env(MESSENGER_TRANSPORT_DSN)%&#39;</span>
<span class="line">options:</span>
<span class="line">exchange:</span>
<span class="line">name: &#39;Qh_mail_exchange&#39;</span>
<span class="line">type: &#39;direct&#39;</span>
<span class="line">default_publish_routing_key: &#39;mail_routing_key&#39;</span>
<span class="line">queues:</span>
<span class="line">Qh_mail_queue:</span>
<span class="line">binding_keys: [&#39;mail_routing_key&#39;]</span>
<span class="line"></span>
<span class="line">            sms_transport:</span>
<span class="line">                dsn: &#39;%env(MESSENGER_TRANSPORT_DSN)%&#39;</span>
<span class="line">                options:</span>
<span class="line">                    exchange:</span>
<span class="line">                        name: &#39;Qh_sms_exchange&#39;</span>
<span class="line">                        type: &#39;direct&#39;</span>
<span class="line">                        default_publish_routing_key: &#39;sms_routing_key&#39;</span>
<span class="line">                    queues:</span>
<span class="line">                        Qh_sms_queue:</span>
<span class="line">                            binding_keys: [&#39;sms_routing_key&#39;]</span>
<span class="line"></span>
<span class="line">        routing:</span>
<span class="line">            App\\Message\\MailMessage: mail_transport</span>
<span class="line">            App\\Message\\SmsMessage: sms_transport</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶å:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">php bin/console messenger:consume mail_transport</span>
<span class="line">php bin/console messenger:consume sms_transport</span>
<span class="line">åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ª worker.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰‹åŠ¨ç”Ÿæˆéœ€è¦çš„äº¤æ¢æœºç­‰é…ç½®ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#æ‰‹åŠ¨ç”Ÿæˆéœ€è¦çš„äº¤æ¢æœºç­‰é…ç½®ä¿¡æ¯"><span>æ‰‹åŠ¨ç”Ÿæˆéœ€è¦çš„äº¤æ¢æœºç­‰é…ç½®ä¿¡æ¯:</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">php bin/console messenger:setup-transports</span>
<span class="line">è¿™ä¸ªå‘½ä»¤ä¼šè‡ªåŠ¨å£°æ˜ RabbitMQ ä¸­æ‰€æœ‰å¿…è¦çš„ exchangeã€queueã€bindingã€‚å¸¸ç”¨äºéƒ¨ç½²æ—¶åˆå§‹åŒ–ã€‚</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‹“å±•" tabindex="-1"><a class="header-anchor" href="#æ‹“å±•"><span>æ‹“å±•:</span></a></h3><p><code>transport name å’Œqueue name</code>çš„åŒºåˆ«</p><h3 id="ğŸ§©-ä¸€ã€ç®€å•ç»“è®ºå…ˆè¯´" tabindex="-1"><a class="header-anchor" href="#ğŸ§©-ä¸€ã€ç®€å•ç»“è®ºå…ˆè¯´"><span>ğŸ§© ä¸€ã€ç®€å•ç»“è®ºå…ˆè¯´</span></a></h3><table><thead><tr><th>æ¦‚å¿µ</th><th>ç¤ºä¾‹</th><th>æ‰€å±ç³»ç»Ÿ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><strong>transport name</strong></td><td><code>mail_transport</code></td><td>Symfony Messenger é…ç½®å±‚</td><td>Symfony åº”ç”¨ä¸­å®šä¹‰çš„ä¸€ç§â€œæ¶ˆæ¯ä¼ è¾“é€šé“â€â€”â€”æ¯”å¦‚ RabbitMQã€Redisã€Doctrine ç­‰ã€‚</td></tr><tr><td><strong>queue name</strong></td><td><code>Qh_mail_queue</code></td><td>RabbitMQ å®é™…å±‚</td><td>RabbitMQ å†…éƒ¨å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—åç§°ã€‚</td></tr></tbody></table><p>ğŸ‘‰ æ¢å¥è¯è¯´ï¼š</p><ul><li><strong>transport name æ˜¯ Symfony å±‚çš„åˆ«åï¼ˆé€»è¾‘åç§°ï¼‰</strong></li><li><strong>queue name æ˜¯æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆRabbitMQï¼‰å±‚çš„çœŸå®é˜Ÿåˆ—åç§°</strong></li></ul><hr><h3 id="âš™ï¸-äºŒã€åœ¨é…ç½®ä¸­çš„ä½ç½®ä¸ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#âš™ï¸-äºŒã€åœ¨é…ç½®ä¸­çš„ä½ç½®ä¸ä½œç”¨"><span>âš™ï¸ äºŒã€åœ¨é…ç½®ä¸­çš„ä½ç½®ä¸ä½œç”¨</span></a></h3><p>å‡è®¾ä½ çš„ <code>messenger.yaml</code> é‡Œå†™ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">framework</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">messenger</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">transports</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">mail_transport</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">dsn</span><span class="token punctuation">:</span> <span class="token string">&#39;%env(MESSENGER_TRANSPORT_DSN)%&#39;</span></span>
<span class="line">                <span class="token key atrule">options</span><span class="token punctuation">:</span></span>
<span class="line">                    <span class="token key atrule">exchange</span><span class="token punctuation">:</span></span>
<span class="line">                        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;Qh_exchange&#39;</span></span>
<span class="line">                        <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">&#39;direct&#39;</span></span>
<span class="line">                        <span class="token key atrule">default_publish_routing_key</span><span class="token punctuation">:</span> <span class="token string">&#39;Qh_mail&#39;</span></span>
<span class="line">                    <span class="token key atrule">queues</span><span class="token punctuation">:</span></span>
<span class="line">                        <span class="token key atrule">Qh_mail_queue</span><span class="token punctuation">:</span></span>
<span class="line">                            <span class="token key atrule">binding_keys</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;Qh_mail&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">        <span class="token key atrule">routing</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">App\\Message\\QhMail</span><span class="token punctuation">:</span> mail_transport</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆè§£é‡Šå¦‚ä¸‹ ğŸ‘‡</p><table><thead><tr><th>å…ƒç´ </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>mail_transport</code></td><td>Symfony Messenger å®šä¹‰çš„â€œä¼ è¾“é€šé“åç§°â€ï¼Œç›¸å½“äºâ€œè¿æ¥é…ç½®â€æˆ–â€œé€»è¾‘æ ‡è¯†â€ã€‚</td></tr><tr><td><code>dsn</code></td><td>æŒ‡æ˜è¯¥ transport ä½¿ç”¨çš„è¿æ¥æ–¹å¼ï¼Œæ¯”å¦‚ <code>amqp://user:pass@rabbitmq:5672/%2f</code>ã€‚</td></tr><tr><td><code>exchange.name</code></td><td>RabbitMQ ä¸­çš„äº¤æ¢æœºåã€‚</td></tr><tr><td><code>queues.Qh_mail_queue</code></td><td>åœ¨ RabbitMQ ä¸Šå®é™…åˆ›å»ºçš„é˜Ÿåˆ—ã€‚</td></tr><tr><td><code>binding_keys</code></td><td>é˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœºæ—¶çš„è·¯ç”±é”®ï¼ˆrouting keyï¼‰ã€‚</td></tr><tr><td><code>routing:</code></td><td>è¡¨ç¤ºå½“ dispatch æŸä¸ªæ¶ˆæ¯ç±»æ—¶ï¼Œä½¿ç”¨å“ªä¸ª transportï¼ˆæ¯”å¦‚ <code>mail_transport</code>ï¼‰ã€‚</td></tr></tbody></table><hr><h3 id="ğŸ§ -ä¸‰ã€æ‰§è¡Œæ—¶çš„å¯¹åº”å…³ç³»" tabindex="-1"><a class="header-anchor" href="#ğŸ§ -ä¸‰ã€æ‰§è¡Œæ—¶çš„å¯¹åº”å…³ç³»"><span>ğŸ§  ä¸‰ã€æ‰§è¡Œæ—¶çš„å¯¹åº”å…³ç³»</span></a></h3><p>å‡è®¾ä»£ç ä¸­è¿™æ ·å†™ï¼š</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token variable">$bus</span><span class="token operator">-&gt;</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QhMail</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;user@example.com&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;Hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li><p>Messenger æŸ¥æ‰¾ routingï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">App\\Message\\QhMail</span><span class="token punctuation">:</span> mail_transport</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>â†’ å‘ç°åº”è¯¥å‘åˆ° <code>mail_transport</code></p></li><li><p><code>mail_transport</code> é…ç½®æŒ‡å‘ RabbitMQ DSN â†’ Messenger åˆ›å»ºè¿æ¥åˆ° RabbitMQ æœåŠ¡å™¨</p></li><li><p>Messenger ä½¿ç”¨é…ç½®çš„ <code>exchange</code> å’Œ <code>default_publish_routing_key</code></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">exchange</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> Qh_exchange</span>
<span class="line">    <span class="token key atrule">default_publish_routing_key</span><span class="token punctuation">:</span> Qh_mail</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŠŠæ¶ˆæ¯å‘é€åˆ°äº¤æ¢æœºã€‚</p></li><li><p>RabbitMQ å°†æ¶ˆæ¯æ ¹æ® <code>binding_keys</code> è§„åˆ™æŠ•é€’åˆ°é˜Ÿåˆ—ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Qh_mail_queue</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>æ¶ˆè´¹è€…æ‰§è¡Œï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">php bin/console messenger:consume mail_transport</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>â†’ Messenger é€šè¿‡ transport åæ‰¾åˆ°é…ç½®çš„ RabbitMQ é˜Ÿåˆ— â†’ å¼€å§‹ç›‘å¬ <code>Qh_mail_queue</code></p></li></ol><hr><h3 id="ğŸ§©-å››ã€ç±»æ¯”å¸®åŠ©ç†è§£" tabindex="-1"><a class="header-anchor" href="#ğŸ§©-å››ã€ç±»æ¯”å¸®åŠ©ç†è§£"><span>ğŸ§© å››ã€ç±»æ¯”å¸®åŠ©ç†è§£</span></a></h3><p>å¯ä»¥ç±»æ¯”æˆä¸€ä¸ªâ€œé‚®æ”¿ç³»ç»Ÿâ€ï¼š</p><table><thead><tr><th>å±‚çº§</th><th>å¯¹è±¡</th><th>æ¯”å–»</th></tr></thead><tbody><tr><td>Messenger transport</td><td>é‚®å±€ï¼ˆæ¯”å¦‚â€œä¸Šæµ·é‚®å±€â€ï¼‰</td><td>è´Ÿè´£æŠ•é€’æ¶ˆæ¯åˆ°æŸä¸ªç³»ç»Ÿ</td></tr><tr><td>Exchange</td><td>é‚®ä»¶åˆ†æ‹£ä¸­å¿ƒ</td><td>æ ¹æ®åœ°å€æŠŠä¿¡ä»¶åˆ†æ´¾åˆ°æ­£ç¡®çš„é‚®è¢‹</td></tr><tr><td>Queue</td><td>é‚®è¢‹</td><td>å­˜æ”¾å¾…æ´¾é€çš„é‚®ä»¶</td></tr><tr><td>Routing key</td><td>é‚®ä»¶æ ‡ç­¾</td><td>æŒ‡æ˜ä¿¡ä»¶è¯¥æ”¾è¿›å“ªä¸ªé‚®è¢‹</td></tr></tbody></table><hr><h3 id="âœ…-äº”ã€æ¨èå‘½åè§„èŒƒ-é¿å…æ··ä¹±" tabindex="-1"><a class="header-anchor" href="#âœ…-äº”ã€æ¨èå‘½åè§„èŒƒ-é¿å…æ··ä¹±"><span>âœ… äº”ã€æ¨èå‘½åè§„èŒƒï¼ˆé¿å…æ··ä¹±ï¼‰</span></a></h3><p>å»ºè®®é…ç½®æ—¶<strong>æ˜ç¡®åŒºåˆ†é€»è¾‘å±‚ä¸ç‰©ç†å±‚åç§°</strong>ï¼Œæ¯”å¦‚ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">transports</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">Qh_mail_transport</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">dsn</span><span class="token punctuation">:</span> <span class="token string">&#39;%env(MESSENGER_TRANSPORT_DSN)%&#39;</span></span>
<span class="line">        <span class="token key atrule">options</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">exchange</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;Qh_exchange&#39;</span></span>
<span class="line">                <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">&#39;direct&#39;</span></span>
<span class="line">                <span class="token key atrule">default_publish_routing_key</span><span class="token punctuation">:</span> <span class="token string">&#39;mail_key&#39;</span></span>
<span class="line">            <span class="token key atrule">queues</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">Qh_mail_queue</span><span class="token punctuation">:</span></span>
<span class="line">                    <span class="token key atrule">binding_keys</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;mail_key&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>transport name</code>: <code>Qh_mail_transport</code>ï¼ˆSymfonyé€»è¾‘åï¼‰</li><li><code>exchange name</code>: <code>Qh_exchange</code>ï¼ˆRabbitMQäº¤æ¢æœºï¼‰</li><li><code>queue name</code>: <code>Qh_mail_queue</code>ï¼ˆRabbitMQé˜Ÿåˆ—ï¼‰</li></ul><p>è¿™æ ·çœ‹èµ·æ¥å°±å¾ˆæ¸…æ™°ï¼Œä¸å®¹æ˜“ææ··ã€‚</p>`,54)]))}const c=n(t,[["render",i],["__file","rabbitMqåœ¨symfony7ä¸‹çš„ä½¿ç”¨.html.vue"]]),d=JSON.parse('{"path":"/content/mq/rabbit/rabbitMq%E5%9C%A8symfony7%E4%B8%8B%E7%9A%84%E4%BD%BF%E7%94%A8.html","title":"rabbitMqåœ¨symfony7ä¸‹çš„ä½¿ç”¨","lang":"en-US","frontmatter":{"sidebar":false,"title":"rabbitMqåœ¨symfony7ä¸‹çš„ä½¿ç”¨","head":[["meta",{"name":"title","content":"rabbitMqåœ¨symfony7ä¸‹çš„ä½¿ç”¨"}],["meta",{"name":"description","content":"rabbitMqåœ¨symfony7ä¸‹çš„ä½¿ç”¨"}],["meta",{"name":"keywords","content":"rabbitMq"}],["meta",{"property":"og:title","content":"rabbitMqåœ¨symfony7ä¸‹çš„ä½¿ç”¨"}],["meta",{"property":"og:description","content":"rabbitMqåœ¨symfony7ä¸‹çš„ä½¿ç”¨"}]]},"headers":[{"level":3,"title":"é¦–å…ˆdockerå¯åŠ¨ä¸€ä¸ªrabbitMQæœåŠ¡","slug":"é¦–å…ˆdockerå¯åŠ¨ä¸€ä¸ªrabbitmqæœåŠ¡","link":"#é¦–å…ˆdockerå¯åŠ¨ä¸€ä¸ªrabbitmqæœåŠ¡","children":[]},{"level":3,"title":"ç¯å¢ƒå˜é‡","slug":"ç¯å¢ƒå˜é‡","link":"#ç¯å¢ƒå˜é‡","children":[]},{"level":3,"title":"ä¾èµ–åŒ…","slug":"ä¾èµ–åŒ…","link":"#ä¾èµ–åŒ…","children":[]},{"level":3,"title":"messengeré…ç½®æ–‡ä»¶","slug":"messengeré…ç½®æ–‡ä»¶","link":"#messengeré…ç½®æ–‡ä»¶","children":[]},{"level":3,"title":"ä½œç”¨æœºåˆ¶:","slug":"ä½œç”¨æœºåˆ¶","link":"#ä½œç”¨æœºåˆ¶","children":[]},{"level":3,"title":"æ¶ˆè´¹è€…, æ¶ˆè´¹ Qh_mail_transport å¯¹åº”çš„é˜Ÿåˆ—, æ¯ä¸ª transport ç‹¬ç«‹ worker","slug":"æ¶ˆè´¹è€…-æ¶ˆè´¹-qh-mail-transport-å¯¹åº”çš„é˜Ÿåˆ—-æ¯ä¸ª-transport-ç‹¬ç«‹-worker","link":"#æ¶ˆè´¹è€…-æ¶ˆè´¹-qh-mail-transport-å¯¹åº”çš„é˜Ÿåˆ—-æ¯ä¸ª-transport-ç‹¬ç«‹-worker","children":[]},{"level":3,"title":"ä¸ºä»€ä¹ˆæ¨è æ¯ä¸ª transport ç‹¬ç«‹ worker","slug":"ä¸ºä»€ä¹ˆæ¨è-æ¯ä¸ª-transport-ç‹¬ç«‹-worker","link":"#ä¸ºä»€ä¹ˆæ¨è-æ¯ä¸ª-transport-ç‹¬ç«‹-worker","children":[]},{"level":3,"title":"æ¯ä¸ª transport åªèƒ½å¯¹åº”ä¸€ä¸ªäº¤æ¢æœºï¼Œä½†æ˜¯RabbitMQå…¶å®æ˜¯å¯ä»¥å®šä¹‰å¤šä¸ªäº¤æ¢æœºçš„ï¼Œä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ª transport ç„¶åå…³è”ä¸åŒçš„äº¤æ¢æœºï¼Œå¦‚ä¸‹:","slug":"æ¯ä¸ª-transport-åªèƒ½å¯¹åº”ä¸€ä¸ªäº¤æ¢æœº-ä½†æ˜¯rabbitmqå…¶å®æ˜¯å¯ä»¥å®šä¹‰å¤šä¸ªäº¤æ¢æœºçš„-ä¸ºäº†å®ç°è¿™ä¸€ç‚¹-å¯ä»¥å®šä¹‰å¤šä¸ª-transport-ç„¶åå…³è”ä¸åŒçš„äº¤æ¢æœº-å¦‚ä¸‹","link":"#æ¯ä¸ª-transport-åªèƒ½å¯¹åº”ä¸€ä¸ªäº¤æ¢æœº-ä½†æ˜¯rabbitmqå…¶å®æ˜¯å¯ä»¥å®šä¹‰å¤šä¸ªäº¤æ¢æœºçš„-ä¸ºäº†å®ç°è¿™ä¸€ç‚¹-å¯ä»¥å®šä¹‰å¤šä¸ª-transport-ç„¶åå…³è”ä¸åŒçš„äº¤æ¢æœº-å¦‚ä¸‹","children":[]},{"level":3,"title":"æ‰‹åŠ¨ç”Ÿæˆéœ€è¦çš„äº¤æ¢æœºç­‰é…ç½®ä¿¡æ¯:","slug":"æ‰‹åŠ¨ç”Ÿæˆéœ€è¦çš„äº¤æ¢æœºç­‰é…ç½®ä¿¡æ¯","link":"#æ‰‹åŠ¨ç”Ÿæˆéœ€è¦çš„äº¤æ¢æœºç­‰é…ç½®ä¿¡æ¯","children":[]},{"level":3,"title":"æ‹“å±•:","slug":"æ‹“å±•","link":"#æ‹“å±•","children":[]},{"level":3,"title":"ğŸ§© ä¸€ã€ç®€å•ç»“è®ºå…ˆè¯´","slug":"ğŸ§©-ä¸€ã€ç®€å•ç»“è®ºå…ˆè¯´","link":"#ğŸ§©-ä¸€ã€ç®€å•ç»“è®ºå…ˆè¯´","children":[]},{"level":3,"title":"âš™ï¸ äºŒã€åœ¨é…ç½®ä¸­çš„ä½ç½®ä¸ä½œç”¨","slug":"âš™ï¸-äºŒã€åœ¨é…ç½®ä¸­çš„ä½ç½®ä¸ä½œç”¨","link":"#âš™ï¸-äºŒã€åœ¨é…ç½®ä¸­çš„ä½ç½®ä¸ä½œç”¨","children":[]},{"level":3,"title":"ğŸ§  ä¸‰ã€æ‰§è¡Œæ—¶çš„å¯¹åº”å…³ç³»","slug":"ğŸ§ -ä¸‰ã€æ‰§è¡Œæ—¶çš„å¯¹åº”å…³ç³»","link":"#ğŸ§ -ä¸‰ã€æ‰§è¡Œæ—¶çš„å¯¹åº”å…³ç³»","children":[]},{"level":3,"title":"ğŸ§© å››ã€ç±»æ¯”å¸®åŠ©ç†è§£","slug":"ğŸ§©-å››ã€ç±»æ¯”å¸®åŠ©ç†è§£","link":"#ğŸ§©-å››ã€ç±»æ¯”å¸®åŠ©ç†è§£","children":[]},{"level":3,"title":"âœ… äº”ã€æ¨èå‘½åè§„èŒƒï¼ˆé¿å…æ··ä¹±ï¼‰","slug":"âœ…-äº”ã€æ¨èå‘½åè§„èŒƒ-é¿å…æ··ä¹±","link":"#âœ…-äº”ã€æ¨èå‘½åè§„èŒƒ-é¿å…æ··ä¹±","children":[]}],"git":{},"filePathRelative":"content/mq/rabbit/rabbitMqåœ¨symfony7ä¸‹çš„ä½¿ç”¨.md"}');export{c as comp,d as data};
