import{_ as n,c as a,f as e,o as t}from"./app-BB_BIQV8.js";const l={};function i(p,s){return t(),a("div",null,s[0]||(s[0]=[e(`<h5 id="symfony7ä¹‹ä½¿ç”¨mysql8çš„cteåŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#symfony7ä¹‹ä½¿ç”¨mysql8çš„cteåŠŸèƒ½"><span>symfony7ä¹‹ä½¿ç”¨mysql8çš„CTEåŠŸèƒ½</span></a></h5><p>ä½¿ç”¨CTEæŸ¥è¯¢:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getEventOrderTickets</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Event</span> <span class="token variable">$event</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string heredoc-string"><span class="token delimiter symbol"><span class="token punctuation">&lt;&lt;&lt;</span>SQL</span></span>
<span class="line">WITH reserved AS (</span>
<span class="line">SELECT ticket_id, SUM(quantity) AS reservedAmount</span>
<span class="line">FROM ticket_reservations</span>
<span class="line">GROUP BY ticket_id</span>
<span class="line">)</span>
<span class="line">SELECT</span>
<span class="line">t.id,</span>
<span class="line">t.title,</span>
<span class="line">COALESCE(t.quantity, 0) AS availability,</span>
<span class="line">COALESCE(rs.reservedAmount, 0) as reservedAmount,</span>
<span class="line">s.title AS sectionTitle,</span>
<span class="line"></span>
<span class="line">    COUNT(CASE WHEN o.status_id != :initialStatus THEN 1 ELSE NULL END) AS registeredAmount,</span>
<span class="line">    COUNT(DISTINCT CASE WHEN o.status_id = :completedStatus THEN JSON_UNQUOTE(JSON_EXTRACT(r.camel_cased_registration_data, &#39;$.email&#39;)) ELSE NULL END) AS completedCount,</span>
<span class="line">    COUNT(DISTINCT CASE WHEN r.checked_in = 1 AND o.status_id = :completedStatus THEN JSON_UNQUOTE(JSON_EXTRACT(r.camel_cased_registration_data, &#39;$.email&#39;)) ELSE NULL END) AS checkedInCount</span>
<span class="line"></span>
<span class="line">FROM tickets t</span>
<span class="line">LEFT JOIN ticket_sections s ON t.section_id = s.id</span>
<span class="line">JOIN events e ON t.event_id = e.id</span>
<span class="line">LEFT JOIN event_registrations r ON r.ticket_id = t.id</span>
<span class="line">LEFT JOIN event_registration_orders o ON r.order_id = o.id</span>
<span class="line">LEFT JOIN reserved rs ON rs.ticket_id = t.id</span>
<span class="line"></span>
<span class="line">WHERE e.id = :eventId</span>
<span class="line">GROUP BY t.id</span>
<span class="line">ORDER BY t.created_at DESC</span>
<span class="line"><span class="token delimiter symbol">SQL<span class="token punctuation">;</span></span></span></span>
<span class="line"><span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line"><span class="token string single-quoted-string">&#39;eventId&#39;</span>         <span class="token operator">=&gt;</span> <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string single-quoted-string">&#39;initialStatus&#39;</span>   <span class="token operator">=&gt;</span> <span class="token class-name static-context">EventRegistrationOrderStatusEnum</span><span class="token operator">::</span><span class="token constant">INITIAL</span><span class="token operator">-&gt;</span><span class="token property">value</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string single-quoted-string">&#39;completedStatus&#39;</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">EventRegistrationOrderStatusEnum</span><span class="token operator">::</span><span class="token constant">COMPLETED</span><span class="token operator">-&gt;</span><span class="token property">value</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getEntityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span> <span class="token variable">$params</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">fetchAllAssociative</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p>ä½¿ç”¨å­æŸ¥è¯¢:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getEventOrderTickets</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Event</span> <span class="token variable">$event</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line"><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string heredoc-string"><span class="token delimiter symbol"><span class="token punctuation">&lt;&lt;&lt;</span>SQL</span></span>
<span class="line">SELECT</span>
<span class="line">t.id,</span>
<span class="line">t.title,</span>
<span class="line">COALESCE(t.quantity, 0) AS availability,</span>
<span class="line">COALESCE(rs.reservedAmount, 0) as reservedAmount,</span>
<span class="line">s.title AS sectionTitle,</span>
<span class="line">COUNT(CASE WHEN o.status_id != :initialStatus THEN 1 ELSE NULL END) AS registeredAmount,</span>
<span class="line">COUNT(DISTINCT CASE WHEN o.status_id = :completedStatus THEN JSON_UNQUOTE(JSON_EXTRACT(r.camel_cased_registration_data, &#39;$.email&#39;)) ELSE NULL END) AS completedCount,</span>
<span class="line">COUNT(DISTINCT CASE WHEN r.checked_in = 1 AND o.status_id = :completedStatus THEN JSON_UNQUOTE(JSON_EXTRACT(r.camel_cased_registration_data, &#39;$.email&#39;)) ELSE NULL END) AS checkedInCount</span>
<span class="line">FROM tickets t</span>
<span class="line">LEFT JOIN ticket_sections s ON t.section_id = s.id</span>
<span class="line">JOIN events e ON t.event_id = e.id</span>
<span class="line">LEFT JOIN event_registrations r ON r.ticket_id = t.id</span>
<span class="line">LEFT JOIN event_registration_orders o ON r.order_id = o.id</span>
<span class="line">LEFT JOIN (</span>
<span class="line">SELECT ticket_id, SUM(quantity) AS reservedAmount</span>
<span class="line">FROM ticket_reservations</span>
<span class="line">GROUP BY ticket_id</span>
<span class="line">) rs ON rs.ticket_id = t.id</span>
<span class="line">WHERE e.id = :eventId</span>
<span class="line">GROUP BY t.id</span>
<span class="line">ORDER BY t.created_at DESC</span>
<span class="line"><span class="token delimiter symbol">SQL<span class="token punctuation">;</span></span></span></span>
<span class="line"><span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line"><span class="token string single-quoted-string">&#39;eventId&#39;</span>         <span class="token operator">=&gt;</span> <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string single-quoted-string">&#39;initialStatus&#39;</span>   <span class="token operator">=&gt;</span> <span class="token class-name static-context">EventRegistrationOrderStatusEnum</span><span class="token operator">::</span><span class="token constant">INITIAL</span><span class="token operator">-&gt;</span><span class="token property">value</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string single-quoted-string">&#39;completedStatus&#39;</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">EventRegistrationOrderStatusEnum</span><span class="token operator">::</span><span class="token constant">COMPLETED</span><span class="token operator">-&gt;</span><span class="token property">value</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getEntityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span> <span class="token variable">$params</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">fetchAllAssociative</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h5 id="å…³äºcte" tabindex="-1"><a class="header-anchor" href="#å…³äºcte"><span>å…³äºCTE</span></a></h5><ul><li>CTE(Common Table Expression)</li><li>è¯­æ³•çœŸçš„éå¸¸å¼ºå¤§ï¼Œåœ¨å¤æ‚æŸ¥è¯¢ä¸­å‡ ä¹æ˜¯â€œç»“æ„æ¸…æ™° + å¯å¤ç”¨ + æ˜“è¯»â€çš„åˆ©å™¨ã€‚</li></ul><hr><h5 id="âœ…-cte-with-è¯­æ³•-å¼ºå¤§çš„å‡ ç‚¹" tabindex="-1"><a class="header-anchor" href="#âœ…-cte-with-è¯­æ³•-å¼ºå¤§çš„å‡ ç‚¹"><span>âœ… CTEï¼ˆ<code>WITH</code> è¯­æ³•ï¼‰å¼ºå¤§çš„å‡ ç‚¹</span></a></h5><h5 id="_1-è®©å¤æ‚-sql-æ‹†åˆ†æ›´æ¸…æ™°" tabindex="-1"><a class="header-anchor" href="#_1-è®©å¤æ‚-sql-æ‹†åˆ†æ›´æ¸…æ™°"><span>1. <strong>è®©å¤æ‚ SQL æ‹†åˆ†æ›´æ¸…æ™°</strong></span></a></h5><p>ä½ å¯ä»¥æŠŠä¸­é—´æ­¥éª¤æŠ½å‡ºæ¥ï¼Œä¸éœ€è¦åµŒå¥—å¤šå±‚å­æŸ¥è¯¢ï¼Œ<strong>é€»è¾‘æ¸…æ¥šã€è¯­ä¹‰æ˜ç¡®</strong>ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">WITH</span> active_users <span class="token keyword">AS</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> email <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> is_active <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">order_totals <span class="token keyword">AS</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">SELECT</span> user_id<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>total_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> total <span class="token keyword">FROM</span> orders <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> user_id</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">SELECT</span> </span>
<span class="line">  u<span class="token punctuation">.</span>email<span class="token punctuation">,</span> o<span class="token punctuation">.</span>total</span>
<span class="line"><span class="token keyword">FROM</span> active_users u</span>
<span class="line"><span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> order_totals o <span class="token keyword">ON</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> o<span class="token punctuation">.</span>user_id</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›¸æ¯”å¤šå±‚åµŒå¥—çš„å­æŸ¥è¯¢ï¼Œè¿™ç§ç»“æ„<strong>æ¸…æ™°æ˜“ç»´æŠ¤</strong>ã€‚</p><hr><h5 id="_2-å¯ä»¥é€’å½’-with-recursive-â€”â€”éå¸¸é€‚åˆå¤„ç†æ ‘å½¢ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_2-å¯ä»¥é€’å½’-with-recursive-â€”â€”éå¸¸é€‚åˆå¤„ç†æ ‘å½¢ç»“æ„"><span>2. <strong>å¯ä»¥é€’å½’ï¼ˆWITH RECURSIVEï¼‰â€”â€”éå¸¸é€‚åˆå¤„ç†æ ‘å½¢ç»“æ„</strong></span></a></h5><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">WITH</span> RECURSIVE category_tree <span class="token keyword">AS</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> parent_id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> categories <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">  <span class="token keyword">UNION</span> <span class="token keyword">ALL</span></span>
<span class="line">  <span class="token keyword">SELECT</span> c<span class="token punctuation">.</span>id<span class="token punctuation">,</span> c<span class="token punctuation">.</span>parent_id<span class="token punctuation">,</span> c<span class="token punctuation">.</span>name</span>
<span class="line">  <span class="token keyword">FROM</span> categories c</span>
<span class="line">  <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> category_tree ct <span class="token keyword">ON</span> c<span class="token punctuation">.</span>parent_id <span class="token operator">=</span> ct<span class="token punctuation">.</span>id</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> category_tree<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ” è¿™å¯¹å¤„ç†<strong>æ— é™çº§åˆ†ç±»ã€ç»„ç»‡ç»“æ„æ ‘ã€è¯„è®ºåµŒå¥—</strong>ç­‰éå¸¸å¼ºå¤§ã€‚</p><hr><h5 id="_3-å¯è¢«å¤šæ¬¡å¼•ç”¨-æé«˜å¤ç”¨æ€§å’Œæ•ˆç‡" tabindex="-1"><a class="header-anchor" href="#_3-å¯è¢«å¤šæ¬¡å¼•ç”¨-æé«˜å¤ç”¨æ€§å’Œæ•ˆç‡"><span>3. <strong>å¯è¢«å¤šæ¬¡å¼•ç”¨ï¼Œæé«˜å¤ç”¨æ€§å’Œæ•ˆç‡</strong></span></a></h5><p>æ¯”å¦‚ä½ èšåˆä¸€ä¸ªç»Ÿè®¡å€¼ï¼Œåœ¨åé¢å¤šä¸ª JOIN æˆ– SELECT ä¸­é‡å¤ä½¿ç”¨ï¼Œ<strong>CTE é¿å…é‡å¤å†™ SQL</strong>ï¼Œè€Œä¸åƒå­æŸ¥è¯¢åªèƒ½ç”¨ä¸€æ¬¡ã€‚</p><hr><h5 id="_4-æ¯”å­æŸ¥è¯¢æ›´å®¹æ˜“è°ƒè¯•å’Œä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_4-æ¯”å­æŸ¥è¯¢æ›´å®¹æ˜“è°ƒè¯•å’Œä¼˜åŒ–"><span>4. <strong>æ¯”å­æŸ¥è¯¢æ›´å®¹æ˜“è°ƒè¯•å’Œä¼˜åŒ–</strong></span></a></h5><p>ä½ å¯ä»¥å…ˆè°ƒè¯• CTE ä¸­çš„éƒ¨åˆ†é€»è¾‘ï¼Œé€æ­¥æ„å»ºä¸»æŸ¥è¯¢ã€‚å¯¹äºä¼˜åŒ–å™¨æ¥è¯´ï¼Œæœ‰äº›æ•°æ®åº“ï¼ˆå¦‚ PostgreSQLï¼‰è¿˜ä¼šå°† CTE å†…è”æå‡æ€§èƒ½ï¼ˆMySQL ç›®å‰ä¸ä¸€å®šå†…è”ï¼‰ã€‚</p><hr><h5 id="ğŸ§ -å°è´´å£«-mysql-é™åˆ¶" tabindex="-1"><a class="header-anchor" href="#ğŸ§ -å°è´´å£«-mysql-é™åˆ¶"><span>ğŸ§  å°è´´å£«ï¼ˆMySQL é™åˆ¶ï¼‰</span></a></h5><ul><li>MySQL 8.0+ æ‰æ”¯æŒ CTEã€‚</li><li>CTE é»˜è®¤ä¸æ˜¯ materialized çš„ï¼ˆMySQL ä¼šå°½é‡ inlineï¼‰ã€‚</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">* å¦‚æœä½ å¸Œæœ›æ˜ç¡®â€œåªæ‰§è¡Œä¸€æ¬¡â€ï¼Œä½ å¯èƒ½éœ€è¦æ³¨æ„ä¸åŒæ•°æ®åº“ï¼ˆå¦‚ PostgreSQLã€SQL Server å’Œ MySQLï¼‰å¯¹ CTE çš„ä¼˜åŒ–ç­–ç•¥ä¸åŒã€‚</span>
<span class="line"></span>
<span class="line">---</span>
<span class="line"></span>
<span class="line">##### âœ… åœ¨ Symfony Doctrine ä¸­ç”¨æ³•ä¹Ÿå¾ˆå‹å¥½</span>
<span class="line"></span>
<span class="line">å¦‚æœä½ æ˜¯ç”¨ï¼š</span>
<span class="line"></span>
<span class="line">* \`-&gt;getConnection()-&gt;executeQuery($sql)\`ï¼šå¯ä»¥ç›´æ¥å†™ \`WITH\`ã€‚</span>
<span class="line">* Doctrine DQL ä¸æ”¯æŒ CTEï¼Œä½†å¯ä»¥é€šè¿‡åŸç”Ÿ SQL æˆ–ç”¨ Viewã€SubQuery å®ç°ç±»ä¼¼æ•ˆæœã€‚</span>
<span class="line"></span>
<span class="line">---</span>
<span class="line"></span>
<span class="line">##### CTE é»˜è®¤ä¸æ˜¯ materialized çš„ï¼ˆMySQL ä¼šå°½é‡ inlineï¼‰, æ€ä¹ˆç†è§£?</span>
<span class="line">è¿™ä¸ªé—®é¢˜éå¸¸å…³é”®ï¼Œå°¤å…¶å½“ä½ å¯¹æ€§èƒ½æ•æ„Ÿæ—¶ï¼Œ**CTE æ˜¯å¦ materializedï¼ˆç‰©åŒ–ï¼‰** ä¼šç›´æ¥å½±å“æŸ¥è¯¢çš„æ‰§è¡Œæ•ˆç‡ã€‚</span>
<span class="line"></span>
<span class="line">---</span>
<span class="line"></span>
<span class="line">##### ä»€ä¹ˆæ˜¯ CTE çš„ materialized ä¸ inlineï¼Ÿ</span>
<span class="line"></span>
<span class="line">å½“ä½ å†™ï¼š</span>
<span class="line"></span>
<span class="line">\`\`\`sql</span>
<span class="line">WITH my_cte AS (</span>
<span class="line">  SELECT ... FROM big_table WHERE condition</span>
<span class="line">)</span>
<span class="line">SELECT * FROM my_cte WHERE another_condition;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ•°æ®åº“æœ‰ä¸¤ç§æ‰§è¡Œç­–ç•¥ï¼š</p><table><thead><tr><th>ç­–ç•¥</th><th>è¯´æ˜</th><th>ä¼˜ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>materialized</strong>ï¼ˆç‰©åŒ–ï¼‰</td><td>æ•°æ®åº“å…ˆæ‰§è¡Œ <code>my_cte</code>ï¼Œå°†ç»“æœç¼“å­˜ï¼ˆä¸´æ—¶è¡¨ï¼‰ï¼Œç„¶åå†ç”¨äºä¸»æŸ¥è¯¢</td><td>âœ… ç»“æœå¤ç”¨ï¼Œé¿å…é‡å¤è®¡ç®—<br>âŒ å¯¹æ€§èƒ½æœ‰å¼€é”€ï¼ˆå†™å…¥ä¸´æ—¶è¡¨ï¼‰</td></tr><tr><td><strong>inline</strong>ï¼ˆå†…è”ï¼‰</td><td>æ•°æ®åº“æŠŠ <code>my_cte</code> çœ‹ä½œâ€œçº¯ç²¹çš„å­æŸ¥è¯¢â€ï¼Œæ¯ç”¨ä¸€æ¬¡å°±é‡æ–°æ‰§è¡Œä¸€æ¬¡</td><td>âœ… é¿å…ä¸´æ—¶è¡¨<br>âŒ å¤šæ¬¡å¼•ç”¨ä¼šé‡å¤è®¡ç®—ï¼Œå½±å“æ€§èƒ½</td></tr></tbody></table><hr><h5 id="ğŸ¬-mysql-ä¸­çš„è¡Œä¸º-é‡ç‚¹" tabindex="-1"><a class="header-anchor" href="#ğŸ¬-mysql-ä¸­çš„è¡Œä¸º-é‡ç‚¹"><span>ğŸ¬ MySQL ä¸­çš„è¡Œä¸ºï¼ˆé‡ç‚¹ï¼‰</span></a></h5><h5 id="âœ…-mysql-8-ä¸­-é»˜è®¤æ˜¯-inline-çš„" tabindex="-1"><a class="header-anchor" href="#âœ…-mysql-8-ä¸­-é»˜è®¤æ˜¯-inline-çš„"><span>âœ… MySQL 8+ ä¸­ï¼Œ<strong>é»˜è®¤æ˜¯ inline çš„</strong></span></a></h5><p>å³ï¼š<strong>CTE ä¸ä¼šè¢« materialized</strong>ï¼Œè€Œæ˜¯åƒâ€œè¯­æ³•ç³–çš„å­æŸ¥è¯¢â€ï¼Œåœ¨æŸ¥è¯¢æ ‘ä¸­æ¯æ¬¡å±•å¼€ã€‚</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">WITH</span> my_cte <span class="token keyword">AS</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> big_table <span class="token keyword">WHERE</span> col <span class="token operator">&gt;</span> <span class="token number">100</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> my_cte <span class="token keyword">WHERE</span> col <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç­‰ä»·äºï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> big_table <span class="token keyword">WHERE</span> col <span class="token operator">&gt;</span> <span class="token number">100</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token keyword">AS</span> my_cte</span>
<span class="line"><span class="token keyword">WHERE</span> col <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼š<strong>MySQL ä¸ä¼šå•ç‹¬æ‰§è¡Œ <code>my_cte</code> ä¸€æ¬¡å¹¶ç¼“å­˜ç»“æœã€‚</strong></p><hr><h5 id="ğŸ§ª-ä¸¾ä¸ªä¾‹å­å¸®åŠ©ä½ ç†è§£" tabindex="-1"><a class="header-anchor" href="#ğŸ§ª-ä¸¾ä¸ªä¾‹å­å¸®åŠ©ä½ ç†è§£"><span>ğŸ§ª ä¸¾ä¸ªä¾‹å­å¸®åŠ©ä½ ç†è§£</span></a></h5><h5 id="å‡è®¾" tabindex="-1"><a class="header-anchor" href="#å‡è®¾"><span>å‡è®¾ï¼š</span></a></h5><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">WITH</span> slow_query <span class="token keyword">AS</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">SELECT</span> SLEEP<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> delay <span class="token keyword">FROM</span> some_table</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> slow_query<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦‚æœæ˜¯ materializedï¼Œåªä¼š <code>SLEEP(1)</code> ä¸€æ¬¡ã€‚</li><li>å¦‚æœæ˜¯ inlineï¼Œä½ å¼•ç”¨å¤šæ¬¡ï¼Œå°±ä¼š <code>SLEEP(1)</code> å¤šæ¬¡ã€‚</li></ul><hr><h5 id="ğŸ§©-é‚£èƒ½ä¸èƒ½æ§åˆ¶å®ƒæ˜¯å¦-materialized-å‘¢" tabindex="-1"><a class="header-anchor" href="#ğŸ§©-é‚£èƒ½ä¸èƒ½æ§åˆ¶å®ƒæ˜¯å¦-materialized-å‘¢"><span>ğŸ§© é‚£èƒ½ä¸èƒ½æ§åˆ¶å®ƒæ˜¯å¦ materialized å‘¢ï¼Ÿ</span></a></h5><blockquote><p>âœ… åœ¨ MySQL 8.0.23+ å¼•å…¥äº†è¯­æ³•æ§åˆ¶ï¼š</p></blockquote><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">WITH</span> my_cte <span class="token keyword">AS</span> MATERIALIZED <span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">WITH</span> my_cte <span class="token keyword">AS</span> <span class="token operator">NOT</span> MATERIALIZED <span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ä½†æ³¨æ„" tabindex="-1"><a class="header-anchor" href="#ä½†æ³¨æ„"><span>ä½†æ³¨æ„ï¼š</span></a></h5><ul><li>é»˜è®¤æ˜¯ <strong>NOT MATERIALIZED</strong>ï¼ˆå³ inlineï¼‰</li><li><strong>PostgreSQL é»˜è®¤æ˜¯ MATERIALIZED</strong>ï¼Œå¯ä»¥æ‰‹åŠ¨åŠ  <code>NOT MATERIALIZED</code> æ§åˆ¶ï¼ˆæ­£ç›¸åï¼‰</li></ul><hr><h5 id="ğŸ”§-å°ç»“-mysql-é‡Œçš„ç†è§£" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-å°ç»“-mysql-é‡Œçš„ç†è§£"><span>ğŸ”§ å°ç»“ï¼ˆMySQL é‡Œçš„ç†è§£ï¼‰</span></a></h5><table><thead><tr><th>ç†è§£ç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>é»˜è®¤è¡Œä¸º</td><td>MySQL é»˜è®¤ä¸ç‰©åŒ–ï¼ˆinlineï¼‰</td></tr><tr><td>ä¼˜ç‚¹</td><td>å¿«é€Ÿã€é¿å…ä¸å¿…è¦çš„ä¸´æ—¶è¡¨</td></tr><tr><td>ç¼ºç‚¹</td><td>å¤šæ¬¡å¼•ç”¨æ—¶å¯èƒ½å¯¼è‡´é‡å¤è®¡ç®—</td></tr><tr><td>æ§åˆ¶æ–¹å¼ï¼ˆ8.0.23+ï¼‰</td><td>å¯æ˜¾å¼å†™ <code>AS MATERIALIZED</code></td></tr></tbody></table><hr><h5 id="ğŸ¯-ä½ è¯¥æ€ä¹ˆåš" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-ä½ è¯¥æ€ä¹ˆåš"><span>ğŸ¯ ä½ è¯¥æ€ä¹ˆåšï¼Ÿ</span></a></h5><ul><li><strong>ä¸€æ¬¡æ€§å¼•ç”¨ï¼Œinline è¶³å¤Ÿã€‚</strong></li><li><strong>å¤šæ¬¡å¼•ç”¨ or é€»è¾‘å¤æ‚ or æ•°æ®é‡å¤§ â†’ ç”¨ <code>AS MATERIALIZED</code> æé«˜æ€§èƒ½ï¼ˆ8.0.23+ï¼‰</strong></li><li>å¯¹äº<strong>å†™ä¸šåŠ¡å¤æ‚ç»Ÿè®¡ã€é€’å½’ã€å»é‡æ±‡æ€»è¡¨</strong>æ—¶ï¼Œmaterialized æ›´å®‰å…¨ã€‚</li><li>ç”¨ <code>EXPLAIN</code> æŸ¥çœ‹å®é™…æ‰§è¡Œè®¡åˆ’æ˜¯å…³é”®ã€‚</li></ul><hr>`,59)]))}const o=n(l,[["render",i],["__file","symfony7ä¹‹ä½¿ç”¨mysql8çš„CTEåŠŸèƒ½.html.vue"]]),r=JSON.parse('{"path":"/content/database/mysql/symfony7%E4%B9%8B%E4%BD%BF%E7%94%A8mysql8%E7%9A%84CTE%E5%8A%9F%E8%83%BD.html","title":"symfony7ä¹‹ä½¿ç”¨mysql8çš„CTEåŠŸèƒ½","lang":"en-US","frontmatter":{"sidebar":false,"title":"symfony7ä¹‹ä½¿ç”¨mysql8çš„CTEåŠŸèƒ½","head":[["meta",{"name":"title","content":"symfony7ä¹‹ä½¿ç”¨mysql8çš„CTEåŠŸèƒ½"}],["meta",{"name":"description","content":"symfony7ä¹‹ä½¿ç”¨mysql8çš„CTEåŠŸèƒ½"}],["meta",{"name":"keywords","content":"symfony7,mysql8"}],["meta",{"property":"og:title","content":"symfony7ä¹‹ä½¿ç”¨mysql8çš„CTEåŠŸèƒ½"}],["meta",{"property":"og:description","content":"symfony7ä¹‹ä½¿ç”¨mysql8çš„CTEåŠŸèƒ½"}]]},"headers":[],"git":{},"filePathRelative":"content/database/mysql/symfony7ä¹‹ä½¿ç”¨mysql8çš„CTEåŠŸèƒ½.md"}');export{o as comp,r as data};
