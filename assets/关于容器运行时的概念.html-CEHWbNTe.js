import{_ as e,c as s,f as a,o as i}from"./app-BB_BIQV8.js";const l={};function t(r,n){return i(),s("div",null,n[0]||(n[0]=[a(`<h2 id="ğŸ“œ-ç¬¬ä¸€éƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#ğŸ“œ-ç¬¬ä¸€éƒ¨åˆ†"><span>ğŸ“œ ç¬¬ä¸€éƒ¨åˆ†</span></a></h2><h2 id="å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ"><span>å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ</span></a></h2><h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯ã€Œè¿è¡Œæ—¶ã€-runtime" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€ä»€ä¹ˆæ˜¯ã€Œè¿è¡Œæ—¶ã€-runtime"><span>ä¸€ã€ä»€ä¹ˆæ˜¯ã€Œè¿è¡Œæ—¶ã€(Runtime)</span></a></h2><h3 id="æ ¸å¿ƒå®šä¹‰" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒå®šä¹‰"><span>æ ¸å¿ƒå®šä¹‰</span></a></h3><blockquote><p><strong>è¿è¡Œæ—¶ = æŠŠ&quot;æè¿°&quot;å˜æˆ&quot;æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹&quot;çš„é‚£ä¸€å±‚</strong></p></blockquote><p>æ›´å…·ä½“ä¸€ç‚¹ï¼š</p><blockquote><p><strong>è¿è¡Œæ—¶è´Ÿè´£ï¼š</strong></p><ul><li>åˆ›å»º Linux è¿›ç¨‹</li><li>è®¾ç½® namespace(pid / net / mount / userâ€¦)</li><li>è®¾ç½® cgroup(CPU / memory / io)</li><li>æŒ‚è½½ rootfs</li><li><code>exec()</code> ä½ çš„ç¨‹åº</li></ul></blockquote><p>ğŸ“Œ <strong>åªè¦çœŸæ­£åšäº†è¿™äº›äº‹ï¼Œå°±å«è¿è¡Œæ—¶</strong></p><hr><h3 id="è¿è¡Œæ—¶-æ„å»ºå·¥å…·" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œæ—¶-æ„å»ºå·¥å…·"><span>è¿è¡Œæ—¶ â‰  æ„å»ºå·¥å…·</span></a></h3><table><thead><tr><th>åŠ¨ä½œ</th><th>æ˜¯è¿è¡Œæ—¶å—</th></tr></thead><tbody><tr><td>docker build</td><td>âŒ</td></tr><tr><td>docker push</td><td>âŒ</td></tr><tr><td>docker pull</td><td>âŒ</td></tr><tr><td>docker run(CLI)</td><td>âŒ(åªæ˜¯å…¥å£)</td></tr><tr><td>runc</td><td>âœ…</td></tr><tr><td>containerd(å¯¹ K8s)</td><td>âœ…(é«˜å±‚)</td></tr></tbody></table><hr><h2 id="äºŒã€docker-é‡Œçš„ã€Œè¿è¡Œæ—¶ã€æ˜¯æ€ä¹ˆä½“ç°çš„" tabindex="-1"><a class="header-anchor" href="#äºŒã€docker-é‡Œçš„ã€Œè¿è¡Œæ—¶ã€æ˜¯æ€ä¹ˆä½“ç°çš„"><span>äºŒã€Docker é‡Œçš„ã€Œè¿è¡Œæ—¶ã€æ˜¯æ€ä¹ˆä½“ç°çš„ï¼Ÿ</span></a></h2><h3 id="docker-æ¶æ„-ç®€åŒ–" tabindex="-1"><a class="header-anchor" href="#docker-æ¶æ„-ç®€åŒ–"><span>Docker æ¶æ„(ç®€åŒ–)</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">docker CLI</span>
<span class="line">   â†“</span>
<span class="line">Docker Engine</span>
<span class="line">   â†“</span>
<span class="line">containerd</span>
<span class="line">   â†“</span>
<span class="line">runc   â† çœŸæ­£çš„è¿è¡Œæ—¶</span>
<span class="line">   â†“</span>
<span class="line">Linux å†…æ ¸</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="docker-ä¸­çš„-è¿è¡Œæ—¶åˆ†å±‚" tabindex="-1"><a class="header-anchor" href="#docker-ä¸­çš„-è¿è¡Œæ—¶åˆ†å±‚"><span>Docker ä¸­çš„&quot;è¿è¡Œæ—¶åˆ†å±‚&quot;</span></a></h4><h4 id="_1ï¸âƒ£-docker-engine-ä¸æ˜¯è¿è¡Œæ—¶" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-docker-engine-ä¸æ˜¯è¿è¡Œæ—¶"><span>1ï¸âƒ£ Docker Engine(ä¸æ˜¯è¿è¡Œæ—¶)</span></a></h4><ul><li>æä¾› API(docker ps / logs)</li><li>ç®¡ç†é•œåƒã€ç½‘ç»œã€volume</li><li><strong>ä¸ç›´æ¥åˆ›å»º Linux è¿›ç¨‹</strong></li></ul><p>âŒ ä¸æ˜¯è¿è¡Œæ—¶</p><hr><h4 id="_2ï¸âƒ£-containerd-é«˜å±‚è¿è¡Œæ—¶" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-containerd-é«˜å±‚è¿è¡Œæ—¶"><span>2ï¸âƒ£ containerd(é«˜å±‚è¿è¡Œæ—¶)</span></a></h4><ul><li>ç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸ</li><li>ç®¡ç†é•œåƒ</li><li>è°ƒç”¨ runc</li></ul><p>âš ï¸ <strong>åœ¨ Docker é‡Œæ˜¯&quot;å†…éƒ¨ç»„ä»¶&quot;</strong></p><hr><h4 id="_3ï¸âƒ£-runc-ä½å±‚è¿è¡Œæ—¶-çœŸÂ·æ‰§è¡Œè€…" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£-runc-ä½å±‚è¿è¡Œæ—¶-çœŸÂ·æ‰§è¡Œè€…"><span>3ï¸âƒ£ runc(ä½å±‚è¿è¡Œæ—¶ / çœŸÂ·æ‰§è¡Œè€…)</span></a></h4><ul><li>å®ç° OCI Runtime Spec</li><li>ç›´æ¥è°ƒç”¨ Linux å†…æ ¸</li><li>åˆ›å»ºå®¹å™¨è¿›ç¨‹</li></ul><p>âœ… <strong>Docker é‡Œçš„çœŸæ­£è¿è¡Œæ—¶</strong></p><hr><h3 id="docker-ä¸‹è¿è¡Œæµç¨‹-ä¸€å¥è¯" tabindex="-1"><a class="header-anchor" href="#docker-ä¸‹è¿è¡Œæµç¨‹-ä¸€å¥è¯"><span>Docker ä¸‹è¿è¡Œæµç¨‹(ä¸€å¥è¯)</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">docker run</span>
<span class="line"> â†’ Docker Engine</span>
<span class="line"> â†’ containerd</span>
<span class="line"> â†’ runc</span>
<span class="line"> â†’ Linux è¿›ç¨‹</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="ä¸‰ã€kubernetes-é‡Œçš„ã€Œè¿è¡Œæ—¶ã€æ˜¯æ€ä¹ˆä½“ç°çš„" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€kubernetes-é‡Œçš„ã€Œè¿è¡Œæ—¶ã€æ˜¯æ€ä¹ˆä½“ç°çš„"><span>ä¸‰ã€Kubernetes é‡Œçš„ã€Œè¿è¡Œæ—¶ã€æ˜¯æ€ä¹ˆä½“ç°çš„ï¼Ÿ</span></a></h2><h3 id="kubernetes-çš„è®¾è®¡åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#kubernetes-çš„è®¾è®¡åŸåˆ™"><span>Kubernetes çš„è®¾è®¡åŸåˆ™</span></a></h3><blockquote><p><strong>K8s ä¸å…³å¿ƒä½ ç”¨ä»€ä¹ˆå®¹å™¨æŠ€æœ¯ï¼Œåªè¦ä½ å®ç°æ¥å£</strong></p></blockquote><p>æ‰€ä»¥å®ƒå®šä¹‰äº†ï¼š</p><blockquote><p><strong>CRI(Container Runtime Interface)</strong></p></blockquote><hr><h3 id="k8s-æ¶æ„-æ ‡å‡†å½¢æ€" tabindex="-1"><a class="header-anchor" href="#k8s-æ¶æ„-æ ‡å‡†å½¢æ€"><span>K8s æ¶æ„(æ ‡å‡†å½¢æ€)</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubelet</span>
<span class="line">   â†“</span>
<span class="line">CRI</span>
<span class="line">   â†“</span>
<span class="line">containerd / CRI-O   â† K8s çš„è¿è¡Œæ—¶</span>
<span class="line">   â†“</span>
<span class="line">runc / crun          â† OCI Runtime</span>
<span class="line">   â†“</span>
<span class="line">Linux å†…æ ¸</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="kubernetes-ä¸­çš„-è¿è¡Œæ—¶-ä¸¤å±‚" tabindex="-1"><a class="header-anchor" href="#kubernetes-ä¸­çš„-è¿è¡Œæ—¶-ä¸¤å±‚"><span>Kubernetes ä¸­çš„&quot;è¿è¡Œæ—¶&quot;ä¸¤å±‚</span></a></h3><h4 id="_1ï¸âƒ£-cri-runtime-k8s-è¯­å¢ƒé‡Œçš„-è¿è¡Œæ—¶" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-cri-runtime-k8s-è¯­å¢ƒé‡Œçš„-è¿è¡Œæ—¶"><span>1ï¸âƒ£ CRI Runtime(K8s è¯­å¢ƒé‡Œçš„&quot;è¿è¡Œæ—¶&quot;)</span></a></h4><ul><li>containerd</li><li>CRI-O</li></ul><p>èŒè´£ï¼š</p><ul><li>å®ç° CRI æ¥å£</li><li>æ‹‰é•œåƒ</li><li>åˆ›å»º / ç®¡ç† Pod ä¸­çš„å®¹å™¨</li><li>è°ƒç”¨ OCI Runtime</li></ul><p>ğŸ“Œ <strong>K8s å®˜æ–¹è¯´çš„&quot;runtime&quot;é€šå¸¸æŒ‡è¿™ä¸€å±‚</strong></p><hr><h4 id="_2ï¸âƒ£-oci-runtime-çœŸæ­£æ‰§è¡Œå±‚" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-oci-runtime-çœŸæ­£æ‰§è¡Œå±‚"><span>2ï¸âƒ£ OCI Runtime(çœŸæ­£æ‰§è¡Œå±‚)</span></a></h4><ul><li>runc</li><li>crun</li><li>kata-runtime</li></ul><p>èŒè´£ï¼š</p><ul><li>åˆ›å»º namespace / cgroup</li><li>exec å®¹å™¨è¿›ç¨‹</li></ul><p>ğŸ“Œ <strong>å’Œ Docker å®Œå…¨ä¸€è‡´</strong></p><hr><h3 id="kubernetes-ä¸‹è¿è¡Œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#kubernetes-ä¸‹è¿è¡Œæµç¨‹"><span>Kubernetes ä¸‹è¿è¡Œæµç¨‹</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Pod YAML</span>
<span class="line">   â†“</span>
<span class="line">kubelet</span>
<span class="line">   â†“</span>
<span class="line">CRI (gRPC)</span>
<span class="line">   â†“</span>
<span class="line">containerd / CRI-O</span>
<span class="line">   â†“</span>
<span class="line">OCI Runtime (runc)</span>
<span class="line">   â†“</span>
<span class="line">Linux è¿›ç¨‹</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="å››ã€oci-åœ¨-docker-å’Œ-k8s-ä¸­çš„ä½ç½®" tabindex="-1"><a class="header-anchor" href="#å››ã€oci-åœ¨-docker-å’Œ-k8s-ä¸­çš„ä½ç½®"><span>å››ã€OCI åœ¨ Docker å’Œ K8s ä¸­çš„ä½ç½®</span></a></h2><h3 id="oci-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#oci-æ˜¯ä»€ä¹ˆ"><span>OCI æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><blockquote><p><strong>OCI = è§„èŒƒï¼Œä¸æ˜¯ç¨‹åº</strong></p></blockquote><p>å®ƒè§„å®šä¸¤ä»¶æ ¸å¿ƒäº‹æƒ…ï¼š</p><hr><h3 id="_1ï¸âƒ£-oci-image-spec-é•œåƒè§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-oci-image-spec-é•œåƒè§„èŒƒ"><span>1ï¸âƒ£ OCI Image Spec(é•œåƒè§„èŒƒ)</span></a></h3><p><strong>Docker / K8s é€šç”¨</strong></p><ul><li>Docker build â†’ OCI Image</li><li>containerd pull â†’ OCI Image</li><li>K8s image: xxx â†’ OCI Image</li></ul><p>ğŸ“Œ <strong>&quot;Docker é•œåƒ&quot;æœ¬è´¨ = OCI é•œåƒ</strong></p><hr><h3 id="_2ï¸âƒ£-oci-runtime-spec-è¿è¡Œè§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-oci-runtime-spec-è¿è¡Œè§„èŒƒ"><span>2ï¸âƒ£ OCI Runtime Spec(è¿è¡Œè§„èŒƒ)</span></a></h3><p><strong>Docker / K8s é€šç”¨</strong></p><ul><li>runc / crun éƒ½å®ç°å®ƒ</li><li>å®šä¹‰ <code>config.json</code></li><li>å®šä¹‰å®¹å™¨å¯åŠ¨æ–¹å¼</li></ul><p>ğŸ“Œ <strong>æ‰€æœ‰è¿è¡Œæ—¶çš„&quot;å®ªæ³•&quot;</strong></p><hr><h3 id="oci-åœ¨æµç¨‹ä¸­çš„ä½“ç°" tabindex="-1"><a class="header-anchor" href="#oci-åœ¨æµç¨‹ä¸­çš„ä½“ç°"><span>OCI åœ¨æµç¨‹ä¸­çš„ä½“ç°</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">æ„å»ºé˜¶æ®µï¼š</span>
<span class="line">Docker build</span>
<span class="line"> â†’ OCI Image Spec</span>
<span class="line"></span>
<span class="line">è¿è¡Œé˜¶æ®µï¼š</span>
<span class="line">containerd / CRI-O</span>
<span class="line"> â†’ OCI Runtime Spec</span>
<span class="line"> â†’ runc</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="äº”ã€cri-åœ¨å“ªé‡Œ-åªå±äº-kubernetes" tabindex="-1"><a class="header-anchor" href="#äº”ã€cri-åœ¨å“ªé‡Œ-åªå±äº-kubernetes"><span>äº”ã€CRI åœ¨å“ªé‡Œï¼Ÿåªå±äº Kubernetes</span></a></h2><h3 id="cri-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#cri-æ˜¯ä»€ä¹ˆ"><span>CRI æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><blockquote><p><strong>CRI = Kubernetes å®šä¹‰çš„&quot;è¿è¡Œæ—¶æ¥å£&quot;</strong></p></blockquote><ul><li>gRPC æ¥å£</li><li>åªå­˜åœ¨äº K8s</li><li>Docker æ²¡æœ‰ CRI</li></ul><hr><h3 id="cri-è§£å†³çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#cri-è§£å†³çš„é—®é¢˜"><span>CRI è§£å†³çš„é—®é¢˜</span></a></h3><blockquote><p>kubelet ä¸æƒ³é€‚é…æ¯ä¸€ç§å®¹å™¨å®ç°</p></blockquote><p>æ‰€ä»¥ï¼š</p><ul><li>kubelet â†” CRI</li><li>containerd / CRI-O å®ç° CRI</li></ul><hr><h3 id="cri-åœ¨æµç¨‹ä¸­çš„ä½“ç°" tabindex="-1"><a class="header-anchor" href="#cri-åœ¨æµç¨‹ä¸­çš„ä½“ç°"><span>CRI åœ¨æµç¨‹ä¸­çš„ä½“ç°</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubelet</span>
<span class="line">   â†“(CRI)</span>
<span class="line">containerd / CRI-O</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ“Œ <strong>CRI æŠŠ K8s å’Œå…·ä½“å®¹å™¨æŠ€æœ¯è§£è€¦</strong></p><hr><h2 id="å…­ã€ä¸€å¼ -ç»ˆæå¯¹ç…§è¡¨-å»ºè®®ä¿å­˜" tabindex="-1"><a class="header-anchor" href="#å…­ã€ä¸€å¼ -ç»ˆæå¯¹ç…§è¡¨-å»ºè®®ä¿å­˜"><span>å…­ã€ä¸€å¼ &quot;ç»ˆæå¯¹ç…§è¡¨&quot;(å»ºè®®ä¿å­˜)</span></a></h2><table><thead><tr><th>æ¦‚å¿µ</th><th>Docker</th><th>Kubernetes</th></tr></thead><tbody><tr><td>é•œåƒè§„èŒƒ</td><td>OCI Image</td><td>OCI Image</td></tr><tr><td>è¿è¡Œæ—¶æ¥å£</td><td>âŒ</td><td>CRI</td></tr><tr><td>é«˜å±‚è¿è¡Œæ—¶</td><td>containerd(å†…éƒ¨)</td><td>containerd / CRI-O</td></tr><tr><td>ä½å±‚è¿è¡Œæ—¶</td><td>runc</td><td>runc / crun</td></tr><tr><td>çœŸæ­£ exec</td><td>runc</td><td>runc</td></tr><tr><td>Docker Engine</td><td>å¿…éœ€</td><td>âŒ ä¸å­˜åœ¨</td></tr></tbody></table><hr><h2 id="ä¸ƒã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“-å¯ä»¥èƒŒ" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“-å¯ä»¥èƒŒ"><span>ä¸ƒã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“(å¯ä»¥èƒŒ)</span></a></h2><blockquote><p><strong>è¿è¡Œæ—¶ = æŠŠ OCI é•œåƒå˜æˆ Linux è¿›ç¨‹çš„ç³»ç»Ÿ</strong></p><ul><li>Dockerï¼šè¿è¡Œæ—¶è—åœ¨ Docker Engine é‡Œé¢</li><li>Kubernetesï¼šè¿è¡Œæ—¶æ˜¯æ˜¾å¼çš„(CRI â†’ OCI Runtime)</li><li>OCIï¼šç»Ÿä¸€&quot;é•œåƒæ ¼å¼&quot;å’Œ&quot;è¿è¡Œè§„åˆ™&quot;</li><li>CRIï¼šK8s ä¸“ç”¨çš„&quot;è¿è¡Œæ—¶æ¥å£&quot;</li></ul></blockquote><hr><h2 id="ğŸ“œ-ç¬¬äºŒéƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#ğŸ“œ-ç¬¬äºŒéƒ¨åˆ†"><span>ğŸ“œ ç¬¬äºŒéƒ¨åˆ†</span></a></h2><h2 id="ä¸¾ä¾‹è¯´æ˜-åŒä¸€ä¸ª-nginx-é•œåƒ-å¯¹æ¯”-docker-run-å’Œ-kubectl-run-çš„çœŸå®æ‰§è¡Œè·¯å¾„" tabindex="-1"><a class="header-anchor" href="#ä¸¾ä¾‹è¯´æ˜-åŒä¸€ä¸ª-nginx-é•œåƒ-å¯¹æ¯”-docker-run-å’Œ-kubectl-run-çš„çœŸå®æ‰§è¡Œè·¯å¾„"><span>ä¸¾ä¾‹è¯´æ˜: åŒä¸€ä¸ª nginx é•œåƒ å¯¹æ¯” docker run å’Œ kubectl run çš„çœŸå®æ‰§è¡Œè·¯å¾„</span></a></h2><p>æˆ‘ä»¬ç”¨ <strong>åŒä¸€ä¸ª nginx é•œåƒ</strong>ï¼ŒæŠŠ<br> ğŸ‘‰ <code>docker run nginx</code><br> ğŸ‘‰ <code>kubectl run nginx</code><br> çš„<strong>çœŸå®æ‰§è¡Œè·¯å¾„</strong>é€å±‚æ‹†å¼€ï¼Œå¯¹ç…§ <strong>è¿è¡Œæ—¶ / CRI / OCI</strong>ã€‚</p><hr><h2 id="ä¸€ã€å…ˆç»™ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å…ˆç»™ç»“è®º"><span>ä¸€ã€å…ˆç»™ç»“è®º</span></a></h2><blockquote><p><strong>docker run</strong> â†’ ç›´æ¥èµ° <strong>Docker è‡ªå·±çš„è¿è¡Œé“¾è·¯</strong></p></blockquote><blockquote><p><strong>kubectl run</strong> â†’ èµ° <strong>Kubernetes â†’ CRI â†’ containerd / CRI-O â†’ OCI Runtime</strong></p></blockquote><p><strong>é•œåƒæ˜¯åŒä¸€ä¸ªï¼Œè¿è¡Œè·¯å¾„å®Œå…¨ä¸åŒã€‚</strong></p><hr><h2 id="äºŒã€docker-run-nginx-çœŸå®æ‰§è¡Œè·¯å¾„" tabindex="-1"><a class="header-anchor" href="#äºŒã€docker-run-nginx-çœŸå®æ‰§è¡Œè·¯å¾„"><span>äºŒã€docker run nginxï¼šçœŸå®æ‰§è¡Œè·¯å¾„</span></a></h2><h3 id="ä½ æ•²çš„å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#ä½ æ•²çš„å‘½ä»¤"><span>ä½ æ•²çš„å‘½ä»¤</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> run nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h3 id="å®é™…å‘ç”Ÿçš„é“¾è·¯-ç²¾ç®€ä½†å‡†ç¡®" tabindex="-1"><a class="header-anchor" href="#å®é™…å‘ç”Ÿçš„é“¾è·¯-ç²¾ç®€ä½†å‡†ç¡®"><span>å®é™…å‘ç”Ÿçš„é“¾è·¯(ç²¾ç®€ä½†å‡†ç¡®)</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">docker CLI</span>
<span class="line">   â†“  REST API</span>
<span class="line">Docker Engine (dockerd)</span>
<span class="line">   â†“</span>
<span class="line">containerd</span>
<span class="line">   â†“</span>
<span class="line">OCI Runtime (runc)</span>
<span class="line">   â†“</span>
<span class="line">Linux kernel</span>
<span class="line">   â†“</span>
<span class="line">nginx è¿›ç¨‹</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="æ¯ä¸€å±‚å¹²äº†ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#æ¯ä¸€å±‚å¹²äº†ä»€ä¹ˆ"><span>æ¯ä¸€å±‚å¹²äº†ä»€ä¹ˆï¼Ÿ</span></a></h3><h4 id="_1ï¸âƒ£-docker-cli" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-docker-cli"><span>1ï¸âƒ£ docker CLI</span></a></h4><ul><li>è§£æå‘½ä»¤</li><li>è°ƒç”¨ Docker Engine API</li></ul><hr><h4 id="_2ï¸âƒ£-docker-engine-dockerd" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-docker-engine-dockerd"><span>2ï¸âƒ£ Docker Engine(dockerd)</span></a></h4><ul><li>åˆ›å»ºå®¹å™¨å…ƒæ•°æ®</li><li>åˆ›å»ºç½‘ç»œ / volume</li><li>è°ƒ containerd</li></ul><hr><h4 id="_3ï¸âƒ£-containerd" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£-containerd"><span>3ï¸âƒ£ containerd</span></a></h4><ul><li>æ‹‰ nginx é•œåƒ(OCI Image)</li><li>å‡†å¤‡ rootfs</li><li>ç”Ÿæˆ OCI <code>config.json</code></li></ul><hr><h4 id="_4ï¸âƒ£-runc-oci-runtime" tabindex="-1"><a class="header-anchor" href="#_4ï¸âƒ£-runc-oci-runtime"><span>4ï¸âƒ£ runc(OCI Runtime)</span></a></h4><ul><li>åˆ›å»º namespace / cgroup</li><li>mount rootfs</li><li><code>exec nginx</code></li></ul><p>ğŸ“Œ <strong>çœŸæ­£è¿è¡Œ nginx çš„æ˜¯ runc</strong></p><hr><h4 id="_5ï¸âƒ£-linux-kernel" tabindex="-1"><a class="header-anchor" href="#_5ï¸âƒ£-linux-kernel"><span>5ï¸âƒ£ Linux kernel</span></a></h4><ul><li>nginx æˆä¸ºä¸€ä¸ªæ™®é€šè¿›ç¨‹(è¢«éš”ç¦»)</li></ul><hr><h3 id="ä½ åœ¨ç³»ç»Ÿé‡Œçœ‹åˆ°çš„ç»“æœ" tabindex="-1"><a class="header-anchor" href="#ä½ åœ¨ç³»ç»Ÿé‡Œçœ‹åˆ°çš„ç»“æœ"><span>ä½ åœ¨ç³»ç»Ÿé‡Œçœ‹åˆ°çš„ç»“æœ</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> <span class="token function">ps</span></span>
<span class="line"><span class="token function">docker</span> logs</span>
<span class="line"><span class="token function">docker</span> inspect</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="ä¸‰ã€kubectl-run-nginx-çœŸå®æ‰§è¡Œè·¯å¾„" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€kubectl-run-nginx-çœŸå®æ‰§è¡Œè·¯å¾„"><span>ä¸‰ã€kubectl run nginxï¼šçœŸå®æ‰§è¡Œè·¯å¾„</span></a></h2><h3 id="ä½ æ•²çš„å‘½ä»¤-1" tabindex="-1"><a class="header-anchor" href="#ä½ æ•²çš„å‘½ä»¤-1"><span>ä½ æ•²çš„å‘½ä»¤</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">kubectl run nginx <span class="token parameter variable">--image</span><span class="token operator">=</span>nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h3 id="å®é™…å‘ç”Ÿçš„é“¾è·¯-ç²¾ç®€ä½†å‡†ç¡®-1" tabindex="-1"><a class="header-anchor" href="#å®é™…å‘ç”Ÿçš„é“¾è·¯-ç²¾ç®€ä½†å‡†ç¡®-1"><span>å®é™…å‘ç”Ÿçš„é“¾è·¯(ç²¾ç®€ä½†å‡†ç¡®)</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubectl</span>
<span class="line">   â†“  REST</span>
<span class="line">kube-apiserver</span>
<span class="line">   â†“</span>
<span class="line">etcd</span>
<span class="line">   â†“</span>
<span class="line">kubelet (node)</span>
<span class="line">   â†“  CRI (gRPC)</span>
<span class="line">containerd / CRI-O</span>
<span class="line">   â†“</span>
<span class="line">OCI Runtime (runc)</span>
<span class="line">   â†“</span>
<span class="line">Linux kernel</span>
<span class="line">   â†“</span>
<span class="line">nginx è¿›ç¨‹</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="æ¯ä¸€å±‚å¹²äº†ä»€ä¹ˆ-1" tabindex="-1"><a class="header-anchor" href="#æ¯ä¸€å±‚å¹²äº†ä»€ä¹ˆ-1"><span>æ¯ä¸€å±‚å¹²äº†ä»€ä¹ˆï¼Ÿ</span></a></h3><h4 id="_1ï¸âƒ£-kubectl" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-kubectl"><span>1ï¸âƒ£ kubectl</span></a></h4><ul><li>æŠŠå‘½ä»¤è½¬æ¢æˆ Pod YAML</li><li>å‘ç»™ kube-apiserver</li></ul><hr><h4 id="_2ï¸âƒ£-kube-apiserver" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-kube-apiserver"><span>2ï¸âƒ£ kube-apiserver</span></a></h4><ul><li>æ ¡éªŒ</li><li>å†™å…¥ etcd</li></ul><hr><h4 id="_3ï¸âƒ£-kubelet-èŠ‚ç‚¹ä¸Š" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£-kubelet-èŠ‚ç‚¹ä¸Š"><span>3ï¸âƒ£ kubelet(èŠ‚ç‚¹ä¸Š)</span></a></h4><ul><li>watch åˆ°æ–° Pod</li><li>è°ƒç”¨ CRI æ¥å£</li></ul><hr><h4 id="_4ï¸âƒ£-cri-runtime-containerd-cri-o" tabindex="-1"><a class="header-anchor" href="#_4ï¸âƒ£-cri-runtime-containerd-cri-o"><span>4ï¸âƒ£ CRI Runtime(containerd / CRI-O)</span></a></h4><ul><li>æ‹‰ nginx é•œåƒ(OCI Image)</li><li>åˆ›å»º Pod Sandbox</li><li>å‡†å¤‡å®¹å™¨</li></ul><hr><h4 id="_5ï¸âƒ£-runc-oci-runtime" tabindex="-1"><a class="header-anchor" href="#_5ï¸âƒ£-runc-oci-runtime"><span>5ï¸âƒ£ runc(OCI Runtime)</span></a></h4><ul><li>å®Œå…¨åŒ docker run</li><li>åˆ›å»º namespace / cgroup</li><li>exec nginx</li></ul><p>ğŸ“Œ <strong>è¿™é‡Œå’Œ Docker å®Œå…¨ä¸€è‡´</strong></p><hr><h3 id="ä½ åœ¨ç³»ç»Ÿé‡Œçœ‹åˆ°çš„ç»“æœ-1" tabindex="-1"><a class="header-anchor" href="#ä½ åœ¨ç³»ç»Ÿé‡Œçœ‹åˆ°çš„ç»“æœ-1"><span>ä½ åœ¨ç³»ç»Ÿé‡Œçœ‹åˆ°çš„ç»“æœ</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">kubectl get pods</span>
<span class="line">kubectl logs nginx</span>
<span class="line">crictl <span class="token function">ps</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>âŒ <code>docker ps</code> çœ‹ä¸åˆ°</p><hr><h2 id="å››ã€ä¸¤æ¡è·¯å¾„å¹¶æ’å¯¹ç…§-é‡ç‚¹" tabindex="-1"><a class="header-anchor" href="#å››ã€ä¸¤æ¡è·¯å¾„å¹¶æ’å¯¹ç…§-é‡ç‚¹"><span>å››ã€ä¸¤æ¡è·¯å¾„å¹¶æ’å¯¹ç…§(é‡ç‚¹)</span></a></h2><table><thead><tr><th>å¯¹æ¯”ç‚¹</th><th>docker run</th><th>kubectl run</th></tr></thead><tbody><tr><td>é•œåƒ</td><td>nginx(OCI)</td><td>nginx(OCI)</td></tr><tr><td>å‘½ä»¤å…¥å£</td><td>docker CLI</td><td>kubectl</td></tr><tr><td>è°ƒåº¦</td><td>âŒ</td><td>âœ…</td></tr><tr><td>API Server</td><td>âŒ</td><td>âœ…</td></tr><tr><td>CRI</td><td>âŒ</td><td>âœ…</td></tr><tr><td>Docker Engine</td><td>âœ…</td><td>âŒ</td></tr><tr><td>containerd</td><td>âœ…</td><td>âœ…</td></tr><tr><td>runc</td><td>âœ…</td><td>âœ…</td></tr><tr><td>çœŸæ­£ exec</td><td>runc</td><td>runc</td></tr></tbody></table><hr><h2 id="äº”ã€æœ€å®¹æ˜“è¯¯è§£çš„ä¸€ç‚¹" tabindex="-1"><a class="header-anchor" href="#äº”ã€æœ€å®¹æ˜“è¯¯è§£çš„ä¸€ç‚¹"><span>äº”ã€æœ€å®¹æ˜“è¯¯è§£çš„ä¸€ç‚¹</span></a></h2><blockquote><p><strong>Docker å¹¶æ²¡æœ‰&quot;è·‘å®¹å™¨&quot;</strong><strong>Kubernetes ä¹Ÿæ²¡æœ‰&quot;è·‘å®¹å™¨&quot;</strong></p></blockquote><p>çœŸæ­£è·‘å®¹å™¨çš„ï¼Œæ°¸è¿œæ˜¯ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">OCI Runtime(runc)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="å…­ã€ä¸€ä¸ªéªŒè¯æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#å…­ã€ä¸€ä¸ªéªŒè¯æ–¹æ³•"><span>å…­ã€ä¸€ä¸ªéªŒè¯æ–¹æ³•</span></a></h2><p>åœ¨ K8s èŠ‚ç‚¹ä¸Šï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½ ä¼šçœ‹åˆ°ï¼š</p><ul><li>docker run çš„ nginx</li><li>kubectl run çš„ nginx</li></ul><p>å®ƒä»¬åœ¨å†…æ ¸å±‚é¢<strong>å®Œå…¨ä¸€æ ·</strong></p><hr><h2 id="ä¸ƒã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“"><span>ä¸ƒã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“</span></a></h2><blockquote><p>åŒä¸€ä¸ª nginx é•œåƒï¼š</p><ul><li><code>docker run</code> èµ° <strong>Docker Engine é“¾è·¯</strong></li><li><code>kubectl run</code> èµ° <strong>Kubernetes â†’ CRI é“¾è·¯</strong></li></ul><p>ä½†åœ¨æœ€åä¸€è·³ï¼Œ<strong>å®ƒä»¬éƒ½ç”± runc åˆ›å»º Linux è¿›ç¨‹</strong>ï¼Œåªæ˜¯åˆ°è¾¾containerdçš„æ–¹å¼ä¸åŒ</p></blockquote><hr><h2 id="ğŸ“œç¬¬ä¸‰éƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#ğŸ“œç¬¬ä¸‰éƒ¨åˆ†"><span>ğŸ“œç¬¬ä¸‰éƒ¨åˆ†</span></a></h2><h2 id="åˆ°è¾¾containerdçš„æ–¹å¼ä¸åŒ-è¯¦ç»†åˆ†æ" tabindex="-1"><a class="header-anchor" href="#åˆ°è¾¾containerdçš„æ–¹å¼ä¸åŒ-è¯¦ç»†åˆ†æ"><span><strong>åˆ°è¾¾containerdçš„æ–¹å¼ä¸åŒ</strong> è¯¦ç»†åˆ†æ</span></a></h2><blockquote><p><strong>docker run å’Œ kubectl run çš„æ ¸å¿ƒåŒºåˆ«ï¼š æ˜¯ã€Œåˆ°è¾¾ containerd çš„æ–¹å¼ä¸åŒã€</strong></p></blockquote><p>è€Œä¸æ˜¯ï¼š</p><ul><li>é•œåƒä¸åŒ âŒ</li><li>runc ä¸åŒ âŒ</li><li>Linux å†…æ ¸ä¸åŒ âŒ</li></ul><hr><h3 id="ç”¨ä¸€å¥-è·¯å¾„è¡¨è¾¾å¼-æ¥å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#ç”¨ä¸€å¥-è·¯å¾„è¡¨è¾¾å¼-æ¥å¯¹æ¯”"><span>ç”¨ä¸€å¥&quot;è·¯å¾„è¡¨è¾¾å¼&quot;æ¥å¯¹æ¯”</span></a></h3><h4 id="docker-run" tabindex="-1"><a class="header-anchor" href="#docker-run"><span>docker run</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">docker CLI</span>
<span class="line"> â†’ Docker Engine (dockerd)</span>
<span class="line"> â†’ containerd</span>
<span class="line"> â†’ runc</span>
<span class="line"> â†’ Linux process</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="kubectl-run" tabindex="-1"><a class="header-anchor" href="#kubectl-run"><span>kubectl run</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubectl</span>
<span class="line"> â†’ kube-apiserver</span>
<span class="line"> â†’ kubelet</span>
<span class="line"> â†’ CRI (gRPC)</span>
<span class="line"> â†’ containerd</span>
<span class="line"> â†’ runc</span>
<span class="line"> â†’ Linux process</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ“Œ <strong>containerd æ˜¯å…±åŒç‚¹</strong> ğŸ“Œ <strong>åˆ†å‰å‘ç”Ÿåœ¨ containerd ä¹‹å‰</strong></p><hr><h3 id="ä¸ºä»€ä¹ˆè¿™ä¸ªåŒºåˆ«-éå¸¸é‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¿™ä¸ªåŒºåˆ«-éå¸¸é‡è¦"><span>ä¸ºä»€ä¹ˆè¿™ä¸ªåŒºåˆ«&quot;éå¸¸é‡è¦&quot;ï¼Ÿ</span></a></h3><p>å› ä¸º <strong>containerd çš„&quot;ä¸Šæ¸¸è°ƒç”¨è€…&quot;å†³å®šäº†è¡Œä¸ºæ¨¡å¼</strong>ã€‚</p><hr><h3 id="ä¸€ã€è°åœ¨-æŒ‡æŒ¥-containerd" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€è°åœ¨-æŒ‡æŒ¥-containerd"><span>ä¸€ã€è°åœ¨&quot;æŒ‡æŒ¥&quot; containerdï¼Ÿ</span></a></h3><h4 id="docker-run-1" tabindex="-1"><a class="header-anchor" href="#docker-run-1"><span>docker run</span></a></h4><ul><li><p>æŒ‡æŒ¥è€…ï¼š<strong>Docker Engine</strong></p></li><li><p>containerd æ˜¯ï¼š</p><ul><li>Docker çš„å†…éƒ¨ç»„ä»¶</li><li>åªæœåŠ¡ Docker</li></ul></li><li><p>containerd æ¥æ”¶çš„æ˜¯ <strong>Docker è‡ªå·±çš„ API è¯­ä¹‰</strong></p></li></ul><hr><h4 id="kubectl-run-1" tabindex="-1"><a class="header-anchor" href="#kubectl-run-1"><span>kubectl run</span></a></h4><ul><li><p>æŒ‡æŒ¥è€…ï¼š<strong>kubelet</strong></p></li><li><p>containerd æ˜¯ï¼š</p><ul><li>Kubernetes çš„ runtime</li><li>é€šè¿‡ <strong>CRI</strong> äº¤äº’</li></ul></li><li><p>containerd æ¥æ”¶çš„æ˜¯ <strong>Kubernetes çš„ Pod è¯­ä¹‰</strong></p></li></ul><hr><h3 id="äºŒã€containerd-æ¥æ”¶åˆ°çš„-æŒ‡ä»¤è¯­ä¹‰-ä¸åŒ" tabindex="-1"><a class="header-anchor" href="#äºŒã€containerd-æ¥æ”¶åˆ°çš„-æŒ‡ä»¤è¯­ä¹‰-ä¸åŒ"><span>äºŒã€containerd æ¥æ”¶åˆ°çš„&quot;æŒ‡ä»¤è¯­ä¹‰&quot;ä¸åŒ</span></a></h3><h4 id="docker-è¯­ä¹‰" tabindex="-1"><a class="header-anchor" href="#docker-è¯­ä¹‰"><span>Docker è¯­ä¹‰</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">RunContainer(</span>
<span class="line">  image=nginx,</span>
<span class="line">  ports=80,</span>
<span class="line">  network=bridge,</span>
<span class="line">  restart=always</span>
<span class="line">)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="kubernetes-è¯­ä¹‰-cri" tabindex="-1"><a class="header-anchor" href="#kubernetes-è¯­ä¹‰-cri"><span>Kubernetes è¯­ä¹‰(CRI)</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">RunPodSandbox()</span>
<span class="line">CreateContainer()</span>
<span class="line">StartContainer()</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ“Œ containerd åªæ˜¯&quot;ç¿»è¯‘æ‰§è¡Œè€…&quot;</p><hr><h3 id="ä¸‰ã€ä¸ºä»€ä¹ˆ-kubernetes-ä¸ç”¨-docker-engine" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€ä¸ºä»€ä¹ˆ-kubernetes-ä¸ç”¨-docker-engine"><span>ä¸‰ã€ä¸ºä»€ä¹ˆ Kubernetes ä¸ç”¨ Docker Engineï¼Ÿ</span></a></h3><p>å› ä¸º Docker Engineï¼š</p><ul><li>âŒ ä¸æ”¯æŒ CRI</li><li>âŒ API è¯­ä¹‰æ˜¯&quot;å®¹å™¨&quot;ï¼Œä¸æ˜¯&quot;Pod&quot;</li><li>âŒ å¤šäº†ä¸€å±‚çŠ¶æ€æœº</li></ul><p>æ‰€ä»¥ Kubernetes é€‰æ‹©ï¼š</p><blockquote><p><strong>ç›´æ¥å¯¹æ¥ containerd / CRI-O</strong></p></blockquote><hr><h3 id="å››ã€ä¸€ä¸ªéå¸¸ç²¾å‡†çš„å·¥ç¨‹åˆ¤æ–­æ ‡å‡†-é€ä½ " tabindex="-1"><a class="header-anchor" href="#å››ã€ä¸€ä¸ªéå¸¸ç²¾å‡†çš„å·¥ç¨‹åˆ¤æ–­æ ‡å‡†-é€ä½ "><span>å››ã€ä¸€ä¸ªéå¸¸ç²¾å‡†çš„å·¥ç¨‹åˆ¤æ–­æ ‡å‡†(é€ä½ )</span></a></h3><blockquote><p><strong>çœ‹ containerd çš„&quot;ä¸Šæ¸¸æ˜¯è°&quot;ï¼Œå°±çŸ¥é“è¿™æ˜¯ Docker è¿˜æ˜¯ Kubernetes çš„å®¹å™¨</strong></p></blockquote><hr><h3 id="äº”ã€ä½ è¿™å¥è¯å¯ä»¥å‡çº§æˆ-æ ‡å‡†è¡¨è¿°" tabindex="-1"><a class="header-anchor" href="#äº”ã€ä½ è¿™å¥è¯å¯ä»¥å‡çº§æˆ-æ ‡å‡†è¡¨è¿°"><span>äº”ã€ä½ è¿™å¥è¯å¯ä»¥å‡çº§æˆ&quot;æ ‡å‡†è¡¨è¿°&quot;</span></a></h3><p>ä½ ç°åœ¨è¯´çš„ï¼š</p><blockquote><p>æœ€ä¸»è¦çš„æ˜¯åˆ°è¾¾ containerd çš„æ–¹å¼ä¸åŒ</p></blockquote><p>å‡çº§åå¯ä»¥è¿™æ ·è¯´(æŠ€æœ¯äº¤æµå¾ˆåŠ åˆ†)ğŸ‘‡</p><blockquote><p><strong>docker run å’Œ kubectl run çš„æœ¬è´¨åŒºåˆ«åœ¨äºï¼š containerd çš„ä¸Šæ¸¸è°ƒç”¨è€…ä¸åŒâ€”â€” Docker Engine vs kubelet(é€šè¿‡ CRI)</strong></p></blockquote><hr><h3 id="å…­ã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å…­ã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“"><span>å…­ã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“</span></a></h3><blockquote><p><strong>containerd æ˜¯å…±åŒçš„æ‰§è¡Œæ ¸å¿ƒï¼Œ Docker å’Œ Kubernetes çš„å·®å¼‚å‘ç”Ÿåœ¨ containerd ä¹‹ä¸Šï¼Œè€Œä¸æ˜¯ä¹‹ä¸‹ã€‚</strong></p></blockquote><hr><h2 id="ğŸ“œç¬¬å››éƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#ğŸ“œç¬¬å››éƒ¨åˆ†"><span>ğŸ“œç¬¬å››éƒ¨åˆ†</span></a></h2><h2 id="ç”¨-containerd-çš„è§†è§’-å±•ç¤ºå®ƒå¦‚ä½•åŒæ—¶-æœåŠ¡-docker-å’Œ-k8s" tabindex="-1"><a class="header-anchor" href="#ç”¨-containerd-çš„è§†è§’-å±•ç¤ºå®ƒå¦‚ä½•åŒæ—¶-æœåŠ¡-docker-å’Œ-k8s"><span>ç”¨ containerd çš„è§†è§’ï¼Œå±•ç¤ºå®ƒå¦‚ä½•åŒæ—¶&quot;æœåŠ¡ Docker å’Œ K8s&quot;</span></a></h2><blockquote><p><strong>&quot;æˆ‘å« containerdï¼Œæˆ‘ä¸å…³å¿ƒä½ æ˜¯ Docker è¿˜æ˜¯ Kubernetesï¼Œ è°æŒ‰æˆ‘å¬å¾—æ‡‚çš„æ¥å£è·Ÿæˆ‘è¯´è¯ï¼Œæˆ‘å°±å¸®è°æŠŠå®¹å™¨è·‘èµ·æ¥ã€‚&quot;</strong></p></blockquote><hr><h3 id="ä¸€ã€containerd-æ˜¯ä¸€ä¸ªä»€ä¹ˆè§’è‰²" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€containerd-æ˜¯ä¸€ä¸ªä»€ä¹ˆè§’è‰²"><span>ä¸€ã€containerd æ˜¯ä¸€ä¸ªä»€ä¹ˆè§’è‰²ï¼Ÿ</span></a></h3><h4 id="æ ¸å¿ƒèº«ä»½" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒèº«ä»½"><span>æ ¸å¿ƒèº«ä»½</span></a></h4><blockquote><p><strong>containerd = é€šç”¨å®¹å™¨è¿è¡Œç®¡ç†å™¨</strong></p></blockquote><p>å®ƒçš„èŒè´£åªæœ‰ä¸‰ä»¶ï¼š</p><ol><li>ç®¡ç†é•œåƒ(OCI Image)</li><li>ç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸ</li><li>è°ƒç”¨ OCI Runtime(runc)</li></ol><hr><h3 id="äºŒã€containerd-å¦‚ä½•-åŒæ—¶æœåŠ¡-docker-å’Œ-k8s" tabindex="-1"><a class="header-anchor" href="#äºŒã€containerd-å¦‚ä½•-åŒæ—¶æœåŠ¡-docker-å’Œ-k8s"><span>äºŒã€containerd å¦‚ä½•&quot;åŒæ—¶æœåŠ¡ Docker å’Œ K8s&quot;ï¼Ÿ</span></a></h3><p>å…³é”®ç‚¹åªæœ‰ä¸€ä¸ªï¼š</p><blockquote><p><strong>containerd å¯¹å¤–æä¾›äº†&quot;å¤šç§å…¥å£(frontend)&quot;ï¼Œ å¯¹å†…åªæœ‰&quot;ä¸€å¥—æ‰§è¡Œé€»è¾‘&quot;ã€‚</strong></p></blockquote><hr><h3 id="ä¸‰ã€ä»-containerd-çš„-æ¥å£è§†è§’-çœ‹ä¸–ç•Œ" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€ä»-containerd-çš„-æ¥å£è§†è§’-çœ‹ä¸–ç•Œ"><span>ä¸‰ã€ä» containerd çš„&quot;æ¥å£è§†è§’&quot;çœ‹ä¸–ç•Œ</span></a></h3><h4 id="containerd-çš„å†…éƒ¨æ ¸å¿ƒæ˜¯ç»Ÿä¸€çš„" tabindex="-1"><a class="header-anchor" href="#containerd-çš„å†…éƒ¨æ ¸å¿ƒæ˜¯ç»Ÿä¸€çš„"><span>containerd çš„å†…éƒ¨æ ¸å¿ƒæ˜¯ç»Ÿä¸€çš„</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Image Store</span>
<span class="line">Snapshotter</span>
<span class="line">Task Manager</span>
<span class="line">Runtime (runc)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ç®¡è°æ¥ï¼Œæœ€åéƒ½ä¼šèµ°è¿™é‡Œ ğŸ‘†</p><hr><h3 id="å››ã€docker-æ˜¯æ€ä¹ˆ-æ¥å…¥æˆ‘-çš„" tabindex="-1"><a class="header-anchor" href="#å››ã€docker-æ˜¯æ€ä¹ˆ-æ¥å…¥æˆ‘-çš„"><span>å››ã€Docker æ˜¯æ€ä¹ˆ&quot;æ¥å…¥æˆ‘&quot;çš„ï¼Ÿ</span></a></h3><h4 id="docker-â†’-containerd" tabindex="-1"><a class="header-anchor" href="#docker-â†’-containerd"><span>Docker â†’ containerd</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Docker Engine</span>
<span class="line">   â†“</span>
<span class="line">containerd gRPC API</span>
<span class="line">   â†“</span>
<span class="line">containerd Core</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#ç‰¹ç‚¹"><span>ç‰¹ç‚¹</span></a></h4><ul><li><p>Docker Engineï¼š</p><ul><li>è´Ÿè´£ç½‘ç»œ / volume / CLI</li><li>æŠŠ&quot;Docker è¯­ä¹‰&quot;ç¿»è¯‘æˆ containerd èƒ½æ‡‚çš„è¯·æ±‚</li></ul></li><li><p>containerdï¼š</p><ul><li>åªè´Ÿè´£&quot;è·‘å®¹å™¨&quot;</li><li>ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ <code>docker run</code></li></ul></li></ul><p>ğŸ“Œ <strong>åœ¨ containerd çœ‹æ¥ï¼šDocker åªæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯</strong></p><hr><h3 id="äº”ã€kubernetes-æ˜¯æ€ä¹ˆ-æ¥å…¥æˆ‘-çš„" tabindex="-1"><a class="header-anchor" href="#äº”ã€kubernetes-æ˜¯æ€ä¹ˆ-æ¥å…¥æˆ‘-çš„"><span>äº”ã€Kubernetes æ˜¯æ€ä¹ˆ&quot;æ¥å…¥æˆ‘&quot;çš„ï¼Ÿ</span></a></h3><h4 id="kubernetes-â†’-containerd" tabindex="-1"><a class="header-anchor" href="#kubernetes-â†’-containerd"><span>Kubernetes â†’ containerd</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubelet</span>
<span class="line">   â†“</span>
<span class="line">CRI (gRPC)</span>
<span class="line">   â†“</span>
<span class="line">containerd CRI Plugin</span>
<span class="line">   â†“</span>
<span class="line">containerd Core</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç‰¹ç‚¹-1" tabindex="-1"><a class="header-anchor" href="#ç‰¹ç‚¹-1"><span>ç‰¹ç‚¹</span></a></h4><ul><li><p>kubeletï¼š</p><ul><li>è¯´çš„æ˜¯ Pod / Sandbox</li></ul></li><li><p>CRI Pluginï¼š</p><ul><li>æŠŠ Pod è¯­ä¹‰ç¿»è¯‘æˆ containerd æ“ä½œ</li></ul></li><li><p>containerdï¼š</p><ul><li>å®Œå…¨ä¸å…³å¿ƒè¿™æ˜¯ Pod è¿˜æ˜¯ Container</li></ul></li></ul><p>ğŸ“Œ <strong>CRI Plugin = Kubernetes çš„&quot;ç¿»è¯‘å®˜&quot;</strong></p><hr><h3 id="å…­ã€containerd-å†…éƒ¨å¦‚ä½•-ç»Ÿä¸€æ‰§è¡Œ" tabindex="-1"><a class="header-anchor" href="#å…­ã€containerd-å†…éƒ¨å¦‚ä½•-ç»Ÿä¸€æ‰§è¡Œ"><span>å…­ã€containerd å†…éƒ¨å¦‚ä½•&quot;ç»Ÿä¸€æ‰§è¡Œ&quot;ï¼Ÿ</span></a></h3><p>ä¸ç®¡æ¥æºæ˜¯è°ï¼Œcontainerd æœ€ç»ˆéƒ½åšè¿™å‡ æ­¥ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">1. æ‹‰ OCI é•œåƒ</span>
<span class="line">2. å‡†å¤‡ rootfs(snapshot)</span>
<span class="line">3. ç”Ÿæˆ OCI config.json</span>
<span class="line">4. è°ƒç”¨ runc</span>
<span class="line">5. ç®¡ç†è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ‘‰ <strong>æ ¸å¿ƒæ‰§è¡Œè·¯å¾„å®Œå…¨ä¸€è‡´</strong></p><hr><h3 id="ä¸ƒã€ç”¨ä¸€å¼ -containerd-å†…éƒ¨è§†è§’å›¾" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€ç”¨ä¸€å¼ -containerd-å†…éƒ¨è§†è§’å›¾"><span>ä¸ƒã€ç”¨ä¸€å¼ &quot;containerd å†…éƒ¨è§†è§’å›¾&quot;</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="line">              â”‚ Docker      â”‚</span>
<span class="line">              â”‚ Engine      â”‚</span>
<span class="line">              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="line">                     â”‚</span>
<span class="line">              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”</span>
<span class="line">              â”‚ containerd  â”‚â—„â”€â”€â”€â”€ kubelet</span>
<span class="line">              â”‚ gRPC API    â”‚       (via CRI)</span>
<span class="line">              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="line">                     â”‚</span>
<span class="line">        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="line">        â”‚     containerd Core     â”‚</span>
<span class="line">        â”‚  - Image Store          â”‚</span>
<span class="line">        â”‚  - Snapshotter          â”‚</span>
<span class="line">        â”‚  - Task Manager         â”‚</span>
<span class="line">        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="line">                     â”‚</span>
<span class="line">               â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”</span>
<span class="line">               â”‚   runc    â”‚</span>
<span class="line">               â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span>
<span class="line">                     â”‚</span>
<span class="line">                Linux Kernel</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="å…«ã€ä¸ºä»€ä¹ˆ-docker-ps-å’Œ-kubectl-get-pods-äº’ç›¸çœ‹ä¸åˆ°" tabindex="-1"><a class="header-anchor" href="#å…«ã€ä¸ºä»€ä¹ˆ-docker-ps-å’Œ-kubectl-get-pods-äº’ç›¸çœ‹ä¸åˆ°"><span>å…«ã€ä¸ºä»€ä¹ˆ <code>docker ps</code> å’Œ <code>kubectl get pods</code> äº’ç›¸çœ‹ä¸åˆ°ï¼Ÿ</span></a></h3><p>ä» containerd çš„è§’åº¦ï¼š</p><blockquote><p><strong>&quot;ä½ ä»¬æ˜¯ä¸åŒçš„å®¢æˆ·ç«¯ï¼Œæˆ‘ç»™ä½ ä»¬åˆ†äº†ä¸åŒçš„ namespaceã€‚&quot;</strong></p></blockquote><h4 id="containerd-namespaces" tabindex="-1"><a class="header-anchor" href="#containerd-namespaces"><span>containerd namespaces</span></a></h4><ul><li>Docker ç”¨ï¼š<code>moby</code></li><li>Kubernetes ç”¨ï¼š<code>k8s.io</code></li></ul><p>æ‰€ä»¥ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">ctr <span class="token parameter variable">-n</span> moby containers list     <span class="token comment"># Docker</span></span>
<span class="line">ctr <span class="token parameter variable">-n</span> k8s.io containers list   <span class="token comment"># Kubernetes</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ“Œ <strong>ä¸æ˜¯çœ‹ä¸åˆ°ï¼Œæ˜¯ä½ æ²¡è¿›å¯¹ namespace</strong></p><hr><h3 id="ä¹ã€containerd-çœ¼ä¸­çš„-cri-å’Œ-docker" tabindex="-1"><a class="header-anchor" href="#ä¹ã€containerd-çœ¼ä¸­çš„-cri-å’Œ-docker"><span>ä¹ã€containerd çœ¼ä¸­çš„ CRI å’Œ Docker</span></a></h3><table><thead><tr><th>ä¸Šæ¸¸</th><th>containerd çœ‹åˆ°çš„</th></tr></thead><tbody><tr><td>Docker Engine</td><td>æ™®é€š client</td></tr><tr><td>kubelet</td><td>é€šè¿‡ CRI plugin çš„ client</td></tr><tr><td>runc</td><td>ä¸‹æ¸¸ runtime</td></tr></tbody></table><p>containerd <strong>æ²¡æœ‰&quot;åçˆ±&quot;</strong></p><hr><h3 id="åã€ç»ˆæä¸€å¥è¯æ€»ç»“-containerd-è§†è§’" tabindex="-1"><a class="header-anchor" href="#åã€ç»ˆæä¸€å¥è¯æ€»ç»“-containerd-è§†è§’"><span>åã€ç»ˆæä¸€å¥è¯æ€»ç»“(containerd è§†è§’)</span></a></h3><blockquote><p><strong>æˆ‘(containerd)æ˜¯ä¸­ç«‹çš„æ‰§è¡Œå¼•æ“ï¼š Docker å’Œ Kubernetes åªæ˜¯ç”¨ä¸åŒè¯­è¨€è·Ÿæˆ‘è¯´è¯ï¼Œ ä½†æˆ‘å¹²çš„æ´»å§‹ç»ˆæ˜¯åŒä¸€å¥—ã€‚</strong></p></blockquote><hr><h2 id="ğŸ“œç¬¬äº”éƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#ğŸ“œç¬¬äº”éƒ¨åˆ†"><span>ğŸ“œç¬¬äº”éƒ¨åˆ†</span></a></h2><h2 id="ç”¨-ctr-å®é™…ç›´æ¥è·‘ä¸€ä¸ª-nginx-ç»•è¿‡-docker-k8s-æ¥çœ‹-containerd-çœŸæ­£çš„è¿è¡Œè·¯å¾„-è²Œä¼¼ctrå¾ˆå°‘ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ç”¨-ctr-å®é™…ç›´æ¥è·‘ä¸€ä¸ª-nginx-ç»•è¿‡-docker-k8s-æ¥çœ‹-containerd-çœŸæ­£çš„è¿è¡Œè·¯å¾„-è²Œä¼¼ctrå¾ˆå°‘ä½¿ç”¨"><span>ç”¨ ctr å®é™…ç›´æ¥è·‘ä¸€ä¸ª nginx(ç»•è¿‡ Docker / K8s)æ¥çœ‹ containerd çœŸæ­£çš„è¿è¡Œè·¯å¾„ (è²Œä¼¼ctrå¾ˆå°‘ä½¿ç”¨)</span></a></h2><p><code>ctr</code> æ˜¯ <strong>containerd çš„åº•å±‚è°ƒè¯•å·¥å…·</strong>ï¼Œå®ƒå‡ ä¹ä¸ç”¨åœ¨ç”Ÿäº§æˆ–è€…æ—¥å¸¸å¼€å‘ä¸­ï¼Œå› ä¸ºå¤§éƒ¨åˆ†äººéƒ½ç”¨ Docker æˆ– Kubernetes æ¥é—´æ¥è°ƒç”¨ containerdã€‚ ä½†æ˜¯ç”¨ <code>ctr</code> ç›´æ¥è·‘ä¸€ä¸ª nginxï¼Œå¯ä»¥è®©ä½ <strong>çœ‹åˆ° containerd çœŸæ­£çš„è¿è¡Œè·¯å¾„</strong>ï¼Œå®Œå…¨ç»•è¿‡ Docker / K8sï¼Œç†è§£æ¸…æ¥š&quot;ä¸Šæ¸¸ä¸åŒä½†ä¸‹æ¸¸ä¸€è‡´&quot;çš„æœ¬è´¨ã€‚</p><h2 id="ä¸€ã€å‰ææ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰ææ¡ä»¶"><span>ä¸€ã€å‰ææ¡ä»¶</span></a></h2><ol><li>ä½ çš„ç³»ç»Ÿé‡Œå·²ç»å®‰è£… <strong>containerd</strong> å¹¶åœ¨è¿è¡Œã€‚</li><li>root æƒé™æˆ–ç”¨ <code>sudo</code>ã€‚</li><li>ä½ çŸ¥é“ containerd çš„å‘½åç©ºé—´ï¼Œé»˜è®¤ï¼š</li></ol><ul><li>Docker ç”¨ <code>moby</code></li><li>Kubernetes ç”¨ <code>k8s.io</code></li><li>ä½ å¯ä»¥ç”¨ <code>default</code> æˆ–è‡ªå®šä¹‰</li></ul><hr><h2 id="äºŒã€æŸ¥çœ‹-containerd-é•œåƒ" tabindex="-1"><a class="header-anchor" href="#äºŒã€æŸ¥çœ‹-containerd-é•œåƒ"><span>äºŒã€æŸ¥çœ‹ containerd é•œåƒ</span></a></h2><p>å…ˆçœ‹çœ‹ containerd å·²ç»æœ‰çš„é•œåƒï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> ctr images list</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœæ²¡æœ‰ nginx é•œåƒï¼Œå¯ä»¥ pullï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> ctr images pull docker.io/library/nginx:latest</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>containerd ç›´æ¥æ”¯æŒ Docker Hub é•œåƒï¼Œå› ä¸ºå®ƒéµå¾ª <strong>OCI Image Spec</strong>ã€‚</p></blockquote><hr><h2 id="ä¸‰ã€ç”¨-ctr-è¿è¡Œ-nginx" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€ç”¨-ctr-è¿è¡Œ-nginx"><span>ä¸‰ã€ç”¨ ctr è¿è¡Œ nginx</span></a></h2><h4 id="_1ï¸âƒ£-åˆ›å»ºå®¹å™¨-containerd-é‡Œå«-task" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-åˆ›å»ºå®¹å™¨-containerd-é‡Œå«-task"><span>1ï¸âƒ£ åˆ›å»ºå®¹å™¨(containerd é‡Œå« task)</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> ctr run <span class="token parameter variable">-d</span> <span class="token parameter variable">--rm</span> docker.io/library/nginx:latest nginx-test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è§£é‡Šï¼š</p><ul><li><code>-d</code> â†’ åå°è¿è¡Œ</li><li><code>--rm</code> â†’ å®¹å™¨é€€å‡ºåè‡ªåŠ¨åˆ é™¤</li><li><code>docker.io/library/nginx:latest</code> â†’ é•œåƒ</li><li><code>nginx-test</code> â†’ å®¹å™¨åå­—</li></ul><hr><h4 id="_2ï¸âƒ£-æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨"><span>2ï¸âƒ£ æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> ctr tasks list</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">nginx-test    RUNNING    &lt;pid&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h4 id="_3ï¸âƒ£-æŸ¥çœ‹æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£-æŸ¥çœ‹æ—¥å¿—"><span>3ï¸âƒ£ æŸ¥çœ‹æ—¥å¿—</span></a></h4><p>containerd æœ¬èº«ä¸æä¾›æ—¥å¿—å‘½ä»¤ï¼Œä½†ä½ å¯ä»¥ attachï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> ctr tasks attach nginx-test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ–æŸ¥çœ‹ runc è¿›ç¨‹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h4 id="_4ï¸âƒ£-åœæ­¢å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#_4ï¸âƒ£-åœæ­¢å®¹å™¨"><span>4ï¸âƒ£ åœæ­¢å®¹å™¨</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> ctr tasks <span class="token function">kill</span> nginx-test</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="å››ã€å’Œ-docker-run-kubectl-run-å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#å››ã€å’Œ-docker-run-kubectl-run-å¯¹æ¯”"><span>å››ã€å’Œ docker run / kubectl run å¯¹æ¯”</span></a></h2><table><thead><tr><th></th><th>docker run nginx</th><th>kubectl run nginx</th><th>ctr run nginx</th></tr></thead><tbody><tr><td>é•œåƒæ¥æº</td><td>Docker pull</td><td>K8s è°ƒ containerd pull</td><td>containerd pull</td></tr><tr><td>ä¸Šæ¸¸æŒ‡ä»¤</td><td>Docker CLI â†’ dockerd</td><td>kubelet â†’ CRI â†’ containerd</td><td>ctr CLI</td></tr><tr><td>containerd</td><td>é—´æ¥</td><td>é—´æ¥</td><td>ç›´æ¥</td></tr><tr><td>OCI Runtime</td><td>runc</td><td>runc</td><td>runc</td></tr><tr><td>Linux è¿›ç¨‹</td><td>nginx</td><td>nginx</td><td>nginx</td></tr><tr><td>æŸ¥çœ‹å‘½ä»¤</td><td>docker ps / logs</td><td>kubectl get pods / logs</td><td>ctr tasks list / attach</td></tr></tbody></table><p>âœ… æ ¸å¿ƒåŒºåˆ«å°±æ˜¯**&quot;containerd çš„ä¸Šæ¸¸æ˜¯è°&quot;**ã€‚</p><hr><h2 id="äº”ã€ä¸ºä»€ä¹ˆå¹³æ—¶å¾ˆå°‘ç›´æ¥ç”¨-ctr" tabindex="-1"><a class="header-anchor" href="#äº”ã€ä¸ºä»€ä¹ˆå¹³æ—¶å¾ˆå°‘ç›´æ¥ç”¨-ctr"><span>äº”ã€ä¸ºä»€ä¹ˆå¹³æ—¶å¾ˆå°‘ç›´æ¥ç”¨ ctrï¼Ÿ</span></a></h2><ol><li><strong>å‘½ä»¤å¤æ‚ã€ä¸å‹å¥½</strong></li></ol><ul><li>æ¯ä¸ªæ“ä½œéƒ½è¦æ˜¾å¼æŒ‡å®š namespaceã€task å</li></ul><ol start="2"><li><strong>åŠŸèƒ½å¤ªåº•å±‚</strong></li></ol><ul><li>Docker / K8s éƒ½åœ¨ ctr ä¹‹ä¸Šå°è£…äº†æ˜“ç”¨ API</li></ul><ol start="3"><li><strong>ç”Ÿäº§ç¯å¢ƒä¸æ¨è</strong></li></ol><ul><li>ç›´æ¥æ“ä½œå®¹æ˜“ç ´åå®¹å™¨çŠ¶æ€ï¼Œå°¤å…¶æ˜¯ K8s é‡Œé¢</li></ul><blockquote><p>ctr æ›´å¤šæ˜¯<strong>è°ƒè¯•å·¥å…· / å­¦ä¹ å·¥å…·</strong>ï¼Œå®é™…è¿è¡Œå®¹å™¨è¿˜æ˜¯ç”¨ Docker / K8sã€‚</p></blockquote><hr><h2 id="å…­ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ€»ç»“"><span>å…­ã€æ€»ç»“</span></a></h2><ol><li><strong>ctr å¯ä»¥ç›´æ¥è¿è¡Œå®¹å™¨ï¼Œç»•è¿‡ Docker / K8s</strong></li><li><strong>containerd å¯¹ä»»ä½•ä¸Šæ¸¸éƒ½æ˜¯ä¸­ç«‹çš„</strong></li><li><strong>Docker / K8s åªæ˜¯ä¸åŒçš„ä¸Šæ¸¸å®¢æˆ·ç«¯</strong></li><li><strong>åº•å±‚æ‰§è¡Œ(runc + Linux kernel)å®Œå…¨ä¸€è‡´</strong></li></ol><hr><h2 id="ğŸ“œç¬¬å…­éƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#ğŸ“œç¬¬å…­éƒ¨åˆ†"><span>ğŸ“œç¬¬å…­éƒ¨åˆ†</span></a></h2><h2 id="containerdéœ€è¦å•ç‹¬å®‰è£…å—" tabindex="-1"><a class="header-anchor" href="#containerdéœ€è¦å•ç‹¬å®‰è£…å—"><span>containerdéœ€è¦å•ç‹¬å®‰è£…å—</span></a></h2><h2 id="ä¸€ã€containerd-å®‰è£…æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€containerd-å®‰è£…æƒ…å†µ"><span>ä¸€ã€containerd å®‰è£…æƒ…å†µ</span></a></h2><ol><li><strong>Docker è‡ªå¸¦ containerd</strong></li></ol><ul><li>Docker Engine å†…éƒ¨æœ¬èº«å°±å¸¦äº† containerd(daemon)</li><li>å®‰è£… Docker = è‡ªåŠ¨å®‰è£… containerd</li><li>ç‰ˆæœ¬å¯èƒ½ä¼šéš Docker å‡çº§è€Œå‡çº§</li></ul><p>âœ… è¿™ç§æƒ…å†µä¸‹ï¼Œæ™®é€šä½¿ç”¨ Docker çš„ç”¨æˆ·<strong>ä¸éœ€è¦å•ç‹¬å®‰è£… containerd</strong></p><ol start="2"><li><strong>Kubernetes / CRI-O éœ€è¦ containerd</strong></li></ol><ul><li>å¦‚æœä½ ä¸æ‰“ç®—ç”¨ Dockerï¼Œè€Œæ˜¯ç›´æ¥ç”¨ containerd æˆ– CRI-O ä½œä¸º Kubernetes runtime</li><li>å°±éœ€è¦<strong>å•ç‹¬å®‰è£… containerd</strong></li></ul><p>ä¸¾ä¾‹ï¼šK8s å®˜æ–¹æ¨èä» v1.24 å¼€å§‹ç›´æ¥ç”¨ containerdï¼Œè€Œä¸æ˜¯ Docker Engine</p><ul><li>åœ¨ Ubuntu ä¸Šï¼Œå¯ä»¥é€šè¿‡ <code>apt install containerd</code> æˆ–å®˜æ–¹äºŒè¿›åˆ¶å®‰è£…</li><li>å®‰è£…åè¦é…ç½® <code>containerd.service</code> å¹¶å¯åŠ¨</li></ul><hr><h2 id="äºŒã€å®‰è£…-vs-ä½¿ç”¨çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#äºŒã€å®‰è£…-vs-ä½¿ç”¨çš„åŒºåˆ«"><span>äºŒã€å®‰è£… vs ä½¿ç”¨çš„åŒºåˆ«</span></a></h2><table><thead><tr><th>åœºæ™¯</th><th>æ˜¯å¦éœ€è¦å•ç‹¬å®‰è£… containerd</th></tr></thead><tbody><tr><td>åªç”¨ Docker run / build / push</td><td>âŒ ä¸éœ€è¦</td></tr><tr><td>Kubernetes ç›´æ¥ç”¨ containerd æˆ– CRI-O</td><td>âœ… éœ€è¦</td></tr><tr><td>å­¦ä¹  / è°ƒè¯• ctr å‘½ä»¤</td><td>âœ… éœ€è¦(æˆ–è€…ä½¿ç”¨ Docker å†…éƒ¨çš„ containerdï¼Œä½†è¦æ‰¾è·¯å¾„)</td></tr></tbody></table><hr><h2 id="ä¸‰ã€å®é™…æ“ä½œå»ºè®®" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€å®é™…æ“ä½œå»ºè®®"><span>ä¸‰ã€å®é™…æ“ä½œå»ºè®®</span></a></h2><ol><li><strong>æœ¬åœ°å¼€å‘ / å­¦ä¹  Docker</strong></li></ol><ul><li>å®‰è£… Docker å°±å¤Ÿäº†</li><li>containerd è‡ªåŠ¨éš Docker å¯åŠ¨</li></ul><ol start="2"><li><strong>K8s èŠ‚ç‚¹ / CRI-O / containerd runtime</strong></li></ol><ul><li>å•ç‹¬å®‰è£… containerd</li><li>é…ç½® systemd å¯åŠ¨</li><li>é…ç½®å‘½åç©ºé—´(æ¯”å¦‚ <code>k8s.io</code>)</li></ul><ol start="3"><li><strong>è°ƒè¯• / ctr å®éªŒ</strong></li></ol><ul><li>å¯ä»¥ç›´æ¥ç”¨ Docker å†…ç½®çš„ containerd</li><li>ä½†å¦‚æœè¦å’Œ K8s åˆ†å¼€æµ‹è¯•ï¼Œå»ºè®®å•ç‹¬å®‰è£…</li></ul><hr><h2 id="å››ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å››ã€æ€»ç»“"><span>å››ã€æ€»ç»“</span></a></h2><blockquote><p><strong>containerd æœ¬èº«å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œä½† Docker è‡ªå¸¦äº†å®ƒï¼Œæ‰€ä»¥æ™®é€š Docker ç”¨æˆ·æ— éœ€å•ç‹¬å®‰è£…ã€‚ åªæœ‰åœ¨ Kubernetes æˆ–è€…æƒ³ç›´æ¥ç”¨ ctr æ—¶ï¼Œæ‰éœ€è¦å•ç‹¬å®‰è£… containerdã€‚</strong></p></blockquote><hr><h2 id="ğŸ“œç¬¬ä¸ƒéƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#ğŸ“œç¬¬ä¸ƒéƒ¨åˆ†"><span>ğŸ“œç¬¬ä¸ƒéƒ¨åˆ†</span></a></h2><h2 id="k8s-å®˜æ–¹æ¨èä»-v1-24-å¼€å§‹ç›´æ¥ç”¨-containerd-è€Œä¸æ˜¯-docker-engine-å¦‚æœä½¿ç”¨containerd-éœ€è¦æ€ä¹ˆé…ç½®-å¦‚æœç»§ç»­ä½¿ç”¨docker-engine-æ€ä¹ˆé…ç½®" tabindex="-1"><a class="header-anchor" href="#k8s-å®˜æ–¹æ¨èä»-v1-24-å¼€å§‹ç›´æ¥ç”¨-containerd-è€Œä¸æ˜¯-docker-engine-å¦‚æœä½¿ç”¨containerd-éœ€è¦æ€ä¹ˆé…ç½®-å¦‚æœç»§ç»­ä½¿ç”¨docker-engine-æ€ä¹ˆé…ç½®"><span>K8s å®˜æ–¹æ¨èä» v1.24 å¼€å§‹ç›´æ¥ç”¨ containerdï¼Œè€Œä¸æ˜¯ Docker Engineï¼Œ å¦‚æœä½¿ç”¨containerd éœ€è¦æ€ä¹ˆé…ç½®ï¼Œå¦‚æœç»§ç»­ä½¿ç”¨Docker Engine æ€ä¹ˆé…ç½®</span></a></h2><h2 id="ä¸€ã€k8s-å®˜æ–¹æ¨èèƒŒæ™¯" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€k8s-å®˜æ–¹æ¨èèƒŒæ™¯"><span>ä¸€ã€K8s å®˜æ–¹æ¨èèƒŒæ™¯</span></a></h2><ol><li>Kubernetes v1.24+ å¼€å§‹ <strong>åºŸå¼ƒå¯¹ Docker Engine ç›´æ¥ä½œä¸º runtime çš„æ”¯æŒ</strong>(å«åš dockershim)</li><li>åŸå› ï¼šDocker Engine åŒ…å«å¤ªå¤šå’Œ K8s æ— å…³çš„åŠŸèƒ½(æ„å»ºã€CLIã€Docker Swarm ç­‰)ï¼Œç»´æŠ¤å¤æ‚</li><li>ç›®æ ‡ï¼š<strong>åªä¿ç•™ CRI æ¥å£</strong></li></ol><ul><li>containerdã€CRI-O åŸç”Ÿå®ç° CRI</li><li>Docker Engine å¿…é¡»é€šè¿‡ dockershim æ‰èƒ½æ”¯æŒ(å·²åºŸå¼ƒ)</li></ul><p>âœ… æ‰€ä»¥å®˜æ–¹æ¨èç›´æ¥ä½¿ç”¨ containerd æˆ– CRI-Oã€‚</p><hr><h2 id="äºŒã€containerd-ä½œä¸º-kubernetes-runtime-çš„é…ç½®" tabindex="-1"><a class="header-anchor" href="#äºŒã€containerd-ä½œä¸º-kubernetes-runtime-çš„é…ç½®"><span>äºŒã€containerd ä½œä¸º Kubernetes runtime çš„é…ç½®</span></a></h2><h3 id="_1ï¸âƒ£-å®‰è£…-containerd" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-å®‰è£…-containerd"><span>1ï¸âƒ£ å®‰è£… containerd</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># Ubuntu ç¤ºä¾‹</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> update</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> containerd</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…ä»å®˜æ–¹ release ä¸‹è½½äºŒè¿›åˆ¶ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">wget</span> https://github.com/containerd/containerd/releases/download/v1.8.8/containerd-1.8.8-linux-amd64.tar.gz</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">tar</span> Cxvf /usr/local containerd-1.8.8-linux-amd64.tar.gz</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_2ï¸âƒ£-é…ç½®-containerd" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-é…ç½®-containerd"><span>2ï¸âƒ£ é…ç½® containerd</span></a></h3><p>ç”Ÿæˆé»˜è®¤é…ç½®æ–‡ä»¶ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/containerd</span>
<span class="line"><span class="token function">sudo</span> containerd config default <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/containerd/config.toml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³é”®ç‚¹ï¼š</p><ul><li><strong>ç¡®ä¿ä½¿ç”¨ systemd cgroup driver</strong>(ä¸ kubelet åŒ¹é…)ï¼š</li></ul><div class="language-toml line-numbers-mode" data-highlighter="prismjs" data-ext="toml" data-title="toml"><pre><code><span class="line"><span class="token punctuation">[</span><span class="token table class-name">plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token key property">SystemdCgroup</span> <span class="token punctuation">=</span> <span class="token boolean">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>å‘½åç©ºé—´</strong>(K8s é»˜è®¤ <code>k8s.io</code>)ï¼š</li></ul><p>containerd é»˜è®¤æ”¯æŒå¤šå‘½åç©ºé—´ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼ŒK8s kubelet ä¼šæŒ‡å®š <code>k8s.io</code>ã€‚</p><hr><h3 id="_3ï¸âƒ£-å¯åŠ¨-containerd" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£-å¯åŠ¨-containerd"><span>3ï¸âƒ£ å¯åŠ¨ containerd</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> containerd</span>
<span class="line"><span class="token function">sudo</span> systemctl status containerd</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_4ï¸âƒ£-é…ç½®-kubelet-ä½¿ç”¨-containerd" tabindex="-1"><a class="header-anchor" href="#_4ï¸âƒ£-é…ç½®-kubelet-ä½¿ç”¨-containerd"><span>4ï¸âƒ£ é…ç½® kubelet ä½¿ç”¨ containerd</span></a></h3><ul><li>kubelet é…ç½®æ–‡ä»¶ï¼ˆ<code>/var/lib/kubelet/kubeadm-flags.env</code> æˆ– systemd drop-inï¼‰ï¼š</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token assign-left variable">KUBELET_EXTRA_ARGS</span><span class="token operator">=</span>--container-runtime<span class="token operator">=</span>remote --container-runtime-endpoint<span class="token operator">=</span>unix:///run/containerd/containerd.sock --runtime-request-timeout<span class="token operator">=</span>15m</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>kubeadm åˆå§‹åŒ–æˆ–åŠ å…¥é›†ç¾¤ï¼š</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> kubeadm init --cri-socket /run/containerd/containerd.sock</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>âœ… è¿™æ · kubelet å°±ç›´æ¥é€šè¿‡ CRI ä¸ containerd é€šä¿¡ã€‚</p><hr><h2 id="ä¸‰ã€docker-engine-ä½œä¸º-kubernetes-runtime" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€docker-engine-ä½œä¸º-kubernetes-runtime"><span>ä¸‰ã€Docker Engine ä½œä¸º Kubernetes runtime</span></a></h2><blockquote><p>ä»ç„¶å¯ä»¥ç”¨ï¼Œä½†æœ‰å‡ ä¸ªé™åˆ¶</p></blockquote><ol><li>Kubernetes v1.24+ <strong>dockershim å·²åºŸå¼ƒ</strong></li></ol><ul><li>kubelet ä¸å†ç›´æ¥æ”¯æŒ Docker Engine</li><li>å®˜æ–¹ä¸å†ç»´æŠ¤</li></ul><ol start="2"><li>å¦‚æœä½ æƒ³ç”¨ Docker Engineï¼Œéœ€è¦å®‰è£… <strong>cri-dockerd</strong>ï¼ˆç¬¬ä¸‰æ–¹ shimï¼‰ï¼š</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># Ubuntu ç¤ºä¾‹</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> golang-go <span class="token function">git</span></span>
<span class="line"><span class="token function">git</span> clone https://github.com/Mirantis/cri-dockerd.git</span>
<span class="line"><span class="token builtin class-name">cd</span> cri-dockerd</span>
<span class="line"><span class="token function">make</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span></span>
<span class="line"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> cri-docker.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>kubelet æŒ‡å‘ cri-dockerd socketï¼š</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">--container-runtime<span class="token operator">=</span>remote <span class="token punctuation">\\</span></span>
<span class="line">--container-runtime-endpoint<span class="token operator">=</span>unix:///var/run/cri-dockerd.sock</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>âš ï¸ è¿™æ˜¯<strong>è¿‡æ¸¡æ–¹æ¡ˆ</strong>ï¼Œä¸æ¨èç”Ÿäº§ä½¿ç”¨</li></ol><hr><h2 id="å››ã€å¯¹æ¯”è¡¨æ ¼" tabindex="-1"><a class="header-anchor" href="#å››ã€å¯¹æ¯”è¡¨æ ¼"><span>å››ã€å¯¹æ¯”è¡¨æ ¼</span></a></h2><table><thead><tr><th>ç‰¹æ€§</th><th>containerd</th><th>Docker Engine (via cri-dockerd)</th></tr></thead><tbody><tr><td>å®˜æ–¹æ¨è</td><td>âœ…</td><td>âŒï¼ˆåºŸå¼ƒ dockershimï¼‰</td></tr><tr><td>å®‰è£…å¤æ‚åº¦</td><td>ä½</td><td>ä¸­ï¼ˆéœ€è¦ cri-dockerdï¼‰</td></tr><tr><td>CRI æ”¯æŒ</td><td>åŸç”Ÿ</td><td>shim å®ç°</td></tr><tr><td>åŠŸèƒ½</td><td>åªè·‘å®¹å™¨</td><td>åŒ…å«æ„å»ºã€CLIã€Swarmï¼ˆK8s ä¸éœ€è¦ï¼‰</td></tr><tr><td>å‡çº§ç»´æŠ¤</td><td>å®˜æ–¹æ”¯æŒ</td><td>ç¬¬ä¸‰æ–¹ç»´æŠ¤</td></tr><tr><td>kubeadm åˆå§‹åŒ–</td><td>--cri-socket=/run/containerd/containerd.sock</td><td>--cri-socket=/var/run/cri-dockerd.sock</td></tr></tbody></table><p>ç»“è®º:</p><ul><li>Kubernetes ä½¿ç”¨ Docker Engine = é—´æ¥è°ƒç”¨ containerdï¼ˆé€šè¿‡ Docker Engine â†’ containerd â†’ OCI Runtime â†’ Linuxï¼‰</li><li>Kubernetes ç›´æ¥ä½¿ç”¨ containerd = ç›´æ¥è°ƒç”¨ containerd â†’ OCI Runtime â†’ Linux</li></ul><p>è·¯å¾„:</p><ul><li>ä½¿ç”¨ Docker Engineï¼š<br> kubelet â†’ (dockershim / cri-dockerd) â†’ Docker Engine â†’ containerd â†’ runc â†’ Linux</li><li>ä½¿ç”¨ containerdï¼š<br> kubelet â†’ containerd â†’ runc â†’ Linux</li></ul><p>æ ¸å¿ƒå·®å¼‚:</p><ul><li>Docker Engine å¤šäº†ä¸€å±‚ â†’ â€œç»•äº†ä¸€åœˆâ€</li><li>ç›´æ¥ä½¿ç”¨ containerd â†’ æ›´è½»é‡ã€å®˜æ–¹æ¨èã€å°‘ shim å±‚</li><li>ä¸‹æ¸¸æ‰§è¡Œå®Œå…¨ä¸€è‡´ï¼ˆrunc + Linux å†…æ ¸ï¼‰</li></ul><hr><h2 id="äº”ã€cri-o-ä½œä¸º-kubernetes-runtime-è¡¥å……ä¸€ä¸ª" tabindex="-1"><a class="header-anchor" href="#äº”ã€cri-o-ä½œä¸º-kubernetes-runtime-è¡¥å……ä¸€ä¸ª"><span>äº”ã€CRI-O ä½œä¸º Kubernetes runtime (è¡¥å……ä¸€ä¸ª)</span></a></h2><blockquote><p>1.Kubernetes ä½¿ç”¨ CRI-O = ç›´æ¥é€šè¿‡ CRI è°ƒç”¨ CRI-O â†’ OCI Runtime â†’ Linux å’Œç›´æ¥ä½¿ç”¨ containerd ç±»ä¼¼ï¼Œåªæ˜¯åº•å±‚ runtime æ˜¯ CRI-O è€Œä¸æ˜¯ containerd</p><p>2.åªè·‘ Pod å®¹å™¨</p><p>3.CRI-O æ˜¯ä¸“é—¨ä¸º K8s è®¾è®¡çš„å®¹å™¨è¿è¡Œæ—¶(æ›´è½»é‡), OCI Runtimeï¼ˆrunc/crunï¼‰ä¸ containerd ä¸€æ ·ï¼ŒçœŸæ­£åˆ›å»º Linux è¿›ç¨‹</p></blockquote><hr><h2 id="å…­ã€æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ€»ç»“-1"><span>å…­ã€æ€»ç»“</span></a></h2><ol><li><strong>å®˜æ–¹æ¨è containerd æˆ– CRI-O</strong></li></ol><ul><li>åŸç”Ÿ CRI</li><li>ç¨³å®šè½»é‡</li><li>å’Œ K8s æœ€æ–°ç‰ˆæœ¬å…¼å®¹</li></ul><ol start="2"><li><strong>Docker Engine ä»ç„¶å¯ä»¥ç”¨</strong></li></ol><ul><li>ä½†éœ€è¦ cri-dockerd shim</li><li>ä¸æ¨èç”Ÿäº§ç¯å¢ƒ</li><li>åªæ˜¯â€œè¿‡æ¸¡æ–¹æ¡ˆâ€</li></ul><ol start="3"><li><strong>æœ¬è´¨åŒºåˆ«</strong></li></ol><ul><li>containerdï¼šK8s åŸç”Ÿ runtime</li><li>Docker Engineï¼šé¢å¤–ä¸€å±‚ shim æ‰èƒ½æœåŠ¡ K8s</li></ul>`,418)]))}const c=e(l,[["render",t],["__file","å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ.html.vue"]]),o=JSON.parse('{"path":"/content/service/docker/%E5%85%B3%E4%BA%8E%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6%E7%9A%84%E6%A6%82%E5%BF%B5.html","title":"å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ","lang":"en-US","frontmatter":{"sidebar":false,"title":"å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ","head":[["meta",{"name":"title","content":"å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ"}],["meta",{"name":"description","content":"å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ"}],["meta",{"name":"keywords","content":"docker,k8s"}],["meta",{"property":"og:title","content":"å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ"}],["meta",{"property":"og:description","content":"å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ"}]]},"headers":[{"level":2,"title":"ğŸ“œ ç¬¬ä¸€éƒ¨åˆ†","slug":"ğŸ“œ-ç¬¬ä¸€éƒ¨åˆ†","link":"#ğŸ“œ-ç¬¬ä¸€éƒ¨åˆ†","children":[]},{"level":2,"title":"å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ","slug":"å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ","link":"#å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ","children":[]},{"level":2,"title":"ä¸€ã€ä»€ä¹ˆæ˜¯ã€Œè¿è¡Œæ—¶ã€(Runtime)","slug":"ä¸€ã€ä»€ä¹ˆæ˜¯ã€Œè¿è¡Œæ—¶ã€-runtime","link":"#ä¸€ã€ä»€ä¹ˆæ˜¯ã€Œè¿è¡Œæ—¶ã€-runtime","children":[{"level":3,"title":"æ ¸å¿ƒå®šä¹‰","slug":"æ ¸å¿ƒå®šä¹‰","link":"#æ ¸å¿ƒå®šä¹‰","children":[]},{"level":3,"title":"è¿è¡Œæ—¶ â‰  æ„å»ºå·¥å…·","slug":"è¿è¡Œæ—¶-æ„å»ºå·¥å…·","link":"#è¿è¡Œæ—¶-æ„å»ºå·¥å…·","children":[]}]},{"level":2,"title":"äºŒã€Docker é‡Œçš„ã€Œè¿è¡Œæ—¶ã€æ˜¯æ€ä¹ˆä½“ç°çš„ï¼Ÿ","slug":"äºŒã€docker-é‡Œçš„ã€Œè¿è¡Œæ—¶ã€æ˜¯æ€ä¹ˆä½“ç°çš„","link":"#äºŒã€docker-é‡Œçš„ã€Œè¿è¡Œæ—¶ã€æ˜¯æ€ä¹ˆä½“ç°çš„","children":[{"level":3,"title":"Docker æ¶æ„(ç®€åŒ–)","slug":"docker-æ¶æ„-ç®€åŒ–","link":"#docker-æ¶æ„-ç®€åŒ–","children":[]},{"level":3,"title":"Docker ä¸‹è¿è¡Œæµç¨‹(ä¸€å¥è¯)","slug":"docker-ä¸‹è¿è¡Œæµç¨‹-ä¸€å¥è¯","link":"#docker-ä¸‹è¿è¡Œæµç¨‹-ä¸€å¥è¯","children":[]}]},{"level":2,"title":"ä¸‰ã€Kubernetes é‡Œçš„ã€Œè¿è¡Œæ—¶ã€æ˜¯æ€ä¹ˆä½“ç°çš„ï¼Ÿ","slug":"ä¸‰ã€kubernetes-é‡Œçš„ã€Œè¿è¡Œæ—¶ã€æ˜¯æ€ä¹ˆä½“ç°çš„","link":"#ä¸‰ã€kubernetes-é‡Œçš„ã€Œè¿è¡Œæ—¶ã€æ˜¯æ€ä¹ˆä½“ç°çš„","children":[{"level":3,"title":"Kubernetes çš„è®¾è®¡åŸåˆ™","slug":"kubernetes-çš„è®¾è®¡åŸåˆ™","link":"#kubernetes-çš„è®¾è®¡åŸåˆ™","children":[]},{"level":3,"title":"K8s æ¶æ„(æ ‡å‡†å½¢æ€)","slug":"k8s-æ¶æ„-æ ‡å‡†å½¢æ€","link":"#k8s-æ¶æ„-æ ‡å‡†å½¢æ€","children":[]},{"level":3,"title":"Kubernetes ä¸­çš„\\"è¿è¡Œæ—¶\\"ä¸¤å±‚","slug":"kubernetes-ä¸­çš„-è¿è¡Œæ—¶-ä¸¤å±‚","link":"#kubernetes-ä¸­çš„-è¿è¡Œæ—¶-ä¸¤å±‚","children":[]},{"level":3,"title":"Kubernetes ä¸‹è¿è¡Œæµç¨‹","slug":"kubernetes-ä¸‹è¿è¡Œæµç¨‹","link":"#kubernetes-ä¸‹è¿è¡Œæµç¨‹","children":[]}]},{"level":2,"title":"å››ã€OCI åœ¨ Docker å’Œ K8s ä¸­çš„ä½ç½®","slug":"å››ã€oci-åœ¨-docker-å’Œ-k8s-ä¸­çš„ä½ç½®","link":"#å››ã€oci-åœ¨-docker-å’Œ-k8s-ä¸­çš„ä½ç½®","children":[{"level":3,"title":"OCI æ˜¯ä»€ä¹ˆï¼Ÿ","slug":"oci-æ˜¯ä»€ä¹ˆ","link":"#oci-æ˜¯ä»€ä¹ˆ","children":[]},{"level":3,"title":"1ï¸âƒ£ OCI Image Spec(é•œåƒè§„èŒƒ)","slug":"_1ï¸âƒ£-oci-image-spec-é•œåƒè§„èŒƒ","link":"#_1ï¸âƒ£-oci-image-spec-é•œåƒè§„èŒƒ","children":[]},{"level":3,"title":"2ï¸âƒ£ OCI Runtime Spec(è¿è¡Œè§„èŒƒ)","slug":"_2ï¸âƒ£-oci-runtime-spec-è¿è¡Œè§„èŒƒ","link":"#_2ï¸âƒ£-oci-runtime-spec-è¿è¡Œè§„èŒƒ","children":[]},{"level":3,"title":"OCI åœ¨æµç¨‹ä¸­çš„ä½“ç°","slug":"oci-åœ¨æµç¨‹ä¸­çš„ä½“ç°","link":"#oci-åœ¨æµç¨‹ä¸­çš„ä½“ç°","children":[]}]},{"level":2,"title":"äº”ã€CRI åœ¨å“ªé‡Œï¼Ÿåªå±äº Kubernetes","slug":"äº”ã€cri-åœ¨å“ªé‡Œ-åªå±äº-kubernetes","link":"#äº”ã€cri-åœ¨å“ªé‡Œ-åªå±äº-kubernetes","children":[{"level":3,"title":"CRI æ˜¯ä»€ä¹ˆï¼Ÿ","slug":"cri-æ˜¯ä»€ä¹ˆ","link":"#cri-æ˜¯ä»€ä¹ˆ","children":[]},{"level":3,"title":"CRI è§£å†³çš„é—®é¢˜","slug":"cri-è§£å†³çš„é—®é¢˜","link":"#cri-è§£å†³çš„é—®é¢˜","children":[]},{"level":3,"title":"CRI åœ¨æµç¨‹ä¸­çš„ä½“ç°","slug":"cri-åœ¨æµç¨‹ä¸­çš„ä½“ç°","link":"#cri-åœ¨æµç¨‹ä¸­çš„ä½“ç°","children":[]}]},{"level":2,"title":"å…­ã€ä¸€å¼ \\"ç»ˆæå¯¹ç…§è¡¨\\"(å»ºè®®ä¿å­˜)","slug":"å…­ã€ä¸€å¼ -ç»ˆæå¯¹ç…§è¡¨-å»ºè®®ä¿å­˜","link":"#å…­ã€ä¸€å¼ -ç»ˆæå¯¹ç…§è¡¨-å»ºè®®ä¿å­˜","children":[]},{"level":2,"title":"ä¸ƒã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“(å¯ä»¥èƒŒ)","slug":"ä¸ƒã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“-å¯ä»¥èƒŒ","link":"#ä¸ƒã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“-å¯ä»¥èƒŒ","children":[]},{"level":2,"title":"ğŸ“œ ç¬¬äºŒéƒ¨åˆ†","slug":"ğŸ“œ-ç¬¬äºŒéƒ¨åˆ†","link":"#ğŸ“œ-ç¬¬äºŒéƒ¨åˆ†","children":[]},{"level":2,"title":"ä¸¾ä¾‹è¯´æ˜: åŒä¸€ä¸ª nginx é•œåƒ å¯¹æ¯” docker run å’Œ kubectl run çš„çœŸå®æ‰§è¡Œè·¯å¾„","slug":"ä¸¾ä¾‹è¯´æ˜-åŒä¸€ä¸ª-nginx-é•œåƒ-å¯¹æ¯”-docker-run-å’Œ-kubectl-run-çš„çœŸå®æ‰§è¡Œè·¯å¾„","link":"#ä¸¾ä¾‹è¯´æ˜-åŒä¸€ä¸ª-nginx-é•œåƒ-å¯¹æ¯”-docker-run-å’Œ-kubectl-run-çš„çœŸå®æ‰§è¡Œè·¯å¾„","children":[]},{"level":2,"title":"ä¸€ã€å…ˆç»™ç»“è®º","slug":"ä¸€ã€å…ˆç»™ç»“è®º","link":"#ä¸€ã€å…ˆç»™ç»“è®º","children":[]},{"level":2,"title":"äºŒã€docker run nginxï¼šçœŸå®æ‰§è¡Œè·¯å¾„","slug":"äºŒã€docker-run-nginx-çœŸå®æ‰§è¡Œè·¯å¾„","link":"#äºŒã€docker-run-nginx-çœŸå®æ‰§è¡Œè·¯å¾„","children":[{"level":3,"title":"ä½ æ•²çš„å‘½ä»¤","slug":"ä½ æ•²çš„å‘½ä»¤","link":"#ä½ æ•²çš„å‘½ä»¤","children":[]},{"level":3,"title":"å®é™…å‘ç”Ÿçš„é“¾è·¯(ç²¾ç®€ä½†å‡†ç¡®)","slug":"å®é™…å‘ç”Ÿçš„é“¾è·¯-ç²¾ç®€ä½†å‡†ç¡®","link":"#å®é™…å‘ç”Ÿçš„é“¾è·¯-ç²¾ç®€ä½†å‡†ç¡®","children":[]},{"level":3,"title":"æ¯ä¸€å±‚å¹²äº†ä»€ä¹ˆï¼Ÿ","slug":"æ¯ä¸€å±‚å¹²äº†ä»€ä¹ˆ","link":"#æ¯ä¸€å±‚å¹²äº†ä»€ä¹ˆ","children":[]},{"level":3,"title":"ä½ åœ¨ç³»ç»Ÿé‡Œçœ‹åˆ°çš„ç»“æœ","slug":"ä½ åœ¨ç³»ç»Ÿé‡Œçœ‹åˆ°çš„ç»“æœ","link":"#ä½ åœ¨ç³»ç»Ÿé‡Œçœ‹åˆ°çš„ç»“æœ","children":[]}]},{"level":2,"title":"ä¸‰ã€kubectl run nginxï¼šçœŸå®æ‰§è¡Œè·¯å¾„","slug":"ä¸‰ã€kubectl-run-nginx-çœŸå®æ‰§è¡Œè·¯å¾„","link":"#ä¸‰ã€kubectl-run-nginx-çœŸå®æ‰§è¡Œè·¯å¾„","children":[{"level":3,"title":"ä½ æ•²çš„å‘½ä»¤","slug":"ä½ æ•²çš„å‘½ä»¤-1","link":"#ä½ æ•²çš„å‘½ä»¤-1","children":[]},{"level":3,"title":"å®é™…å‘ç”Ÿçš„é“¾è·¯(ç²¾ç®€ä½†å‡†ç¡®)","slug":"å®é™…å‘ç”Ÿçš„é“¾è·¯-ç²¾ç®€ä½†å‡†ç¡®-1","link":"#å®é™…å‘ç”Ÿçš„é“¾è·¯-ç²¾ç®€ä½†å‡†ç¡®-1","children":[]},{"level":3,"title":"æ¯ä¸€å±‚å¹²äº†ä»€ä¹ˆï¼Ÿ","slug":"æ¯ä¸€å±‚å¹²äº†ä»€ä¹ˆ-1","link":"#æ¯ä¸€å±‚å¹²äº†ä»€ä¹ˆ-1","children":[]},{"level":3,"title":"ä½ åœ¨ç³»ç»Ÿé‡Œçœ‹åˆ°çš„ç»“æœ","slug":"ä½ åœ¨ç³»ç»Ÿé‡Œçœ‹åˆ°çš„ç»“æœ-1","link":"#ä½ åœ¨ç³»ç»Ÿé‡Œçœ‹åˆ°çš„ç»“æœ-1","children":[]}]},{"level":2,"title":"å››ã€ä¸¤æ¡è·¯å¾„å¹¶æ’å¯¹ç…§(é‡ç‚¹)","slug":"å››ã€ä¸¤æ¡è·¯å¾„å¹¶æ’å¯¹ç…§-é‡ç‚¹","link":"#å››ã€ä¸¤æ¡è·¯å¾„å¹¶æ’å¯¹ç…§-é‡ç‚¹","children":[]},{"level":2,"title":"äº”ã€æœ€å®¹æ˜“è¯¯è§£çš„ä¸€ç‚¹","slug":"äº”ã€æœ€å®¹æ˜“è¯¯è§£çš„ä¸€ç‚¹","link":"#äº”ã€æœ€å®¹æ˜“è¯¯è§£çš„ä¸€ç‚¹","children":[]},{"level":2,"title":"å…­ã€ä¸€ä¸ªéªŒè¯æ–¹æ³•","slug":"å…­ã€ä¸€ä¸ªéªŒè¯æ–¹æ³•","link":"#å…­ã€ä¸€ä¸ªéªŒè¯æ–¹æ³•","children":[]},{"level":2,"title":"ä¸ƒã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“","slug":"ä¸ƒã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“","link":"#ä¸ƒã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“","children":[]},{"level":2,"title":"ğŸ“œç¬¬ä¸‰éƒ¨åˆ†","slug":"ğŸ“œç¬¬ä¸‰éƒ¨åˆ†","link":"#ğŸ“œç¬¬ä¸‰éƒ¨åˆ†","children":[]},{"level":2,"title":"åˆ°è¾¾containerdçš„æ–¹å¼ä¸åŒ è¯¦ç»†åˆ†æ","slug":"åˆ°è¾¾containerdçš„æ–¹å¼ä¸åŒ-è¯¦ç»†åˆ†æ","link":"#åˆ°è¾¾containerdçš„æ–¹å¼ä¸åŒ-è¯¦ç»†åˆ†æ","children":[{"level":3,"title":"ç”¨ä¸€å¥\\"è·¯å¾„è¡¨è¾¾å¼\\"æ¥å¯¹æ¯”","slug":"ç”¨ä¸€å¥-è·¯å¾„è¡¨è¾¾å¼-æ¥å¯¹æ¯”","link":"#ç”¨ä¸€å¥-è·¯å¾„è¡¨è¾¾å¼-æ¥å¯¹æ¯”","children":[]},{"level":3,"title":"ä¸ºä»€ä¹ˆè¿™ä¸ªåŒºåˆ«\\"éå¸¸é‡è¦\\"ï¼Ÿ","slug":"ä¸ºä»€ä¹ˆè¿™ä¸ªåŒºåˆ«-éå¸¸é‡è¦","link":"#ä¸ºä»€ä¹ˆè¿™ä¸ªåŒºåˆ«-éå¸¸é‡è¦","children":[]},{"level":3,"title":"ä¸€ã€è°åœ¨\\"æŒ‡æŒ¥\\" containerdï¼Ÿ","slug":"ä¸€ã€è°åœ¨-æŒ‡æŒ¥-containerd","link":"#ä¸€ã€è°åœ¨-æŒ‡æŒ¥-containerd","children":[]},{"level":3,"title":"äºŒã€containerd æ¥æ”¶åˆ°çš„\\"æŒ‡ä»¤è¯­ä¹‰\\"ä¸åŒ","slug":"äºŒã€containerd-æ¥æ”¶åˆ°çš„-æŒ‡ä»¤è¯­ä¹‰-ä¸åŒ","link":"#äºŒã€containerd-æ¥æ”¶åˆ°çš„-æŒ‡ä»¤è¯­ä¹‰-ä¸åŒ","children":[]},{"level":3,"title":"ä¸‰ã€ä¸ºä»€ä¹ˆ Kubernetes ä¸ç”¨ Docker Engineï¼Ÿ","slug":"ä¸‰ã€ä¸ºä»€ä¹ˆ-kubernetes-ä¸ç”¨-docker-engine","link":"#ä¸‰ã€ä¸ºä»€ä¹ˆ-kubernetes-ä¸ç”¨-docker-engine","children":[]},{"level":3,"title":"å››ã€ä¸€ä¸ªéå¸¸ç²¾å‡†çš„å·¥ç¨‹åˆ¤æ–­æ ‡å‡†(é€ä½ )","slug":"å››ã€ä¸€ä¸ªéå¸¸ç²¾å‡†çš„å·¥ç¨‹åˆ¤æ–­æ ‡å‡†-é€ä½ ","link":"#å››ã€ä¸€ä¸ªéå¸¸ç²¾å‡†çš„å·¥ç¨‹åˆ¤æ–­æ ‡å‡†-é€ä½ ","children":[]},{"level":3,"title":"äº”ã€ä½ è¿™å¥è¯å¯ä»¥å‡çº§æˆ\\"æ ‡å‡†è¡¨è¿°\\"","slug":"äº”ã€ä½ è¿™å¥è¯å¯ä»¥å‡çº§æˆ-æ ‡å‡†è¡¨è¿°","link":"#äº”ã€ä½ è¿™å¥è¯å¯ä»¥å‡çº§æˆ-æ ‡å‡†è¡¨è¿°","children":[]},{"level":3,"title":"å…­ã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“","slug":"å…­ã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“","link":"#å…­ã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“","children":[]}]},{"level":2,"title":"ğŸ“œç¬¬å››éƒ¨åˆ†","slug":"ğŸ“œç¬¬å››éƒ¨åˆ†","link":"#ğŸ“œç¬¬å››éƒ¨åˆ†","children":[]},{"level":2,"title":"ç”¨ containerd çš„è§†è§’ï¼Œå±•ç¤ºå®ƒå¦‚ä½•åŒæ—¶\\"æœåŠ¡ Docker å’Œ K8s\\"","slug":"ç”¨-containerd-çš„è§†è§’-å±•ç¤ºå®ƒå¦‚ä½•åŒæ—¶-æœåŠ¡-docker-å’Œ-k8s","link":"#ç”¨-containerd-çš„è§†è§’-å±•ç¤ºå®ƒå¦‚ä½•åŒæ—¶-æœåŠ¡-docker-å’Œ-k8s","children":[{"level":3,"title":"ä¸€ã€containerd æ˜¯ä¸€ä¸ªä»€ä¹ˆè§’è‰²ï¼Ÿ","slug":"ä¸€ã€containerd-æ˜¯ä¸€ä¸ªä»€ä¹ˆè§’è‰²","link":"#ä¸€ã€containerd-æ˜¯ä¸€ä¸ªä»€ä¹ˆè§’è‰²","children":[]},{"level":3,"title":"äºŒã€containerd å¦‚ä½•\\"åŒæ—¶æœåŠ¡ Docker å’Œ K8s\\"ï¼Ÿ","slug":"äºŒã€containerd-å¦‚ä½•-åŒæ—¶æœåŠ¡-docker-å’Œ-k8s","link":"#äºŒã€containerd-å¦‚ä½•-åŒæ—¶æœåŠ¡-docker-å’Œ-k8s","children":[]},{"level":3,"title":"ä¸‰ã€ä» containerd çš„\\"æ¥å£è§†è§’\\"çœ‹ä¸–ç•Œ","slug":"ä¸‰ã€ä»-containerd-çš„-æ¥å£è§†è§’-çœ‹ä¸–ç•Œ","link":"#ä¸‰ã€ä»-containerd-çš„-æ¥å£è§†è§’-çœ‹ä¸–ç•Œ","children":[]},{"level":3,"title":"å››ã€Docker æ˜¯æ€ä¹ˆ\\"æ¥å…¥æˆ‘\\"çš„ï¼Ÿ","slug":"å››ã€docker-æ˜¯æ€ä¹ˆ-æ¥å…¥æˆ‘-çš„","link":"#å››ã€docker-æ˜¯æ€ä¹ˆ-æ¥å…¥æˆ‘-çš„","children":[]},{"level":3,"title":"äº”ã€Kubernetes æ˜¯æ€ä¹ˆ\\"æ¥å…¥æˆ‘\\"çš„ï¼Ÿ","slug":"äº”ã€kubernetes-æ˜¯æ€ä¹ˆ-æ¥å…¥æˆ‘-çš„","link":"#äº”ã€kubernetes-æ˜¯æ€ä¹ˆ-æ¥å…¥æˆ‘-çš„","children":[]},{"level":3,"title":"å…­ã€containerd å†…éƒ¨å¦‚ä½•\\"ç»Ÿä¸€æ‰§è¡Œ\\"ï¼Ÿ","slug":"å…­ã€containerd-å†…éƒ¨å¦‚ä½•-ç»Ÿä¸€æ‰§è¡Œ","link":"#å…­ã€containerd-å†…éƒ¨å¦‚ä½•-ç»Ÿä¸€æ‰§è¡Œ","children":[]},{"level":3,"title":"ä¸ƒã€ç”¨ä¸€å¼ \\"containerd å†…éƒ¨è§†è§’å›¾\\"","slug":"ä¸ƒã€ç”¨ä¸€å¼ -containerd-å†…éƒ¨è§†è§’å›¾","link":"#ä¸ƒã€ç”¨ä¸€å¼ -containerd-å†…éƒ¨è§†è§’å›¾","children":[]},{"level":3,"title":"å…«ã€ä¸ºä»€ä¹ˆ docker ps å’Œ kubectl get pods äº’ç›¸çœ‹ä¸åˆ°ï¼Ÿ","slug":"å…«ã€ä¸ºä»€ä¹ˆ-docker-ps-å’Œ-kubectl-get-pods-äº’ç›¸çœ‹ä¸åˆ°","link":"#å…«ã€ä¸ºä»€ä¹ˆ-docker-ps-å’Œ-kubectl-get-pods-äº’ç›¸çœ‹ä¸åˆ°","children":[]},{"level":3,"title":"ä¹ã€containerd çœ¼ä¸­çš„ CRI å’Œ Docker","slug":"ä¹ã€containerd-çœ¼ä¸­çš„-cri-å’Œ-docker","link":"#ä¹ã€containerd-çœ¼ä¸­çš„-cri-å’Œ-docker","children":[]},{"level":3,"title":"åã€ç»ˆæä¸€å¥è¯æ€»ç»“(containerd è§†è§’)","slug":"åã€ç»ˆæä¸€å¥è¯æ€»ç»“-containerd-è§†è§’","link":"#åã€ç»ˆæä¸€å¥è¯æ€»ç»“-containerd-è§†è§’","children":[]}]},{"level":2,"title":"ğŸ“œç¬¬äº”éƒ¨åˆ†","slug":"ğŸ“œç¬¬äº”éƒ¨åˆ†","link":"#ğŸ“œç¬¬äº”éƒ¨åˆ†","children":[]},{"level":2,"title":"ç”¨ ctr å®é™…ç›´æ¥è·‘ä¸€ä¸ª nginx(ç»•è¿‡ Docker / K8s)æ¥çœ‹ containerd çœŸæ­£çš„è¿è¡Œè·¯å¾„ (è²Œä¼¼ctrå¾ˆå°‘ä½¿ç”¨)","slug":"ç”¨-ctr-å®é™…ç›´æ¥è·‘ä¸€ä¸ª-nginx-ç»•è¿‡-docker-k8s-æ¥çœ‹-containerd-çœŸæ­£çš„è¿è¡Œè·¯å¾„-è²Œä¼¼ctrå¾ˆå°‘ä½¿ç”¨","link":"#ç”¨-ctr-å®é™…ç›´æ¥è·‘ä¸€ä¸ª-nginx-ç»•è¿‡-docker-k8s-æ¥çœ‹-containerd-çœŸæ­£çš„è¿è¡Œè·¯å¾„-è²Œä¼¼ctrå¾ˆå°‘ä½¿ç”¨","children":[]},{"level":2,"title":"ä¸€ã€å‰ææ¡ä»¶","slug":"ä¸€ã€å‰ææ¡ä»¶","link":"#ä¸€ã€å‰ææ¡ä»¶","children":[]},{"level":2,"title":"äºŒã€æŸ¥çœ‹ containerd é•œåƒ","slug":"äºŒã€æŸ¥çœ‹-containerd-é•œåƒ","link":"#äºŒã€æŸ¥çœ‹-containerd-é•œåƒ","children":[]},{"level":2,"title":"ä¸‰ã€ç”¨ ctr è¿è¡Œ nginx","slug":"ä¸‰ã€ç”¨-ctr-è¿è¡Œ-nginx","link":"#ä¸‰ã€ç”¨-ctr-è¿è¡Œ-nginx","children":[]},{"level":2,"title":"å››ã€å’Œ docker run / kubectl run å¯¹æ¯”","slug":"å››ã€å’Œ-docker-run-kubectl-run-å¯¹æ¯”","link":"#å››ã€å’Œ-docker-run-kubectl-run-å¯¹æ¯”","children":[]},{"level":2,"title":"äº”ã€ä¸ºä»€ä¹ˆå¹³æ—¶å¾ˆå°‘ç›´æ¥ç”¨ ctrï¼Ÿ","slug":"äº”ã€ä¸ºä»€ä¹ˆå¹³æ—¶å¾ˆå°‘ç›´æ¥ç”¨-ctr","link":"#äº”ã€ä¸ºä»€ä¹ˆå¹³æ—¶å¾ˆå°‘ç›´æ¥ç”¨-ctr","children":[]},{"level":2,"title":"å…­ã€æ€»ç»“","slug":"å…­ã€æ€»ç»“","link":"#å…­ã€æ€»ç»“","children":[]},{"level":2,"title":"ğŸ“œç¬¬å…­éƒ¨åˆ†","slug":"ğŸ“œç¬¬å…­éƒ¨åˆ†","link":"#ğŸ“œç¬¬å…­éƒ¨åˆ†","children":[]},{"level":2,"title":"containerdéœ€è¦å•ç‹¬å®‰è£…å—","slug":"containerdéœ€è¦å•ç‹¬å®‰è£…å—","link":"#containerdéœ€è¦å•ç‹¬å®‰è£…å—","children":[]},{"level":2,"title":"ä¸€ã€containerd å®‰è£…æƒ…å†µ","slug":"ä¸€ã€containerd-å®‰è£…æƒ…å†µ","link":"#ä¸€ã€containerd-å®‰è£…æƒ…å†µ","children":[]},{"level":2,"title":"äºŒã€å®‰è£… vs ä½¿ç”¨çš„åŒºåˆ«","slug":"äºŒã€å®‰è£…-vs-ä½¿ç”¨çš„åŒºåˆ«","link":"#äºŒã€å®‰è£…-vs-ä½¿ç”¨çš„åŒºåˆ«","children":[]},{"level":2,"title":"ä¸‰ã€å®é™…æ“ä½œå»ºè®®","slug":"ä¸‰ã€å®é™…æ“ä½œå»ºè®®","link":"#ä¸‰ã€å®é™…æ“ä½œå»ºè®®","children":[]},{"level":2,"title":"å››ã€æ€»ç»“","slug":"å››ã€æ€»ç»“","link":"#å››ã€æ€»ç»“","children":[]},{"level":2,"title":"ğŸ“œç¬¬ä¸ƒéƒ¨åˆ†","slug":"ğŸ“œç¬¬ä¸ƒéƒ¨åˆ†","link":"#ğŸ“œç¬¬ä¸ƒéƒ¨åˆ†","children":[]},{"level":2,"title":"K8s å®˜æ–¹æ¨èä» v1.24 å¼€å§‹ç›´æ¥ç”¨ containerdï¼Œè€Œä¸æ˜¯ Docker Engineï¼Œ å¦‚æœä½¿ç”¨containerd éœ€è¦æ€ä¹ˆé…ç½®ï¼Œå¦‚æœç»§ç»­ä½¿ç”¨Docker Engine æ€ä¹ˆé…ç½®","slug":"k8s-å®˜æ–¹æ¨èä»-v1-24-å¼€å§‹ç›´æ¥ç”¨-containerd-è€Œä¸æ˜¯-docker-engine-å¦‚æœä½¿ç”¨containerd-éœ€è¦æ€ä¹ˆé…ç½®-å¦‚æœç»§ç»­ä½¿ç”¨docker-engine-æ€ä¹ˆé…ç½®","link":"#k8s-å®˜æ–¹æ¨èä»-v1-24-å¼€å§‹ç›´æ¥ç”¨-containerd-è€Œä¸æ˜¯-docker-engine-å¦‚æœä½¿ç”¨containerd-éœ€è¦æ€ä¹ˆé…ç½®-å¦‚æœç»§ç»­ä½¿ç”¨docker-engine-æ€ä¹ˆé…ç½®","children":[]},{"level":2,"title":"ä¸€ã€K8s å®˜æ–¹æ¨èèƒŒæ™¯","slug":"ä¸€ã€k8s-å®˜æ–¹æ¨èèƒŒæ™¯","link":"#ä¸€ã€k8s-å®˜æ–¹æ¨èèƒŒæ™¯","children":[]},{"level":2,"title":"äºŒã€containerd ä½œä¸º Kubernetes runtime çš„é…ç½®","slug":"äºŒã€containerd-ä½œä¸º-kubernetes-runtime-çš„é…ç½®","link":"#äºŒã€containerd-ä½œä¸º-kubernetes-runtime-çš„é…ç½®","children":[{"level":3,"title":"1ï¸âƒ£ å®‰è£… containerd","slug":"_1ï¸âƒ£-å®‰è£…-containerd","link":"#_1ï¸âƒ£-å®‰è£…-containerd","children":[]},{"level":3,"title":"2ï¸âƒ£ é…ç½® containerd","slug":"_2ï¸âƒ£-é…ç½®-containerd","link":"#_2ï¸âƒ£-é…ç½®-containerd","children":[]},{"level":3,"title":"3ï¸âƒ£ å¯åŠ¨ containerd","slug":"_3ï¸âƒ£-å¯åŠ¨-containerd","link":"#_3ï¸âƒ£-å¯åŠ¨-containerd","children":[]},{"level":3,"title":"4ï¸âƒ£ é…ç½® kubelet ä½¿ç”¨ containerd","slug":"_4ï¸âƒ£-é…ç½®-kubelet-ä½¿ç”¨-containerd","link":"#_4ï¸âƒ£-é…ç½®-kubelet-ä½¿ç”¨-containerd","children":[]}]},{"level":2,"title":"ä¸‰ã€Docker Engine ä½œä¸º Kubernetes runtime","slug":"ä¸‰ã€docker-engine-ä½œä¸º-kubernetes-runtime","link":"#ä¸‰ã€docker-engine-ä½œä¸º-kubernetes-runtime","children":[]},{"level":2,"title":"å››ã€å¯¹æ¯”è¡¨æ ¼","slug":"å››ã€å¯¹æ¯”è¡¨æ ¼","link":"#å››ã€å¯¹æ¯”è¡¨æ ¼","children":[]},{"level":2,"title":"äº”ã€CRI-O ä½œä¸º Kubernetes runtime (è¡¥å……ä¸€ä¸ª)","slug":"äº”ã€cri-o-ä½œä¸º-kubernetes-runtime-è¡¥å……ä¸€ä¸ª","link":"#äº”ã€cri-o-ä½œä¸º-kubernetes-runtime-è¡¥å……ä¸€ä¸ª","children":[]},{"level":2,"title":"å…­ã€æ€»ç»“","slug":"å…­ã€æ€»ç»“-1","link":"#å…­ã€æ€»ç»“-1","children":[]}],"git":{},"filePathRelative":"content/service/docker/å…³äºå®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µ.md"}');export{c as comp,o as data};
