import{_ as s,c as a,d as p,o as t}from"./app-CHrRue27.js";const e={};function l(o,n){return t(),a("div",null,n[0]||(n[0]=[p(`<p>laravel之打印sql:</p><p>在laravel执行查询的时候，有时候需要打印sql，可以使用下面的方式实现:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line">在AppServiceProvider<span class="token operator">.</span>php的boot 方法里面加入如下的方法：</span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//</span></span>
<span class="line">        <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\\</span>DB</span><span class="token operator">::</span><span class="token function">listen</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token operator">-&gt;</span><span class="token property">bindings</span> <span class="token keyword">as</span> <span class="token variable">$i</span> <span class="token operator">=&gt;</span> <span class="token variable">$binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$binding</span> <span class="token keyword">instanceof</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\\</span>DateTime</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token variable">$sql</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$binding</span><span class="token operator">-&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;\\&#39;Y-m-d H:i:s\\&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$binding</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token variable">$sql</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&#39;<span class="token interpolation"><span class="token variable">$binding</span></span>&#39;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 解析查询参数</span></span>
<span class="line">                <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;%&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;?&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;%%&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;%s&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token operator">-&gt;</span><span class="token property">sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token function">vsprintf</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 输出到 storage日志下</span></span>
<span class="line">                <span class="token variable">$logFile</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span></span>
<span class="line">                    <span class="token function">storage_path</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;logs&#39;</span> <span class="token operator">.</span> <span class="token constant">DIRECTORY_SEPARATOR</span> <span class="token operator">.</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;Y-m-d&#39;</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;_query.log&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token string single-quoted-string">&#39;a+&#39;</span></span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$logFile</span><span class="token punctuation">,</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;Y-m-d H:i:s&#39;</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;: &#39;</span> <span class="token operator">.</span> <span class="token variable">$query</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$logFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3)]))}const i=s(e,[["render",l],["__file","laravel之打印sql.html.vue"]]),u=JSON.parse('{"path":"/content/php/laravel/laravel%E4%B9%8B%E6%89%93%E5%8D%B0sql.html","title":"laravel之打印sql","lang":"en-US","frontmatter":{"sidebar":false,"title":"laravel之打印sql","description":"laravel之打印sql"},"headers":[],"git":{},"filePathRelative":"content/php/laravel/laravel之打印sql.md"}');export{i as comp,u as data};
