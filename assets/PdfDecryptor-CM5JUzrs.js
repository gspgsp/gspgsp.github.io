import{_ as H,e as i,l as J,o as p,c as f,b as s,B as x,C,t as y,F as W,x as q,i as _,f as k,h as G,K as Q,J as R,y as X}from"./app-CHrRue27.js";import{C as b,F as P,J as M}from"./jszip.min-ZwSeMA6g.js";import"./commonjsHelpers-BosuxZz1.js";import"./vite-browser-external_commonjs-proxy-wZpHG6Gx.js";const Y={__name:"PdfDecryptor",setup(z,{expose:n}){n();const r=i([]),e=i([]),w=i(""),A=i(!1),a=i(!1),g=i(""),D=i(""),S=i(!1),I=i(null),m=i(0),U=J(()=>!a.value||r.value.length===0?0:m.value/r.value.length*100);function V(t){S.value=!1;const l=Array.from(t.dataTransfer.files).filter(o=>o.name.endsWith(".enc"));if(l.length===0){c("请上传 .enc 格式的文件","error");return}F(l)}function N(t){const l=Array.from(t.target.files);F(l)}function F(t){const l=t.map(o=>({file:o,name:o.name,status:"pending"}));r.value=[...r.value,...l],c(`已添加 ${t.length} 个文件`,"success")}function O(t){r.value.splice(t,1),r.value.length===0&&(e.value=[])}function j(){r.value=[],e.value=[],w.value="",g.value=""}function K(t){return{pending:"⏳ 待解密",decrypting:"🔄 解密中",success:"✅ 成功",error:"❌ 失败"}[t]||""}function c(t,l="info"){g.value=t,D.value=l,setTimeout(()=>{g.value=""},4e3)}function T(t,l){try{const o=b.AES.decrypt(t,l,{mode:b.mode.CBC,padding:b.pad.Pkcs7}),d=o.words,u=o.sigBytes;if(!d||u===0)throw new Error("解密结果为空");const h=new Uint8Array(u);for(let v=0;v<u;v++)h[v]=d[v>>>2]>>>24-v%4*8&255;return h}catch{throw new Error("解密失败，密码可能不正确")}}function B(t){const l=new Uint8Array([37,80,68,70,45]);if(t.length<5)return!1;for(let o=0;o<5;o++)if(t[o]!==l[o])return!1;return!0}async function L(){a.value=!0,m.value=0,e.value=[];let t=0,l=0;for(let o=0;o<r.value.length;o++){const d=r.value[o];d.status="decrypting";try{const u=await d.file.text(),h=T(u,w.value);if(!B(h))throw new Error("密码错误：解密后的文件不是有效的 PDF 格式");const v=d.name.replace(/\.enc$/,"");d.status="success",e.value.push({name:v,data:h}),t++}catch(u){console.error(`解密 ${d.name} 失败:`,u),d.status="error",l++}m.value=o+1,await new Promise(u=>setTimeout(u,100))}a.value=!1,m.value=0,t>0&&l===0?c(`🎉 成功解密 ${t} 个文件！`,"success"):t>0&&l>0?c(`⚠️ 成功 ${t} 个，失败 ${l} 个（请检查密码）`,"warning"):c("❌ 解密失败！密码错误或文件已损坏","error")}async function Z(){if(e.value.length!==0)if(c("正在准备下载...","info"),e.value.length===1){const t=e.value[0],l=new Blob([t.data],{type:"application/pdf"});P.saveAs(l,t.name),c("✅ 文件已下载","success")}else{const t=new M;e.value.forEach(o=>{t.file(o.name,o.data)});const l=await t.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}});P.saveAs(l,`decrypted_pdfs_${Date.now()}.zip`),c(`✅ 已打包下载 ${e.value.length} 个文件`,"success")}}const E={files:r,decryptedFiles:e,password:w,showPassword:A,processing:a,message:g,messageType:D,isDragging:S,fileInput:I,currentProgress:m,progress:U,handleDrop:V,handleUpload:N,addFiles:F,removeFile:O,clearAll:j,getStatusText:K,showMessage:c,decryptFile:T,isPDFValid:B,decryptFiles:L,downloadAll:Z,ref:i,computed:J,get CryptoJS(){return b},get saveAs(){return P.saveAs},get JSZip(){return M}};return Object.defineProperty(E,"__isScriptSetup",{enumerable:!1,value:!0}),E}},$={class:"pdf-decryptor"},ee={key:0,class:"file-list"},se={class:"list-header"},te={class:"file-info"},ne={class:"file-name"},le={class:"file-actions"},oe=["onClick"],ae={class:"input-group"},re={class:"password-input"},ie=["type"],ce={class:"button-group"},de=["disabled"],ue={key:0},pe={key:1},fe={key:1,class:"progress-bar"},ge={class:"progress-text"};function ve(z,n,r,e,w,A){return p(),f("div",$,[n[7]||(n[7]=s("h2",{class:"title"},"🔓 PDF 解密工具",-1)),n[8]||(n[8]=s("p",{class:"subtitle"},"解密通过加密工具生成的 .enc 文件",-1)),s("div",{class:x(["upload-area",{"drag-over":e.isDragging}]),onDrop:C(e.handleDrop,["prevent"]),onDragover:n[0]||(n[0]=C(a=>e.isDragging=!0,["prevent"])),onDragleave:n[1]||(n[1]=C(a=>e.isDragging=!1,["prevent"]))},[s("input",{type:"file",accept:".enc",multiple:"",onChange:e.handleUpload,id:"encInput",ref:"fileInput",hidden:""},null,544),n[4]||(n[4]=s("div",{class:"upload-content"},[s("div",{class:"upload-icon"},"📁"),s("label",{for:"encInput",class:"upload-btn"},"选择 .enc 文件"),s("p",{class:"upload-hint"},"或拖拽文件到此处")],-1))],34),e.files.length?(p(),f("div",ee,[s("div",se,[s("span",null,"文件列表 ("+y(e.files.length)+")",1),s("button",{class:"clear-btn",onClick:e.clearAll},"清空")]),(p(!0),f(W,null,q(e.files,(a,g)=>(p(),f("div",{key:g,class:"file-item"},[s("div",te,[n[5]||(n[5]=s("span",{class:"file-icon"},"📄",-1)),s("span",ne,y(a.name),1)]),s("div",le,[s("span",{class:x(["status",a.status])},y(e.getStatusText(a.status)),3),s("button",{class:"delete-btn",onClick:D=>e.removeFile(g)},"✕",8,oe)])]))),128))])):_("",!0),s("div",ae,[n[6]||(n[6]=s("label",null,[s("span",{class:"label-icon"},"🔑"),k(" 解密密码： ")],-1)),s("div",re,[G(s("input",{"onUpdate:modelValue":n[2]||(n[2]=a=>e.password=a),type:e.showPassword?"text":"password",placeholder:"请输入加密时使用的密码",onKeyup:R(e.decryptFiles,["enter"])},null,40,ie),[[Q,e.password]]),s("button",{class:"toggle-password",onClick:n[3]||(n[3]=a=>e.showPassword=!e.showPassword)},y(e.showPassword?"👁️":"👁️‍🗨️"),1)])]),s("div",ce,[s("button",{class:"decrypt-btn",disabled:!e.files.length||!e.password||e.processing,onClick:e.decryptFiles},[e.processing?(p(),f("span",ue,"⏳ 解密中...")):(p(),f("span",pe,"🔓 解密文件"))],8,de),e.decryptedFiles.length>0?(p(),f("button",{key:0,class:"download-all-btn",onClick:e.downloadAll},[s("span",null,"💾 下载全部 ("+y(e.decryptedFiles.length)+")",1)])):_("",!0)]),e.processing?(p(),f("div",fe,[s("div",{class:"progress-fill",style:X({width:e.progress+"%"})},null,4),s("span",ge,y(Math.round(e.progress))+"%",1)])):_("",!0),e.message?(p(),f("div",{key:2,class:x(["message",e.messageType])},y(e.message),3)):_("",!0),n[9]||(n[9]=s("div",{class:"instructions"},[s("details",null,[s("summary",null,"📖 使用说明"),s("ol",null,[s("li",null,[k("上传从加密工具生成的 "),s("code",null,".enc"),k(" 文件")]),s("li",null,"输入加密时使用的密码"),s("li",null,'点击"解密文件"按钮'),s("li",null,'解密成功后，点击"下载全部"获取原始 PDF')]),s("p",{class:"note"},"💡 支持批量解密，一次可处理多个文件")])],-1))])}const _e=H(Y,[["render",ve],["__scopeId","data-v-a68a4a70"],["__file","PdfDecryptor.vue"]]);export{_e as default};
