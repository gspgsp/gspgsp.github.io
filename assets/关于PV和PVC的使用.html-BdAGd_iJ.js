import{_ as n,c as a,f as e,o as l}from"./app-BB_BIQV8.js";const t={};function p(i,s){return l(),a("div",null,s[0]||(s[0]=[e(`<h2 id="关于pv和pvc的使用" tabindex="-1"><a class="header-anchor" href="#关于pv和pvc的使用"><span>关于PV和PVC的使用</span></a></h2><h3 id="简单来说" tabindex="-1"><a class="header-anchor" href="#简单来说"><span>简单来说：</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">PV（PersistentVolume） 是集群级别的存储资源，由管理员预先创建。它代表实际的存储（比如 NFS、iSCSI、云存储等），独立于任何 Pod 的生命周期存在。</span>
<span class="line">PVC（PersistentVolumeClaim） 是用户级别的存储请求。Pod 通过 PVC 来声明它需要多少存储空间，然后 K8s 会自动匹配合适的 PV 绑定到这个 PVC。</span>
<span class="line">工作流程是：创建 PV → 创建 PVC（指定大小、访问模式等）→ PVC 绑定到 PV → Pod 挂载 PVC。</span>
<span class="line">这种设计的好处是解耦了存储管理和 Pod 使用，管理员负责提供存储资源，开发者只需声明需要什么样的存储。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="pv-和-pvc-的关联是自动的匹配过程" tabindex="-1"><a class="header-anchor" href="#pv-和-pvc-的关联是自动的匹配过程"><span>PV 和 PVC 的关联是自动的匹配过程：</span></a></h3><p>当你创建 PVC 时，K8s 会根据 PVC 的需求去找合适的 PV 进行绑定。匹配的条件主要有：</p><blockquote><p>存储大小：PV 的容量要 &gt;= PVC 请求的大小<br> 访问模式：PV 和 PVC 的 accessModes 要兼容<br> StorageClass：如果都指定了，要相同（没指定的话不限制）</p></blockquote><h3 id="具体流程" tabindex="-1"><a class="header-anchor" href="#具体流程"><span>具体流程:</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">创建 PVC</span>
<span class="line">  ↓</span>
<span class="line">K8s scheduler 检查集群中所有可用的 PV</span>
<span class="line">  ↓</span>
<span class="line">寻找满足条件的 PV（大小够、accessMode 兼容等）</span>
<span class="line">  ↓</span>
<span class="line">绑定到第一个符合条件的 PV</span>
<span class="line">  ↓</span>
<span class="line">PVC 状态变为 Bound</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="k8s-pv-pvc-使用场景总结" tabindex="-1"><a class="header-anchor" href="#k8s-pv-pvc-使用场景总结"><span>K8s PV/PVC 使用场景总结</span></a></h1><h2 id="一、快速对照表" tabindex="-1"><a class="header-anchor" href="#一、快速对照表"><span>一、快速对照表</span></a></h2><table><thead><tr><th>维度</th><th>无状态应用</th><th>有状态应用</th></tr></thead><tbody><tr><td><strong>部署方式</strong></td><td>Deployment</td><td>StatefulSet</td></tr><tr><td><strong>Pod 身份</strong></td><td>无固定身份</td><td>固定身份（Pod-0、Pod-1...）</td></tr><tr><td><strong>存储方案</strong></td><td>外部服务或无存储</td><td>每个 Pod 独立 PVC</td></tr><tr><td><strong>扩缩容</strong></td><td>自由扩缩</td><td>需要考虑数据一致性</td></tr><tr><td><strong>常见应用</strong></td><td>Web、API、网关</td><td>数据库、消息队列、缓存集群</td></tr><tr><td><strong>PV/PVC</strong></td><td>通常不需要</td><td>必需（StatefulSet + volumeClaimTemplates）</td></tr><tr><td><strong>推荐实践</strong></td><td>用云托管服务</td><td>用云托管 或 StatefulSet 自管</td></tr></tbody></table><hr><h2 id="二、实战建议" tabindex="-1"><a class="header-anchor" href="#二、实战建议"><span>二、实战建议</span></a></h2><h3 id="对于当前-go-网关应用-无状态" tabindex="-1"><a class="header-anchor" href="#对于当前-go-网关应用-无状态"><span>对于当前 Go 网关应用（无状态）</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># 最终推荐配置</span></span>
<span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> go<span class="token punctuation">-</span>gateway</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">4</span></span>
<span class="line">  <span class="token key atrule">strategy</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">type</span><span class="token punctuation">:</span> RollingUpdate</span>
<span class="line">    <span class="token key atrule">rollingUpdate</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">maxSurge</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line">      <span class="token key atrule">maxUnavailable</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line">  <span class="token key atrule">selector</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">app</span><span class="token punctuation">:</span> go<span class="token punctuation">-</span>gateway</span>
<span class="line">  <span class="token key atrule">template</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">app</span><span class="token punctuation">:</span> go<span class="token punctuation">-</span>gateway</span>
<span class="line">    <span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app</span>
<span class="line">          <span class="token key atrule">image</span><span class="token punctuation">:</span> go<span class="token punctuation">-</span>gateway<span class="token punctuation">:</span><span class="token number">0.1</span></span>
<span class="line">          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent</span>
<span class="line">          <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span></span>
<span class="line">          <span class="token key atrule">env</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># 数据库</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_HOST</span>
<span class="line">              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">secretKeyRef</span><span class="token punctuation">:</span></span>
<span class="line">                  <span class="token key atrule">name</span><span class="token punctuation">:</span> db<span class="token punctuation">-</span>secret</span>
<span class="line">                  <span class="token key atrule">key</span><span class="token punctuation">:</span> host</span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_PASSWORD</span>
<span class="line">              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">secretKeyRef</span><span class="token punctuation">:</span></span>
<span class="line">                  <span class="token key atrule">name</span><span class="token punctuation">:</span> db<span class="token punctuation">-</span>secret</span>
<span class="line">                  <span class="token key atrule">key</span><span class="token punctuation">:</span> password</span>
<span class="line">            <span class="token comment"># 缓存</span></span>
<span class="line">            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> REDIS_URL</span>
<span class="line">              <span class="token key atrule">value</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>//redis.default.svc.cluster.local<span class="token punctuation">:</span><span class="token number">6379</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>不需要 PV/PVC！</strong> 因为：</p><ul><li>网关是无状态的</li><li>数据库用云托管</li><li>缓存用外部 Redis</li><li>日志输出到 stdout</li></ul><h3 id="对于数据库-有状态" tabindex="-1"><a class="header-anchor" href="#对于数据库-有状态"><span>对于数据库（有状态）</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># 自管 MySQL（高级用法）</span></span>
<span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> StatefulSet</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> mysql</span>
<span class="line">  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span></span>
<span class="line">  <span class="token comment"># ... 配置见上面 StatefulSet 例子</span></span>
<span class="line">  <span class="token key atrule">volumeClaimTemplates</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">name</span><span class="token punctuation">:</span> data</span>
<span class="line">      <span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;ReadWriteOnce&quot;</span> <span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">resources</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">requests</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">storage</span><span class="token punctuation">:</span> 50Gi</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># 推荐：用云托管 RDS</span></span>
<span class="line"><span class="token comment"># 应用端点：mydb.us-east-1.rds.amazonaws.com</span></span>
<span class="line"><span class="token comment"># 无需 K8s 中运行数据库</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="三、总结一句话" tabindex="-1"><a class="header-anchor" href="#三、总结一句话"><span>三、总结一句话</span></a></h2><ul><li><strong>无状态应用</strong>：不用 PV，直接用 Deployment + 外部服务</li><li><strong>有状态应用</strong>：用 StatefulSet + PVC（自管）或直接用云托管服务</li><li><strong>生产环境最佳实践</strong>：尽量用云厂商托管服务，减少运维成本</li></ul>`,24)]))}const o=n(t,[["render",p],["__file","关于PV和PVC的使用.html.vue"]]),u=JSON.parse('{"path":"/content/service/k8s/%E5%85%B3%E4%BA%8EPV%E5%92%8CPVC%E7%9A%84%E4%BD%BF%E7%94%A8.html","title":"关于PV和PVC的使用","lang":"en-US","frontmatter":{"sidebar":false,"title":"关于PV和PVC的使用","head":[["meta",{"name":"title","content":"关于PV和PVC的使用"}],["meta",{"name":"description","content":"关于PV和PVC的使用"}],["meta",{"name":"keywords","content":"关于PV和PVC的使用"}],["meta",{"property":"og:title","content":"关于PV和PVC的使用"}],["meta",{"property":"og:description","content":"关于PV和PVC的使用"}]]},"headers":[{"level":2,"title":"关于PV和PVC的使用","slug":"关于pv和pvc的使用","link":"#关于pv和pvc的使用","children":[{"level":3,"title":"简单来说：","slug":"简单来说","link":"#简单来说","children":[]},{"level":3,"title":"PV 和 PVC 的关联是自动的匹配过程：","slug":"pv-和-pvc-的关联是自动的匹配过程","link":"#pv-和-pvc-的关联是自动的匹配过程","children":[]},{"level":3,"title":"具体流程:","slug":"具体流程","link":"#具体流程","children":[]}]},{"level":2,"title":"一、快速对照表","slug":"一、快速对照表","link":"#一、快速对照表","children":[]},{"level":2,"title":"二、实战建议","slug":"二、实战建议","link":"#二、实战建议","children":[{"level":3,"title":"对于当前 Go 网关应用（无状态）","slug":"对于当前-go-网关应用-无状态","link":"#对于当前-go-网关应用-无状态","children":[]},{"level":3,"title":"对于数据库（有状态）","slug":"对于数据库-有状态","link":"#对于数据库-有状态","children":[]}]},{"level":2,"title":"三、总结一句话","slug":"三、总结一句话","link":"#三、总结一句话","children":[]}],"git":{},"filePathRelative":"content/service/k8s/关于PV和PVC的使用.md"}');export{o as comp,u as data};
