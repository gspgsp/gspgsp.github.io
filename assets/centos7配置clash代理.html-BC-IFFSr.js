import{_ as n,c as a,d as e,o as l}from"./app-CHrRue27.js";const t={};function p(i,s){return l(),a("div",null,s[0]||(s[0]=[e(`<p>最近在网站开发过程中，线上服务器可能需要使用chat-gpt服务，主要是问答功能，因此需要vpn服务，现将使用步骤记录如下:<br> 1.下载当前操作系统与 CPU 架构对应的包文件，我这儿是 X86_64 平台下 CentOS7 所以对应的使用<a href="https://github.com/Dreamacro/clash/releases" target="_blank" rel="noopener noreferrer">clash-linux-amd64-v1.14.0.gz</a></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment">#执行命令，加上 --no-check-certificate 避免github链接失败</span></span>
<span class="line"><span class="token builtin class-name">cd</span> /usr/local</span>
<span class="line"><span class="token function">wget</span> https://github.com/Dreamacro/clash/releases/download/v1.14.0/clash-linux-amd64-v1.14.0.gz --no-check-certificate</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.解压缩文件</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">gunzip clash-linux-amd64-v1.14.0.gz</span>
<span class="line"></span>
<span class="line"><span class="token comment">#执行完后可以在当前路径下看到解压缩后的文件：clash-linux-amd64-v1.14.0 同时原gz文件会被自动删除</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.创建配置文件目录，并下载 MMDB 文件，这个文件应该是一个内存级别数据库</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">mkdir</span> /etc/clash</span>
<span class="line"><span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/clash/Country.mmdb https://www.sub-speeder.com/client-download/Country.mmdb</span>
<span class="line"></span>
<span class="line"><span class="token comment">#注意 www.sub-speeder.com 这个链接大概率是访问不到的，可以单独下载然后重命名为Country.mmdb, 通过ftp上传到 /etc/clash/Country.mmdb</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.创建 systemd 脚本，脚本文件路径为 /etc/systemd/system/clash.service，内容如下：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">Description</span><span class="token operator">=</span>clash daemon</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Service<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">Type</span><span class="token operator">=</span>simple</span>
<span class="line"><span class="token assign-left variable">User</span><span class="token operator">=</span>root</span>
<span class="line"><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/clash-linux-amd64-v1.14.0 <span class="token parameter variable">-d</span> /etc/clash/</span>
<span class="line"><span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Install<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5.重载 systemctl daemon</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">systemctl daemon-reload</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>6.配置代理网络信息</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/clash/config.yaml <span class="token punctuation">[</span>自己的订阅链接<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#注意 自己的订阅链接 大概率也是打不开的，所以直接浏览器打开链接，会自动下载一个yaml文件，把这个yaml文件重命名为config.yaml，然后ftp上传到 /etc/clash/config.yaml</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>7.设置系统代理，添加配置文件 /etc/profile.d/proxy.sh 并在其中写入如下内容：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">http_proxy</span><span class="token operator">=</span><span class="token string">&quot;127.0.0.1:7890&quot;</span></span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">https_proxy</span><span class="token operator">=</span><span class="token string">&quot;127.0.0.1:7890&quot;</span></span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">no_proxy</span><span class="token operator">=</span><span class="token string">&quot;localhost, 127.0.0.1&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>8.重载 /etc/profile 配置</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token builtin class-name">source</span> /etc/profile</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>9.启动 clash 服务，并设置为开机自动启</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">systemctl start clash</span>
<span class="line">systemctl <span class="token builtin class-name">enable</span> clash</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>10.查看7890端口情况</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>root@worker1 clash<span class="token punctuation">]</span><span class="token comment"># lsof -i:7890</span></span>
<span class="line">COMMAND     PID <span class="token environment constant">USER</span>   FD   TYPE     DEVICE SIZE/OFF NODE NAME</span>
<span class="line">clash-lin <span class="token number">15539</span> root    7u  IPv6 <span class="token number">1115515191</span>      0t0  TCP *:7890 <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#说明服务没啥问题</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>11.测试google是否能够访问</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>root@worker1 clash<span class="token punctuation">]</span><span class="token comment"># curl google.com</span></span>
<span class="line"><span class="token operator">&lt;</span>HTML<span class="token operator">&gt;</span><span class="token operator">&lt;</span>HEAD<span class="token operator">&gt;</span><span class="token operator">&lt;</span>meta http-equiv<span class="token operator">=</span><span class="token string">&quot;content-type&quot;</span> <span class="token assign-left variable">content</span><span class="token operator">=</span><span class="token string">&quot;text/html;charset=utf-8&quot;</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>TITLE<span class="token operator">&gt;</span><span class="token number">301</span> Moved<span class="token operator">&lt;</span>/TITLE<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/HEAD<span class="token operator">&gt;</span><span class="token operator">&lt;</span>BODY<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>H<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token number">301</span> Moved<span class="token operator">&lt;</span>/H<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span></span>
<span class="line">The document has moved</span>
<span class="line"><span class="token operator">&lt;</span>A <span class="token assign-left variable">HREF</span><span class="token operator">=</span><span class="token string">&quot;http://www.google.com/&quot;</span><span class="token operator">&gt;</span>here<span class="token operator">&lt;</span>/A<span class="token operator">&gt;</span>.</span>
<span class="line"><span class="token operator">&lt;</span>/BODY<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/HTML<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#说明是ok的</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>12.至此整个服务器代理配置完成，当然还可以配置一个Clash客户端，这里就不弄了</p><p>13.如果想停止使用代理，执行如下命令即可:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>root@worker1 clash<span class="token punctuation">]</span><span class="token comment"># unset https_proxy</span></span>
<span class="line"><span class="token punctuation">[</span>root@worker1 clash<span class="token punctuation">]</span><span class="token comment"># unset http_proxy</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#不用管/etc/profile.d/proxy.sh 文件，然后就可以不使用代理访问站点；最好再把clash服务也停了 systemctl stop clash</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>14.如果想再次使用代理，执行如下命令即可:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token builtin class-name">source</span> /etc/profile</span>
<span class="line">systemctl start clash</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>`,27)]))}const r=n(t,[["render",p],["__file","centos7配置clash代理.html.vue"]]),o=JSON.parse('{"path":"/content/linux/command/centos7%E9%85%8D%E7%BD%AEclash%E4%BB%A3%E7%90%86.html","title":"centos7配置clash代理","lang":"en-US","frontmatter":{"sidebar":false,"title":"centos7配置clash代理","description":"centos7配置clash代理"},"headers":[],"git":{},"filePathRelative":"content/linux/command/centos7配置clash代理.md"}');export{r as comp,o as data};
